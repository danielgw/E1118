<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: drivers/usb/core/dev_mux.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>drivers/usb/core/dev_mux.c File Reference</h1>
<p>USB device multiplexing layer.  
<a href="#_details">More...</a></p>
<code>#include &lt;<a class="el" href="assert_8h_source.html">assert.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="arch_2avr8_2include_2arch_2byteorder_8h_source.html">byteorder.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="debug_8h_source.html">debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu_2mega_2include_2cpu_2dmapool_8h_source.html">dmapool.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="arch_2avr8_2include_2arch_2interrupt_8h_source.html">interrupt.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="malloc_8h_source.html">malloc.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="status__codes_8h_source.html">status_codes.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="arch_2avr8_2include_2arch_2string_8h_source.html">string.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="util_8h_source.html">util.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="dev_8h_source.html">usb/dev.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="dev__mux_8h_source.html">usb/dev_mux.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="request_8h_source.html">usb/request.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="udc_8h_source.html">usb/udc.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="usb_8h_source.html">app/usb.h</a>&gt;</code><br/>

<p><a href="dev__mux_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">USB Device Strings</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp9b5b896e574ca6f548351ea8a5cece21"></a> </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#gafa76f709eeccc9eaf1d3ba187a418c92">USB_STRING_DEV_PRODUCT</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">String ID representing the name of the product.  <a href="group__usb__dev__mux.html#gafa76f709eeccc9eaf1d3ba187a418c92"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga47ed81085d545acb4ac8ab054959a44b">USB_STRING_DEV_SERIAL</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">String ID representing the serial number of the device.  <a href="group__usb__dev__mux.html#ga47ed81085d545acb4ac8ab054959a44b"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#ga87e8b45006847b28ba394d1daeb5331b">usb_dev_get_descriptor</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> value, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> index, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle a standard GET_DESCRIPTOR request.  <a href="group__usb__dev__core__group.html#ga87e8b45006847b28ba394d1daeb5331b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#ga4a51a8d1b52b0c474bd108f53f34986c">usb_dev_set_configuration</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> config_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the active configuration.  <a href="group__usb__dev__core__group.html#ga4a51a8d1b52b0c474bd108f53f34986c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#ga6cbee0c91abaa976b89f3fdb9861fb52">usb_dev_get_interface</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> iface_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the currently active alternate setting of an interface.  <a href="group__usb__dev__core__group.html#ga6cbee0c91abaa976b89f3fdb9861fb52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#gac860eb3e674caa8c38bfed5b26a629db">usb_dev_set_interface</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> iface_id, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> alt_setting)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Select an alternate setting for an interface.  <a href="group__usb__dev__core__group.html#gac860eb3e674caa8c38bfed5b26a629db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#gae1d65a263ed4a92e38f325176a0e3820">usb_dev_reset</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset the USB device.  <a href="group__usb__dev__core__group.html#gae1d65a263ed4a92e38f325176a0e3820"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#gaaae4b9c7341bb875e7d11f8befcd9d54">usb_dev_process_setup_request</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__setup__req.html">usb_setup_req</a> *setup)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle a class- or vendor-defined setup request.  <a href="group__usb__dev__core__group.html#gaaae4b9c7341bb875e7d11f8befcd9d54"></a><br/></td></tr>
<tr><td colspan="2"><div class="groupHeader">Configuration Management</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpa4934331bbf896399132d3d20f141ef3"></a> The following functions may be called by the application to create configurations and associate interfaces with them. The interface objects are typically returned by the initialization function of a USB Device Interface Driver.</p>
<p><a class="el" href="group__usb__dev__mux.html#gaa323d6f0a542bd5e611634e89d0852b8" title="Create a new USB device configuration.">udm_create_config()</a> returns a configuration object which can be passed as a parameter to the other configuration management functions. The configuration descriptor is managed by the UDM layer, but the application may alter certain fields by calling <a class="el" href="group__usb__dev__mux.html#ga97ed794f81c25ad0fbf4176816ec1984" title="Mark a configuration as self-powered.">udm_config_set_self_powered()</a>, <a class="el" href="group__usb__dev__mux.html#ga4e984caec69fa2faf55aa481afd92d56" title="Mark a configuration as bus-powered.">udm_config_set_bus_powered()</a>, and <a class="el" href="group__usb__dev__mux.html#ga665de55fcf0adbbb1b12a8ddaa313f04" title="Set the maximum power consumption of a configuration.">udm_config_set_max_power()</a>. The application must not create more than one configuration with a given value, and it must not attempt to create more configurations than specified by APP_USB_DEVICE_NR_CONFIGS. </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga297f1a697e4aa8f4f8d450864b670165">udm_config_add_interface</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config, struct <a class="el" href="structudm__interface.html">udm_interface</a> *iface)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an interface to a configuration.  <a href="group__usb__dev__mux.html#ga297f1a697e4aa8f4f8d450864b670165"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structudm__config.html">udm_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#gaa323d6f0a542bd5e611634e89d0852b8">udm_create_config</a> (<a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> value, <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> nr_interfaces)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new USB device configuration.  <a href="group__usb__dev__mux.html#gaa323d6f0a542bd5e611634e89d0852b8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga665de55fcf0adbbb1b12a8ddaa313f04">udm_config_set_max_power</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config, unsigned int milliamps)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the maximum power consumption of a configuration.  <a href="group__usb__dev__mux.html#ga665de55fcf0adbbb1b12a8ddaa313f04"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga97ed794f81c25ad0fbf4176816ec1984">udm_config_set_self_powered</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mark a configuration as self-powered.  <a href="group__usb__dev__mux.html#ga97ed794f81c25ad0fbf4176816ec1984"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga4e984caec69fa2faf55aa481afd92d56">udm_config_set_bus_powered</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mark a configuration as bus-powered.  <a href="group__usb__dev__mux.html#ga4e984caec69fa2faf55aa481afd92d56"></a><br/></td></tr>
<tr><td colspan="2"><div class="groupHeader">USB String Descriptor Support</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp062edacc2ae12b10858c113258171028"></a> The following functions may be used by the application to implement support for USB string descriptors. Such descriptors are optional according to the USB spec, so by default, all string descriptor requests are rejected.</p>
<p>To support string descriptors, the application must implement the function <a class="el" href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d" title="Application-specific hook for retrieving a USB String descriptor.">app_usb_get_string_descriptor()</a> and provide a preprocessor define named <code>HAVE_APP_USB_GET_STRING_DESCRIPTOR</code> (which will disable the default implementation). </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#gad6724e2a44b60605562e1b9e17717fbb">udm_submit_utf16le_string_desc</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__request.html">usb_request</a> *req, const <a class="el" href="types_8h.html#a467964c91885f34b69185f7356842d70">le16_t</a> *str, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> max_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a string descriptor buffer initialized from a UTF-16LE encoded string.  <a href="group__usb__dev__mux.html#gad6724e2a44b60605562e1b9e17717fbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga0cc47e29580273c6b6431ef287bdec51">udm_submit_ascii_string_desc</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__request.html">usb_request</a> *req, const char *str, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> max_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a string descriptor buffer initialized from an 8-bit ASCII encoded string.  <a href="group__usb__dev__mux.html#ga0cc47e29580273c6b6431ef287bdec51"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d">app_usb_get_string_descriptor</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__request.html">usb_request</a> *req, <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> index, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> langid, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Application-specific hook for retrieving a USB String descriptor.  <a href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>USB device multiplexing layer. </p>
<p>This file implements a glue layer for easier device interface driver implementation, and for supporting multiple configurations and/or interfaces provided by separate drivers.</p>
<p>Copyright (C) 2009 Atmel Corporation. All rights reserved. </p>

<p>Definition in file <a class="el" href="dev__mux_8c_source.html">dev_mux.c</a>.</p>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:34 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
