<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: Internal Interrupt Processing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Internal Interrupt Processing</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__intc__group.html#ga4f2ab9f2c27790a07d35d81fb9e917ad">INTC_DEFINE_HANDLER</a>(id, handler, level)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define an interrupt handler for an integrated peripheral.  <a href="#ga4f2ab9f2c27790a07d35d81fb9e917ad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__intc__group.html#gaeb8a9866fda25b743cddaf7a567e8662">intc_set_irq_data</a>(id, data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Associate a data pointer with an interrupt.  <a href="#gaeb8a9866fda25b743cddaf7a567e8662"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__intc__group.html#ga89ea1f1149ecfa17c5bfe89208640e2a">intc_get_irq_data</a>(id, pdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the data pointer associated with an interrupt.  <a href="#ga89ea1f1149ecfa17c5bfe89208640e2a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__intc__group.html#ga4b818bc80ff7d5822c645b002943b644">intc_setup_handler</a>(id, level, data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set up an interrupt handler.  <a href="#ga4b818bc80ff7d5822c645b002943b644"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__intc__group.html#gad6f70625e5802e2b2ba396c5b2d82d35">intc_remove_handler</a>(id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove an interrupt handler.  <a href="#gad6f70625e5802e2b2ba396c5b2d82d35"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This module includes functionality to help setting up interrupt handlers for internal (on-chip) interrupts. Such interrupts are generated by chip-internal modules and usually have a very direct path to the interrupt handler in order to minimize interrupt latency.</p>
<p>There may be minor differences between architectures, but in general, handlers for internal interrupts are set up in two steps:</p>
<ul>
<li>Define a function as an interrupt handler, which provides the necessary build-time linkage to the low-level entry points. This is done by the <a class="el" href="group__intc__group.html#ga4f2ab9f2c27790a07d35d81fb9e917ad" title="Define an interrupt handler for an integrated peripheral.">INTC_DEFINE_HANDLER()</a> macro.</li>
<li>Tell the interrupt controller to call the handler when certain interrupts are triggered. This must be done at run-time; though it is not always necessary to do any hardware configuration, the functions should be called on all architectures in order to keep the interface similar. This is done by calling <a class="el" href="group__intc__group.html#ga4b818bc80ff7d5822c645b002943b644" title="Set up an interrupt handler.">intc_setup_handler()</a>, which will evaluate to nothing (not even a function call) if nothing needs to be done.</li>
</ul>
<p>Interrupt numbers are specified correspond to the vector number on AVR, and the interrupt group number on AVR32. An AVR32-specific function, intc_get_group_requests(), can be used to distinguish between multiple interrupts inside of a group. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga4f2ab9f2c27790a07d35d81fb9e917ad"></a><!-- doxytag: member="intc.h::INTC_DEFINE_HANDLER" ref="ga4f2ab9f2c27790a07d35d81fb9e917ad" args="(id, handler, level)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INTC_DEFINE_HANDLER</td>
          <td>(</td>
          <td class="paramtype">id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">handler, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">level&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keyword">extern</span> <span class="keywordtype">void</span> *intc_priv_data_sym(<span class="keywordtype">id</span>);            \
        <span class="keyword">extern</span> <span class="keywordtype">void</span> __attribute__((__signal__))         \
                        intc_priv_entry_sym(<span class="keywordtype">id</span>)(void);  \
        <span class="keywordtype">void</span> intc_priv_entry_sym(<span class="keywordtype">id</span>)(void)              \
        {                                               \
                handler(intc_priv_data_sym(<span class="keywordtype">id</span>));        \
        }                                               \
        <span class="keywordtype">void</span> *intc_priv_data_sym(<span class="keywordtype">id</span>)
</pre></div>
<p>Define an interrupt handler for an integrated peripheral. </p>
<p>This binds an interrupt handler function to a low-level entry point, which takes care of saving/restoring registers, finding the handler-specific data, and running any code dealing with soft interrupt handling, etc. before returning.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This is not a function-like macro; it should not be called from within functions. Instead, it should be invoked at the top level right after the definition of the interrupt handler function.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>The interrupt vector ID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>handler</em>&nbsp;</td><td>The interrupt handler function </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>level</em>&nbsp;</td><td>The priority level of this interrupt </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html#l00054">54</a> of file <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html">intc.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga89ea1f1149ecfa17c5bfe89208640e2a"></a><!-- doxytag: member="intc.h::intc_get_irq_data" ref="ga89ea1f1149ecfa17c5bfe89208640e2a" args="(id, pdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define intc_get_irq_data</td>
          <td>(</td>
          <td class="paramtype">id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pdata&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                            \
                <span class="keyword">extern</span> <span class="keywordtype">void</span> *intc_priv_data_sym(<span class="keywordtype">id</span>);    \
                *(pdata) = intc_priv_data_sym(<span class="keywordtype">id</span>);      \
        } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Get the data pointer associated with an interrupt. </p>
<p>If the value stored in <em>*pdata</em> is NULL, no interrupt handler has been set up for interrupt <em>id</em>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>The interrupt ID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pdata</em>&nbsp;</td><td>Pointer to a variable in which to store the data pointer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html#l00084">84</a> of file <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html">intc.h</a>.</p>

</div>
</div>
<a class="anchor" id="gad6f70625e5802e2b2ba396c5b2d82d35"></a><!-- doxytag: member="intc.h::intc_remove_handler" ref="gad6f70625e5802e2b2ba396c5b2d82d35" args="(id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define intc_remove_handler</td>
          <td>(</td>
          <td class="paramtype">id&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                            \
                <span class="keyword">extern</span> <span class="keywordtype">void</span> *intc_priv_data_sym(<span class="keywordtype">id</span>);    \
                intc_priv_data_sym(<span class="keywordtype">id</span>) = 0;             \
        } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Remove an interrupt handler. </p>
<p>This will remove a registered interrupt handler, making it possible to set up a different one by calling <a class="el" href="group__intc__group.html#ga4b818bc80ff7d5822c645b002943b644" title="Set up an interrupt handler.">intc_setup_handler()</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function doesn't actually reprogram the interrupt controller; it just makes it possible to register a different handler for this interrupt later.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>The interrupt ID to disassociate with the handler </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html#l00095">95</a> of file <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html">intc.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaeb8a9866fda25b743cddaf7a567e8662"></a><!-- doxytag: member="intc.h::intc_set_irq_data" ref="gaeb8a9866fda25b743cddaf7a567e8662" args="(id, data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define intc_set_irq_data</td>
          <td>(</td>
          <td class="paramtype">id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                            \
                <span class="keyword">extern</span> <span class="keywordtype">void</span> *intc_priv_data_sym(<span class="keywordtype">id</span>);    \
                intc_priv_data_sym(<span class="keywordtype">id</span>) = (data);        \
        } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Associate a data pointer with an interrupt. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>The interrupt ID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Data to be associated with the interrupt </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html#l00078">78</a> of file <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html">intc.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga4b818bc80ff7d5822c645b002943b644"></a><!-- doxytag: member="intc.h::intc_setup_handler" ref="ga4b818bc80ff7d5822c645b002943b644" args="(id, level, data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define intc_setup_handler</td>
          <td>(</td>
          <td class="paramtype">id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">level, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                            \
                <a class="code" href="group__intc__group.html#gaeb8a9866fda25b743cddaf7a567e8662" title="Associate a data pointer with an interrupt.">intc_set_irq_data</a>(<span class="keywordtype">id</span>, data);            \
        } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Set up an interrupt handler. </p>
<p>This function sets up the internal interrupt controller for handling a given interrupt through the specified handler.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Usually, this is the only reference to the handler function and associated low-level entry code. This means that it is perfectly ok to define handlers for more interrupts than needed -- if they aren't actually enabled by calling this function, they will get discarded at link-time when --gc-sections is used.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>The interrupt number to associate with the handler </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>level</em>&nbsp;</td><td>The priority level for this interrupt </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Data to be associated with this interrupt</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>A handler for this interrupt has not already been set up. </dd></dl>

<p>Definition at line <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html#l00090">90</a> of file <a class="el" href="arch_2avr8_2include_2arch_2intc_8h_source.html">intc.h</a>.</p>

<p>Referenced by <a class="el" href="at90usb__core_8c_source.html#l00336">at90usb_init()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:35 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
