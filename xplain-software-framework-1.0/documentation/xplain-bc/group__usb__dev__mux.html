<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: USB Device Multiplexer (UDM)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>USB Device Multiplexer (UDM)<br/>
<small>
[<a class="el" href="group__usb__device__group.html">USB Device Framework</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for USB Device Multiplexer (UDM):</div>
<div class="dynsection">
<center><table><tr><td><img src="group__usb__dev__mux.png" border="0" alt="" usemap="#group____usb____dev____mux_map"/>
<map name="group____usb____dev____mux_map" id="group____usb____dev____mux">
<area shape="rect" href="group__usb__device__group.html" title="USB Device Framework" alt="" coords="5,5,165,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structudm__interface.html">udm_interface</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A USB device interface.  <a href="structudm__interface.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structudm__config.html">udm_config</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A USB device configuration.  <a href="structudm__config.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Configuration Management</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrpa4934331bbf896399132d3d20f141ef3"></a> The following functions may be called by the application to create configurations and associate interfaces with them. The interface objects are typically returned by the initialization function of a USB Device Interface Driver.</p>
<p><a class="el" href="group__usb__dev__mux.html#gaa323d6f0a542bd5e611634e89d0852b8" title="Create a new USB device configuration.">udm_create_config()</a> returns a configuration object which can be passed as a parameter to the other configuration management functions. The configuration descriptor is managed by the UDM layer, but the application may alter certain fields by calling <a class="el" href="group__usb__dev__mux.html#ga97ed794f81c25ad0fbf4176816ec1984" title="Mark a configuration as self-powered.">udm_config_set_self_powered()</a>, <a class="el" href="group__usb__dev__mux.html#ga4e984caec69fa2faf55aa481afd92d56" title="Mark a configuration as bus-powered.">udm_config_set_bus_powered()</a>, and <a class="el" href="group__usb__dev__mux.html#ga665de55fcf0adbbb1b12a8ddaa313f04" title="Set the maximum power consumption of a configuration.">udm_config_set_max_power()</a>. The application must not create more than one configuration with a given value, and it must not attempt to create more configurations than specified by APP_USB_DEVICE_NR_CONFIGS. </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga297f1a697e4aa8f4f8d450864b670165">udm_config_add_interface</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config, struct <a class="el" href="structudm__interface.html">udm_interface</a> *iface)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an interface to a configuration.  <a href="#ga297f1a697e4aa8f4f8d450864b670165"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structudm__config.html">udm_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#gaa323d6f0a542bd5e611634e89d0852b8">udm_create_config</a> (<a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> value, <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> nr_interfaces)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new USB device configuration.  <a href="#gaa323d6f0a542bd5e611634e89d0852b8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga665de55fcf0adbbb1b12a8ddaa313f04">udm_config_set_max_power</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config, unsigned int milliamps)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the maximum power consumption of a configuration.  <a href="#ga665de55fcf0adbbb1b12a8ddaa313f04"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga97ed794f81c25ad0fbf4176816ec1984">udm_config_set_self_powered</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mark a configuration as self-powered.  <a href="#ga97ed794f81c25ad0fbf4176816ec1984"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga4e984caec69fa2faf55aa481afd92d56">udm_config_set_bus_powered</a> (struct <a class="el" href="structudm__config.html">udm_config</a> *config)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mark a configuration as bus-powered.  <a href="#ga4e984caec69fa2faf55aa481afd92d56"></a><br/></td></tr>
<tr><td colspan="2"><h2>USB String Descriptor Support</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp062edacc2ae12b10858c113258171028"></a> The following functions may be used by the application to implement support for USB string descriptors. Such descriptors are optional according to the USB spec, so by default, all string descriptor requests are rejected.</p>
<p>To support string descriptors, the application must implement the function <a class="el" href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d" title="Application-specific hook for retrieving a USB String descriptor.">app_usb_get_string_descriptor()</a> and provide a preprocessor define named <code>HAVE_APP_USB_GET_STRING_DESCRIPTOR</code> (which will disable the default implementation). </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#gad6724e2a44b60605562e1b9e17717fbb">udm_submit_utf16le_string_desc</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__request.html">usb_request</a> *req, const <a class="el" href="types_8h.html#a467964c91885f34b69185f7356842d70">le16_t</a> *str, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> max_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a string descriptor buffer initialized from a UTF-16LE encoded string.  <a href="#gad6724e2a44b60605562e1b9e17717fbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga0cc47e29580273c6b6431ef287bdec51">udm_submit_ascii_string_desc</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__request.html">usb_request</a> *req, const char *str, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> max_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a string descriptor buffer initialized from an 8-bit ASCII encoded string.  <a href="#ga0cc47e29580273c6b6431ef287bdec51"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d">app_usb_get_string_descriptor</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__request.html">usb_request</a> *req, <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> index, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> langid, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Application-specific hook for retrieving a USB String descriptor.  <a href="#ga20b4a9a7aedc6b7c1748b2a5dc9a809d"></a><br/></td></tr>
<tr><td colspan="2"><h2>USB Device Strings</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9b5b896e574ca6f548351ea8a5cece21"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#gafa76f709eeccc9eaf1d3ba187a418c92">USB_STRING_DEV_PRODUCT</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">String ID representing the name of the product.  <a href="#gafa76f709eeccc9eaf1d3ba187a418c92"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__mux.html#ga47ed81085d545acb4ac8ab054959a44b">USB_STRING_DEV_SERIAL</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">String ID representing the serial number of the device.  <a href="#ga47ed81085d545acb4ac8ab054959a44b"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The USB Device Multiplexer (UDM) keeps track of configurations, interfaces and settings, and switches between them based on requests received from the host.</p>
<p>A USB device can have one or more configurations, which the host can choose between using the standard Set Configuration request. The host can also choose not to enable any configuration by selecting the special configuration ID 0. Each configuration can have one or more interfaces, which are all active at the same time. Each interface can have one or more alternate settings which the host can choose between using the standard Set Interface request.</p>
<h2><a class="anchor" id="udm-device-descriptor">
The Device Descriptor</a></h2>
<p>The USB Device Multiplexer provides a Device Descriptor for the device. The contents of this can be specified by defining the following macros in <a class="el" href="usb_8h.html" title="Application-specific USB configuration.">app/usb.h</a>. Please see the USB Specification for more information about the meaning of the fields.</p>
<ul>
<li>APP_USB_DEVICE_CLASS: bDeviceClass</li>
<li>APP_USB_DEVICE_SUBCLASS: bDeviceSubClass</li>
<li>APP_USB_DEVICE_PROTOCOL: bDeviceProtocol</li>
<li>APP_UDC_MAXPACKETSIZE0: bMaxPacketSize0 (also used by UDC driver)</li>
<li>APP_USB_DEVICE_VENDOR_ID: idVendor</li>
<li><a class="el" href="usb_8h.html#aefa62b25013c5c89e539fb93bd7c66b4">APP_USB_DEVICE_PRODUCT_ID</a>: idProduct</li>
<li>APP_USB_DEVICE_MAJOR_VERSION / APP_USB_DEVICE_MINOR_VERSION: bcdDevice</li>
<li>APP_USB_DEVICE_NR_CONFIGS: bNumConfigurations</li>
</ul>
<h3><a class="anchor" id="udm-device-desc-strings">
Strings in the Device Descriptor</a></h3>
<p>The application may define the following string IDs (and add support for string descriptors as explained below) to allow the host to display user-friendly strings whenever the device is connected:</p>
<ul>
<li>USB_STRING_DEV_MANUFACTURER: iManufacturer</li>
<li><a class="el" href="group__usb__dev__mux.html#gafa76f709eeccc9eaf1d3ba187a418c92" title="String ID representing the name of the product.">USB_STRING_DEV_PRODUCT</a>: iProduct</li>
<li><a class="el" href="group__usb__dev__mux.html#ga47ed81085d545acb4ac8ab054959a44b" title="String ID representing the serial number of the device.">USB_STRING_DEV_SERIAL</a>: iSerialNumber</li>
</ul>
<h2><a class="anchor" id="udm-string-desc">
USB String Descriptor Support</a></h2>
<p>The following example illustrates how to implement support for string descriptors in an application. Note that the value passed in the <em>langid</em> parameter is in native byte order, not little endian.</p>
<dl class="user"><dt><b>apps/foo/main.c (or somewhere else)</b></dt><dd><div class="fragment"><pre class="fragment"> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="types_8h.html#a467964c91885f34b69185f7356842d70" title="Unsigned 16-bit quantity, little endian byte order.">le16_t</a> langid_str[] = {
        <a class="code" href="group__byte__order__group.html#ga54d648861a1120a3f8d6255e9cf54125" title="Create a 16-bit little endian constant.">LE16</a>(<a class="code" href="group__usb__protocol__group.html#gga1f92deaf695c06566999f0c5343978c1a8acad914e2d28c9bb1d2d3cc74c5b39e" title="English (United States).">USB_LANGID_EN_US</a>),
        <a class="code" href="group__byte__order__group.html#ga54d648861a1120a3f8d6255e9cf54125" title="Create a 16-bit little endian constant.">LE16</a>(0),        <span class="comment">// Terminate the list</span>
 };
 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *string_table[] = {
        NULL,           <span class="comment">// LANGID</span>
        <span class="stringliteral">&quot;This is my device&quot;</span>,
 };

 <span class="keywordtype">int</span> <a class="code" href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d" title="Application-specific hook for retrieving a USB String descriptor.">app_usb_get_string_descriptor</a>(<span class="keyword">struct</span> <a class="code" href="structudc.html" title="A USB Device Controller.">udc</a> *<a class="code" href="structudc.html" title="A USB Device Controller.">udc</a>,
                <span class="keyword">struct</span> <a class="code" href="structusb__request.html" title="A USB request.">usb_request</a> *req, <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> index,
                <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a> langid, <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a> len)
 {
        <span class="keywordflow">if</span> (index &gt;= <a class="code" href="group__utility__group.html#gab9129b977a587b50ea801daac75e178f" title="Get the number of elements in array a.">ARRAY_LEN</a>(string_table))
                <span class="keywordflow">return</span> <a class="code" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a70aa759d292a0e4be7123d01959357da" title="Invalid argument.">ERR_INVALID_ARG</a>;
        <span class="keywordflow">if</span> (index != 0 &amp;&amp; langid != <a class="code" href="group__usb__protocol__group.html#gga1f92deaf695c06566999f0c5343978c1a8acad914e2d28c9bb1d2d3cc74c5b39e" title="English (United States).">USB_LANGID_EN_US</a>)
                <span class="keywordflow">return</span> <a class="code" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a70aa759d292a0e4be7123d01959357da" title="Invalid argument.">ERR_INVALID_ARG</a>;

        <span class="keywordflow">if</span> (index == 0)
                <span class="keywordflow">return</span> <a class="code" href="group__usb__dev__mux.html#gad6724e2a44b60605562e1b9e17717fbb" title="Add a string descriptor buffer initialized from a UTF-16LE encoded string.">udm_submit_utf16le_string_desc</a>(udc, req,
                        langid_str, len);

        <span class="keywordflow">return</span> <a class="code" href="group__usb__dev__mux.html#ga0cc47e29580273c6b6431ef287bdec51" title="Add a string descriptor buffer initialized from an 8-bit ASCII encoded string.">udm_submit_ascii_string_desc</a>(udc, req,
                string_table[index], len);
 }
</pre></div></dd></dl>
<dl class="user"><dt><b>apps/foo/include/app/usb.h</b></dt><dd><div class="fragment"><pre class="fragment"> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="group__usb__dev__mux.html#ga20b4a9a7aedc6b7c1748b2a5dc9a809d" title="Application-specific hook for retrieving a USB String descriptor.">app_usb_get_string_descriptor</a>(<span class="keyword">struct</span> udc *udc,
                <span class="keyword">struct</span> <a class="code" href="structusb__request.html" title="A USB request.">usb_request</a> *req, <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> index,
                <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a> langid, <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a> len);
<span class="preprocessor"> #define HAVE_APP_USB_GET_STRING_DESCRIPTOR</span>
</pre></div></dd></dl>
<h2><a class="anchor" id="udi-driver">
USB Device Interface (UDI) drivers</a></h2>
<p>An interface is represented by an instance of struct <a class="el" href="structudm__interface.html" title="A USB device interface.">udm_interface</a>, implemented by a USB Device Interface (UDI) driver. The UDM layer dispatches various requests received from the host to the UDI driver through the function pointers in that structure.</p>
<p>When an interface setting has been enabled, the driver may interact directly with the UDC driver, managing endpoints and submitting requests on them. The UDI driver may only submit control transfers when it is processing a SETUP request directed at its interface.</p>
<p>Note that the function driver must never keep any endpoints active after <a class="el" href="structudm__interface.html#a03b2e2027da9c64763becfb188d6b4c6" title="Disable the interface.">udm_interface::disable()</a> has been called. When the host re-selects the currently active interface setting using Set Interface, the UDM will call <a class="el" href="structudm__interface.html#ac5955f73bfd920b0959a5ed5cd490f69" title="Enable the interface.">udm_interface::enable()</a>. The UDI driver is responsible for disabling and re-enabling itself when <a class="el" href="structudm__interface.html#ac5955f73bfd920b0959a5ed5cd490f69" title="Enable the interface.">udm_interface::enable()</a> is called and the interface is already active. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="gafa76f709eeccc9eaf1d3ba187a418c92"></a><!-- doxytag: member="dev_mux.c::USB_STRING_DEV_PRODUCT" ref="gafa76f709eeccc9eaf1d3ba187a418c92" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_STRING_DEV_PRODUCT&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>String ID representing the name of the product. </p>
<p>The value of this define is stored in the iProduct field of the device and device qualifier descriptors. </p>

<p>Definition at line <a class="el" href="dev__mux_8c_source.html#l00194">194</a> of file <a class="el" href="dev__mux_8c_source.html">dev_mux.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga47ed81085d545acb4ac8ab054959a44b"></a><!-- doxytag: member="dev_mux.c::USB_STRING_DEV_SERIAL" ref="ga47ed81085d545acb4ac8ab054959a44b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USB_STRING_DEV_SERIAL&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>String ID representing the serial number of the device. </p>
<p>The value of this define is stored in the iSerialNumber field of the device and device qualifier descriptors. </p>

<p>Definition at line <a class="el" href="dev__mux_8c_source.html#l00197">197</a> of file <a class="el" href="dev__mux_8c_source.html">dev_mux.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga20b4a9a7aedc6b7c1748b2a5dc9a809d"></a><!-- doxytag: member="dev_mux.c::app_usb_get_string_descriptor" ref="ga20b4a9a7aedc6b7c1748b2a5dc9a809d" args="(struct udc *udc, struct usb_request *req, uint8_t index, uint16_t langid, uint16_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int app_usb_get_string_descriptor </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structusb__request.html">usb_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>langid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Application-specific hook for retrieving a USB String descriptor. </p>
<p>The default implementation of this hook will reject all string descriptor requests. If an application needs to support string descriptors, it must implement this function and define the preprocessor symbol <code>HAVE_APP_USB_GET_STRING_DESCRIPTOR</code>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>The USB Device Controller </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>The USB request which will be used to send the descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>index</em>&nbsp;</td><td>The index of the requested string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>langid</em>&nbsp;</td><td>The requested language ID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>The maximum number of bytes in the response</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of bytes added to <em>req</em> or a negative error code on failure. </dd></dl>

<p>Definition at line <a class="el" href="dev__mux_8c_source.html#l00587">587</a> of file <a class="el" href="dev__mux_8c_source.html">dev_mux.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga297f1a697e4aa8f4f8d450864b670165"></a><!-- doxytag: member="dev_mux.c::udm_config_add_interface" ref="ga297f1a697e4aa8f4f8d450864b670165" args="(struct udm_config *config, struct udm_interface *iface)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void udm_config_add_interface </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudm__config.html">udm_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structudm__interface.html">udm_interface</a> *&nbsp;</td>
          <td class="paramname"> <em>iface</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add an interface to a configuration. </p>
<p>This function will associate an interface with an existing configuration so that it will be automatically enabled when the configuration is selected, and the interface descriptor(s) will be included in the configuration descriptor for this configuration.</p>
<p>If no high-speed descriptors are provided, they will be assumed to be the same as the full-speed descriptors.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>The USB function configuration. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>The interface to be added to <em>config</em>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd><ul>
<li><em>iface</em> must have at least one alternate setting.</li>
<li><em>iface</em> must have a bInterfaceNumber less than bNumInterfaces of <em>config</em>.</li>
<li>An interface with the same bInterfaceNumber must not have been registered before to the same configuration.</li>
<li>All settings must have the same bInterfaceNumber.</li>
<li>Each setting's high-speed descriptor, if present, must have the same bInterfaceNumber as the full-speed descriptor. </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="apps_2xplain-bc_2dataflash_8c_source.html#l00051">dataflash_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4e984caec69fa2faf55aa481afd92d56"></a><!-- doxytag: member="dev_mux.c::udm_config_set_bus_powered" ref="ga4e984caec69fa2faf55aa481afd92d56" args="(struct udm_config *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void udm_config_set_bus_powered </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudm__config.html">udm_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mark a configuration as bus-powered. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>A USB device configuration </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="apps_2xplain-bc_2dataflash_8c_source.html#l00051">dataflash_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga665de55fcf0adbbb1b12a8ddaa313f04"></a><!-- doxytag: member="dev_mux.c::udm_config_set_max_power" ref="ga665de55fcf0adbbb1b12a8ddaa313f04" args="(struct udm_config *config, unsigned int milliamps)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void udm_config_set_max_power </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudm__config.html">udm_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>milliamps</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the maximum power consumption of a configuration. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>A USB device configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>milliamps</em>&nbsp;</td><td>The new maximum power consumption in milliamperes </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="apps_2xplain-bc_2dataflash_8c_source.html#l00051">dataflash_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga97ed794f81c25ad0fbf4176816ec1984"></a><!-- doxytag: member="dev_mux.c::udm_config_set_self_powered" ref="ga97ed794f81c25ad0fbf4176816ec1984" args="(struct udm_config *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void udm_config_set_self_powered </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudm__config.html">udm_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mark a configuration as self-powered. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>A USB device configuration </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaa323d6f0a542bd5e611634e89d0852b8"></a><!-- doxytag: member="dev_mux.c::udm_create_config" ref="gaa323d6f0a542bd5e611634e89d0852b8" args="(uint8_t value, uint8_t nr_interfaces)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structudm__config.html">udm_config</a> * udm_create_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>nr_interfaces</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new USB device configuration. </p>
<p>This function will create a new configuration and add it to the array of possible configurations of the device.</p>
<p>Initially, the configuration will be marked as self-powered and drawing 4 mA from the bus.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>The value used to select this configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nr_interfaces</em>&nbsp;</td><td>The number of interfaces in this configuration</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An object representing the new configuration.</dd></dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd><ul>
<li><em>value</em> is not zero (this configuration value is reserved for representing no active configuration.)</li>
<li><em>value</em> is not higher than APP_USB_DEVICE_NR_CONFIGS</li>
<li>No configuration with the same <em>value</em> has been registered before. </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="apps_2xplain-bc_2dataflash_8c_source.html#l00051">dataflash_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga0cc47e29580273c6b6431ef287bdec51"></a><!-- doxytag: member="dev_mux.c::udm_submit_ascii_string_desc" ref="ga0cc47e29580273c6b6431ef287bdec51" args="(struct udc *udc, struct usb_request *req, const char *str, uint16_t max_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udm_submit_ascii_string_desc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structusb__request.html">usb_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>max_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a string descriptor buffer initialized from an 8-bit ASCII encoded string. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>The USB Device Controller </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>The USB request to which the buffer should be added </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>A ASCII encoded NUL-terminated string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>max_len</em>&nbsp;</td><td>Maximum number of bytes available for the descriptor</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of bytes actually queued, or a negative error code on failure. </dd></dl>

</div>
</div>
<a class="anchor" id="gad6724e2a44b60605562e1b9e17717fbb"></a><!-- doxytag: member="dev_mux.c::udm_submit_utf16le_string_desc" ref="gad6724e2a44b60605562e1b9e17717fbb" args="(struct udc *udc, struct usb_request *req, const le16_t *str, uint16_t max_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udm_submit_utf16le_string_desc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structusb__request.html">usb_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#a467964c91885f34b69185f7356842d70">le16_t</a> *&nbsp;</td>
          <td class="paramname"> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>max_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a string descriptor buffer initialized from a UTF-16LE encoded string. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>The USB Device Controller </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>The USB request to which the buffer should be added </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>A UTF-16 LE encoded NUL-terminated string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>max_len</em>&nbsp;</td><td>Maximum number of bytes available for the descriptor</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of bytes actually queued, or a negative error code on failure. </dd></dl>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:34 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
