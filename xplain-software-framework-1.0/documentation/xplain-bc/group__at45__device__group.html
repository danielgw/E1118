<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: AT45 DataFlash Device Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>AT45 DataFlash Device Driver</h1>
<p><div class="dynheader">
Collaboration diagram for AT45 DataFlash Device Driver:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__at45__device__group.png" border="0" alt="" usemap="#group____at45____device____group_map"/>
<map name="group____at45____device____group_map" id="group____at45____device____group">
<area shape="rect" href="group__at45__device__internals__group.html" title="AT45 device driver internals" alt="" coords="252,5,433,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structat45__device.html">at45_device</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">AT45 DataFlash device.  <a href="structat45__device.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__internals__group.html">AT45 device driver internals</a></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef bool(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga8ec6404dddae8a8afde20e0b1548293c">at45_next_call_t</a> )(struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga399702e2c9d82f2bf11fb153464d1b09">at45_device_flag</a> { <a class="el" href="group__at45__device__group.html#gga399702e2c9d82f2bf11fb153464d1b09aaa3e22cc3dd8231c8e1e39f6b91e6f77">AT45_FLAG_VALID</a>, 
<a class="el" href="group__at45__device__group.html#gga399702e2c9d82f2bf11fb153464d1b09a5a2710dcafb19ca70be4a2fee13b1809">AT45_FLAG_PROTECTED</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>AT45 device flags. </p>
 <a href="group__at45__device__group.html#ga399702e2c9d82f2bf11fb153464d1b09">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gabafbdb27b90d1184865d9d29a9cb90a6">at45_wait_ready</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Actively wait for AT45 device to be ready.  <a href="#gabafbdb27b90d1184865d9d29a9cb90a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga9d7636f22593ed665c57b03447ed5f61">at45_identify</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Identify AT45 device.  <a href="#ga9d7636f22593ed665c57b03447ed5f61"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga95fdc6b4c4c4290340e279ad926ea59f">at45_device_init</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__spi__mega__internal__group.html#ga59eca0ea1cb53b57e414dbadee990e1e">spi_id_t</a> spi_id, struct <a class="el" href="structspi__master.html">spi_master</a> *spim, struct <a class="el" href="structspi__device.html">spi_device</a> *spid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize AT45 struct.  <a href="#ga95fdc6b4c4c4290340e279ad926ea59f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gacf61055777a5db5284b3cdc3226dbd05">at45_request</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, struct <a class="el" href="structworkqueue__task.html">workqueue_task</a> *task)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request exclusive access to AT45 device.  <a href="#gacf61055777a5db5284b3cdc3226dbd05"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gac00f784a9b33e954436f476d72b46533">at45_release</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release exclusive access to AT45 device.  <a href="#gac00f784a9b33e954436f476d72b46533"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga3d95f27343b2fd462ba8f36fc1b4ceb8">at45_select</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Select AT45 device (Chip select).  <a href="#ga3d95f27343b2fd462ba8f36fc1b4ceb8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga87ed992a0661dc92ba848d296e3b85e4">at45_deselect</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">De-select AT45 device (Chip de-select).  <a href="#ga87ed992a0661dc92ba848d296e3b85e4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga59fca128237b98d70db53c8afc9bc345">at45_write_cmd</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write command and other opcodes to AT45 device.  <a href="#ga59fca128237b98d70db53c8afc9bc345"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga65aaeff7e0d8f50cafa8c45bb09ba58e">at45_read_rsp</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read response from AT45 device.  <a href="#ga65aaeff7e0d8f50cafa8c45bb09ba58e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga6aa10d04f790079d7d89d090528d7122">at45_cmd_read_status_reg</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write AT45 device command: read status register.  <a href="#ga6aa10d04f790079d7d89d090528d7122"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gaf7754d0a7eeae5f8fffd2c305f52fe89">at45_cmd_read_id</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write AT45 device command: read ID.  <a href="#gaf7754d0a7eeae5f8fffd2c305f52fe89"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gaf4daf5946660b9188800ecd6bac79f16">at45_cmd_cont_array_read</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> page, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> pos)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write AT45 device command: continous array read.  <a href="#gaf4daf5946660b9188800ecd6bac79f16"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga4a61c7aa3618ad4364c85b155b962bc1">at45_cmd_buffer_1_write</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> pos)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write AT45 device command: buffer 1 write.  <a href="#ga4a61c7aa3618ad4364c85b155b962bc1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga685aefa8fa2fefb33efb4ab5514e6eb8">at45_cmd_main_memory_to_buffer_1_transfer</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> page)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write AT45 device command: main memory to buffer 1 transfer.  <a href="#ga685aefa8fa2fefb33efb4ab5514e6eb8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga851af42756c18987d9c136e6a0b432fd">at45_cmd_buffer_1_main_memory_program_with_erase</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> page)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write AT45 device command: buffer 1 main memory program with erase.  <a href="#ga851af42756c18987d9c136e6a0b432fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gaac455ed7e90213b411d69fdd0bffd81e">at45_read_buf_list</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, struct <a class="el" href="structslist.html">slist</a> *buf_list)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read from AT45 device into buffer list.  <a href="#gaac455ed7e90213b411d69fdd0bffd81e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#gaf9f6a1db0bef53cd79b1736083901af6">at45_write_buf_list</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d, struct <a class="el" href="structslist.html">slist</a> *buf_list)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write from buffer list into AT45 device.  <a href="#gaf9f6a1db0bef53cd79b1736083901af6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga7d4524257c680f42724c8a915cd10cb4">at45_rsp_status_is_ready</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Test if AT45 device status register bit is set to ready.  <a href="#ga7d4524257c680f42724c8a915cd10cb4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__at45__device__group.html#ga4ebee58017e141135223e64fdc0fabac">at45_rsp_status_is_protected</a> (struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Test if AT45 device status register bit is set to protected.  <a href="#ga4ebee58017e141135223e64fdc0fabac"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is a driver for AT45 DataFlash devices.</p>
<p>It's initalized by <a class="el" href="group__at45__device__group.html#ga95fdc6b4c4c4290340e279ad926ea59f" title="Initialize AT45 struct.">at45_device_init()</a> with a pre-allocated <a class="el" href="structat45__device.html" title="AT45 DataFlash device.">at45_device</a> and SPI ID, master and device references.</p>
<p>Exclusive access is requested with <a class="el" href="group__at45__device__group.html#gacf61055777a5db5284b3cdc3226dbd05" title="Request exclusive access to AT45 device.">at45_request()</a>, and on access granted the supplied <a class="el" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> is scheduled to run and it's possible to call different access methods. These access methods can initiate some driver action which will re-schedule the task when ready.</p>
<p>Exclusive access must be ended with <a class="el" href="group__at45__device__group.html#gac00f784a9b33e954436f476d72b46533" title="Release exclusive access to AT45 device.">at45_release()</a>. And this will start any other pending requests, or set it available. </p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga8ec6404dddae8a8afde20e0b1548293c"></a><!-- doxytag: member="at45_device.h::at45_next_call_t" ref="ga8ec6404dddae8a8afde20e0b1548293c" args=")(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef bool(* <a class="el" href="group__at45__device__group.html#ga8ec6404dddae8a8afde20e0b1548293c">at45_next_call_t</a>)(struct <a class="el" href="structat45__device.html">at45_device</a> *at45d)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><b>For internal use only.</b></p>
<p>Next function definition for chained calls </p>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00075">75</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ga399702e2c9d82f2bf11fb153464d1b09"></a><!-- doxytag: member="at45_device.h::at45_device_flag" ref="ga399702e2c9d82f2bf11fb153464d1b09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__at45__device__group.html#ga399702e2c9d82f2bf11fb153464d1b09">at45_device_flag</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>AT45 device flags. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga399702e2c9d82f2bf11fb153464d1b09aaa3e22cc3dd8231c8e1e39f6b91e6f77"></a><!-- doxytag: member="AT45_FLAG_VALID" ref="gga399702e2c9d82f2bf11fb153464d1b09aaa3e22cc3dd8231c8e1e39f6b91e6f77" args="" -->AT45_FLAG_VALID</em>&nbsp;</td><td>
<p>Valid AT45 device detected. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga399702e2c9d82f2bf11fb153464d1b09a5a2710dcafb19ca70be4a2fee13b1809"></a><!-- doxytag: member="AT45_FLAG_PROTECTED" ref="gga399702e2c9d82f2bf11fb153464d1b09a5a2710dcafb19ca70be4a2fee13b1809" args="" -->AT45_FLAG_PROTECTED</em>&nbsp;</td><td>
<p>Device is protected from write operations. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00063">63</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga851af42756c18987d9c136e6a0b432fd"></a><!-- doxytag: member="at45_device.h::at45_cmd_buffer_1_main_memory_program_with_erase" ref="ga851af42756c18987d9c136e6a0b432fd" args="(struct at45_device *at45d, uint16_t page)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_cmd_buffer_1_main_memory_program_with_erase </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>page</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write AT45 device command: buffer 1 main memory program with erase. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>page</em>&nbsp;</td><td>Page address </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00294">294</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="at45_8h_source.html#l00110">AT45_CMD_BUFFER_1_MAIN_MEMORY_PROGRAM_WITH_ERASE</a>, <a class="el" href="at45_8h_source.html#l00128">AT45_PAGE_ADDR_MASK</a>, <a class="el" href="at45__device_8h_source.html#l00167">at45_write_cmd()</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="ga4a61c7aa3618ad4364c85b155b962bc1"></a><!-- doxytag: member="at45_device.h::at45_cmd_buffer_1_write" ref="ga4a61c7aa3618ad4364c85b155b962bc1" args="(struct at45_device *at45d, uint16_t pos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_cmd_buffer_1_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>pos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write AT45 device command: buffer 1 write. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pos</em>&nbsp;</td><td>Position in page </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00253">253</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="at45_8h_source.html#l00112">AT45_CMD_BUFFER_1_WRITE</a>, <a class="el" href="at45_8h_source.html#l00131">AT45_PAGE_POS_MASK</a>, <a class="el" href="at45__device_8h_source.html#l00167">at45_write_cmd()</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="gaf4daf5946660b9188800ecd6bac79f16"></a><!-- doxytag: member="at45_device.h::at45_cmd_cont_array_read" ref="gaf4daf5946660b9188800ecd6bac79f16" args="(struct at45_device *at45d, uint16_t page, uint16_t pos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_cmd_cont_array_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>pos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write AT45 device command: continous array read. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>page</em>&nbsp;</td><td>Page address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pos</em>&nbsp;</td><td>Position in page </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00228">228</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="at45_8h_source.html#l00106">AT45_CMD_CONTINOUS_ARRAY_READ</a>, <a class="el" href="at45_8h_source.html#l00128">AT45_PAGE_ADDR_MASK</a>, <a class="el" href="at45_8h_source.html#l00131">AT45_PAGE_POS_MASK</a>, <a class="el" href="at45__device_8h_source.html#l00167">at45_write_cmd()</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="ga685aefa8fa2fefb33efb4ab5514e6eb8"></a><!-- doxytag: member="at45_device.h::at45_cmd_main_memory_to_buffer_1_transfer" ref="ga685aefa8fa2fefb33efb4ab5514e6eb8" args="(struct at45_device *at45d, uint16_t page)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_cmd_main_memory_to_buffer_1_transfer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>page</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write AT45 device command: main memory to buffer 1 transfer. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>page</em>&nbsp;</td><td>Page address </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00274">274</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="at45_8h_source.html#l00108">AT45_CMD_MAIN_MEMORY_TO_BUFFER_1_TRANSFER</a>, <a class="el" href="at45_8h_source.html#l00128">AT45_PAGE_ADDR_MASK</a>, <a class="el" href="at45__device_8h_source.html#l00167">at45_write_cmd()</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="gaf7754d0a7eeae5f8fffd2c305f52fe89"></a><!-- doxytag: member="at45_device.h::at45_cmd_read_id" ref="gaf7754d0a7eeae5f8fffd2c305f52fe89" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_cmd_read_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write AT45 device command: read ID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00213">213</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45_8h_source.html#l00114">AT45_CMD_READ_ID</a>, <a class="el" href="at45__device_8h_source.html#l00167">at45_write_cmd()</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="ga6aa10d04f790079d7d89d090528d7122"></a><!-- doxytag: member="at45_device.h::at45_cmd_read_status_reg" ref="ga6aa10d04f790079d7d89d090528d7122" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_cmd_read_status_reg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write AT45 device command: read status register. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00200">200</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45_8h_source.html#l00116">AT45_CMD_READ_STATUS_REG</a>, <a class="el" href="at45__device_8h_source.html#l00167">at45_write_cmd()</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="ga87ed992a0661dc92ba848d296e3b85e4"></a><!-- doxytag: member="at45_device.h::at45_deselect" ref="ga87ed992a0661dc92ba848d296e3b85e4" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_deselect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>De-select AT45 device (Chip de-select). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00150">150</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="spi__mega__xmega_8h_source.html#l00418">spi_deselect_device()</a>, <a class="el" href="at45__device_8h_source.html#l00084">at45_device::spi_id</a>, <a class="el" href="at45__device_8h_source.html#l00082">at45_device::spid</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

</div>
</div>
<a class="anchor" id="ga95fdc6b4c4c4290340e279ad926ea59f"></a><!-- doxytag: member="at45_device.c::at45_device_init" ref="ga95fdc6b4c4c4290340e279ad926ea59f" args="(struct at45_device *at45d, spi_id_t spi_id, struct spi_master *spim, struct spi_device *spid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void at45_device_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__spi__mega__internal__group.html#ga59eca0ea1cb53b57e414dbadee990e1e">spi_id_t</a>&nbsp;</td>
          <td class="paramname"> <em>spi_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structspi__master.html">spi_master</a> *&nbsp;</td>
          <td class="paramname"> <em>spim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structspi__device.html">spi_device</a> *&nbsp;</td>
          <td class="paramname"> <em>spid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize AT45 struct. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spi_id</em>&nbsp;</td><td><a class="el" href="group__spi__group.html#spi_module_id">SPI Module ID</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spim</em>&nbsp;</td><td>SPI master struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spid</em>&nbsp;</td><td>SPI device struct </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga9d7636f22593ed665c57b03447ed5f61"></a><!-- doxytag: member="at45_device.c::at45_identify" ref="ga9d7636f22593ed665c57b03447ed5f61" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool at45_identify </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Identify AT45 device. </p>
<p>Extract status and device ID from device and process it.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>Not done yet. The task supplied in at45_request will be resceduled when it's ready to be called again. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>Operation completed. Variables at45d::size, at45d::page_size and at45d::flags have now been populated. </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="drivers_2block_2dataflash_8c_source.html#l00586">dataflash_detect()</a>.</p>

</div>
</div>
<a class="anchor" id="gaac455ed7e90213b411d69fdd0bffd81e"></a><!-- doxytag: member="at45_device.h::at45_read_buf_list" ref="gaac455ed7e90213b411d69fdd0bffd81e" args="(struct at45_device *at45d, struct slist *buf_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_read_buf_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structslist.html">slist</a> *&nbsp;</td>
          <td class="paramname"> <em>buf_list</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read from AT45 device into buffer list. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf_list</em>&nbsp;</td><td>List of buffers </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00314">314</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45__device_8h_source.html#l00084">at45_device::spi_id</a>, <a class="el" href="spi__mega__xmega_8h_source.html#l00450">spi_read_buf_list()</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

</div>
</div>
<a class="anchor" id="ga65aaeff7e0d8f50cafa8c45bb09ba58e"></a><!-- doxytag: member="at45_device.h::at45_read_rsp" ref="ga65aaeff7e0d8f50cafa8c45bb09ba58e" args="(struct at45_device *at45d, uint8_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_read_rsp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read response from AT45 device. </p>
<p>This will read the response from the AT45 device into <a class="el" href="structat45__device.html#a360187fc50625e690e0e97d33efcbae0" title="Temporary storage for command and response.">at45_device::cmdrsp</a> .</p>
<p>When the response have been read the task will be rescheduled.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Size to be read </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00186">186</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>, <a class="el" href="at45__device_8h_source.html#l00084">at45_device::spi_id</a>, <a class="el" href="spi__mega__xmega_8h_source.html#l00432">spi_read()</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

</div>
</div>
<a class="anchor" id="gac00f784a9b33e954436f476d72b46533"></a><!-- doxytag: member="at45_device.h::at45_release" ref="gac00f784a9b33e954436f476d72b46533" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release exclusive access to AT45 device. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00126">126</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="include_2spi_8h_source.html#l00236">spi_release_bus()</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

</div>
</div>
<a class="anchor" id="gacf61055777a5db5284b3cdc3226dbd05"></a><!-- doxytag: member="at45_device.h::at45_request" ref="gacf61055777a5db5284b3cdc3226dbd05" args="(struct at45_device *at45d, struct workqueue_task *task)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structworkqueue__task.html">workqueue_task</a> *&nbsp;</td>
          <td class="paramname"> <em>task</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request exclusive access to AT45 device. </p>
<p>Once exclusive access is granted the <em>task</em> is scheduled to run.</p>
<p>Exclusive access must be ended with <a class="el" href="group__at45__device__group.html#gac00f784a9b33e954436f476d72b46533" title="Release exclusive access to AT45 device.">at45_release()</a> in order for other requests to be run.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>task</em>&nbsp;</td><td>Task to run when ready </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00113">113</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="include_2spi_8h_source.html#l00223">spi_request_bus()</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

<p>Referenced by <a class="el" href="drivers_2block_2dataflash_8c_source.html#l00504">dataflash_submit()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4ebee58017e141135223e64fdc0fabac"></a><!-- doxytag: member="at45_device.h::at45_rsp_status_is_protected" ref="ga4ebee58017e141135223e64fdc0fabac" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool at45_rsp_status_is_protected </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Test if AT45 device status register bit is set to protected. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Status register must have been read with at45_cmd_read_status_register first </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00353">353</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45_8h_source.html#l00122">AT45_STATUS_PROTECT</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="ga7d4524257c680f42724c8a915cd10cb4"></a><!-- doxytag: member="at45_device.h::at45_rsp_status_is_ready" ref="ga7d4524257c680f42724c8a915cd10cb4" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool at45_rsp_status_is_ready </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Test if AT45 device status register bit is set to ready. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Status register must have been read with at45_cmd_read_status_register first </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00341">341</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45_8h_source.html#l00124">AT45_STATUS_RDY</a>, and <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>.</p>

</div>
</div>
<a class="anchor" id="ga3d95f27343b2fd462ba8f36fc1b4ceb8"></a><!-- doxytag: member="at45_device.h::at45_select" ref="ga3d95f27343b2fd462ba8f36fc1b4ceb8" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_select </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Select AT45 device (Chip select). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00138">138</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45__device_8h_source.html#l00084">at45_device::spi_id</a>, <a class="el" href="spi__mega__xmega_8h_source.html#l00410">spi_select_device()</a>, <a class="el" href="at45__device_8h_source.html#l00082">at45_device::spid</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

</div>
</div>
<a class="anchor" id="gabafbdb27b90d1184865d9d29a9cb90a6"></a><!-- doxytag: member="at45_device.c::at45_wait_ready" ref="gabafbdb27b90d1184865d9d29a9cb90a6" args="(struct at45_device *at45d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool at45_wait_ready </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Actively wait for AT45 device to be ready. </p>
<p>This must be called over and overagain until it returns true.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>Not done yet. The task supplied in at45_request will be resceduled when it's ready to be called again. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>Operation completed. Variables size, page_size and flags in <em>at45</em> have now been populated. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaf9f6a1db0bef53cd79b1736083901af6"></a><!-- doxytag: member="at45_device.h::at45_write_buf_list" ref="gaf9f6a1db0bef53cd79b1736083901af6" args="(struct at45_device *at45d, struct slist *buf_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_write_buf_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structslist.html">slist</a> *&nbsp;</td>
          <td class="paramname"> <em>buf_list</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write from buffer list into AT45 device. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf_list</em>&nbsp;</td><td>List of buffers </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00328">328</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="at45__device_8h_source.html#l00084">at45_device::spi_id</a>, <a class="el" href="spi__mega__xmega_8h_source.html#l00444">spi_write_buf_list()</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

</div>
</div>
<a class="anchor" id="ga59fca128237b98d70db53c8afc9bc345"></a><!-- doxytag: member="at45_device.h::at45_write_cmd" ref="ga59fca128237b98d70db53c8afc9bc345" args="(struct at45_device *at45d, uint8_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void at45_write_cmd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structat45__device.html">at45_device</a> *&nbsp;</td>
          <td class="paramname"> <em>at45d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write command and other opcodes to AT45 device. </p>
<p>This will write the command from at45::cmdrsp to the AT45 device.</p>
<p>When the command have been written the task will be rescheduled.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>at45d</em>&nbsp;</td><td>AT45 device struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Size to be written </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Can only be called when exclusive access have been gained with at45_request </dd></dl>

<p>Definition at line <a class="el" href="at45__device_8h_source.html#l00167">167</a> of file <a class="el" href="at45__device_8h_source.html">at45_device.h</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="at45__device_8h_source.html#l00099">at45_device::cmdrsp</a>, <a class="el" href="at45__device_8h_source.html#l00084">at45_device::spi_id</a>, <a class="el" href="spi__mega__xmega_8h_source.html#l00426">spi_write()</a>, and <a class="el" href="at45__device_8h_source.html#l00080">at45_device::spim</a>.</p>

<p>Referenced by <a class="el" href="at45__device_8h_source.html#l00294">at45_cmd_buffer_1_main_memory_program_with_erase()</a>, <a class="el" href="at45__device_8h_source.html#l00253">at45_cmd_buffer_1_write()</a>, <a class="el" href="at45__device_8h_source.html#l00228">at45_cmd_cont_array_read()</a>, <a class="el" href="at45__device_8h_source.html#l00274">at45_cmd_main_memory_to_buffer_1_transfer()</a>, <a class="el" href="at45__device_8h_source.html#l00213">at45_cmd_read_id()</a>, and <a class="el" href="at45__device_8h_source.html#l00200">at45_cmd_read_status_reg()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:35 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
