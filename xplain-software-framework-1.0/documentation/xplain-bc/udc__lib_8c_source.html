<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: drivers/usb/core/udc_lib.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>drivers/usb/core/udc_lib.c</h1><a href="udc__lib_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2byteorder_8h.html" title="AVR-specific byte order definitions.">byteorder.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html" title="Debug console.">debug.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="dev_8h.html" title="USB hardware-independent device layer.">usb/dev.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="udc_8h.html" title="USB Device Controller interface.">usb/udc.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="udc__lib_8h.html" title="USB Device Controller library functions.">usb/udc_lib.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="usb__protocol_8h.html" title="USB protocol definitions.">usb/usb_protocol.h</a>&gt;</span>
<a name="l00047"></a>00047 
<a name="l00062"></a><a class="code" href="group__udc__group.html#ga8e122bb7854e62334210320d94dd4b19">00062</a> <span class="keyword">static</span> <a class="code" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e" title="Status return value.">status_t</a> <a class="code" href="group__udc__group.html#ga8e122bb7854e62334210320d94dd4b19" title="Handle a standard USB SETUP request.">udc_lib_standard_request</a>(<span class="keyword">struct</span> <a class="code" href="structudc.html" title="A USB Device Controller.">udc</a> *<a class="code" href="structudc.html" title="A USB Device Controller.">udc</a>,
<a name="l00063"></a>00063                 <span class="keyword">struct</span> <a class="code" href="structusb__setup__req.html" title="A USB Device SETUP request.">usb_setup_req</a> *req)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065         <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>        value = <a class="code" href="group__byte__order__group.html#ga687180d38fb1df3756a55129bc2bc843" title="Convert a 16-bit word from little endian to native byte order.">le16_to_cpu</a>(req-&gt;wValue);
<a name="l00066"></a>00066         <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>        index = <a class="code" href="group__byte__order__group.html#ga687180d38fb1df3756a55129bc2bc843" title="Convert a 16-bit word from little endian to native byte order.">le16_to_cpu</a>(req-&gt;wIndex);
<a name="l00067"></a>00067         <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>        len = <a class="code" href="group__byte__order__group.html#ga687180d38fb1df3756a55129bc2bc843" title="Convert a 16-bit word from little endian to native byte order.">le16_to_cpu</a>(req-&gt;wLength);
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <span class="keywordflow">switch</span> (req-&gt;bRequest) {
<a name="l00070"></a>00070         <span class="keywordflow">case</span> USB_REQ_GET_STATUS: {
<a name="l00071"></a>00071                 <a class="code" href="types_8h.html#a467964c91885f34b69185f7356842d70" title="Unsigned 16-bit quantity, little endian byte order.">le16_t</a> <a class="code" href="structusb__request.html#a28909c73430658c82cc4f05cee0e87db" title="Status code set by the UDC driver upon completion of this request.">status</a> = <a class="code" href="group__byte__order__group.html#ga54d648861a1120a3f8d6255e9cf54125" title="Create a 16-bit little endian constant.">LE16</a>(0);
<a name="l00072"></a>00072                 <a class="code" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e" title="Status return value.">status_t</a> ret;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074                 <span class="keywordflow">if</span> (len != <span class="keyword">sizeof</span>(status) || <a class="code" href="group__usb__protocol__group.html#ga67761209b192e168d2281dfd233c120a" title="Return true if the setup request req indicates OUT data transfer.">usb_setup_is_out</a>(req))
<a name="l00075"></a>00075                         <span class="keywordflow">return</span> -1;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077                 <span class="keywordflow">switch</span> (<a class="code" href="group__usb__protocol__group.html#gaf91052b7d8ad4aa2541f6dd59ac7df14" title="Return the recipient of the SETUP request req.">usb_setup_recipient</a>(req)) {
<a name="l00078"></a>00078                 <span class="keywordflow">case</span> USB_RECIP_DEVICE:
<a name="l00079"></a>00079                         status = <a class="code" href="group__byte__order__group.html#ga54d648861a1120a3f8d6255e9cf54125" title="Create a 16-bit little endian constant.">LE16</a>(1U &lt;&lt; <a class="code" href="group__usb__protocol__group.html#ggab9975b89ad7079085d0300eab037c3aca762e18607a236d99504f5838e96beb36" title="Does not draw power from bus.">USB_DEV_STATUS_SELF_POWERED</a>);
<a name="l00080"></a>00080                         <span class="keywordflow">break</span>;
<a name="l00081"></a>00081                 <span class="keywordflow">case</span> USB_RECIP_ENDPOINT:
<a name="l00082"></a>00082                         ret = <a class="code" href="group__udc__group.html#ga2ec9be7752ca333042d0ff899b9e5721" title="Check if the endpoint ep is halted.">udc_ep_is_halted</a>(udc, index &amp; <a class="code" href="group__usb__protocol__group.html#ga0316d8f43a1648b76df257332b26aeb9" title="Mask selecting the index part of an endpoint address.">USB_EP_ADDR_MASK</a>);
<a name="l00083"></a>00083                         <span class="keywordflow">if</span> (ret &lt; 0)
<a name="l00084"></a>00084                                 <span class="keywordflow">return</span> -1;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086                         status = <a class="code" href="group__byte__order__group.html#gaa0dabdefd84fa1180f9a332e8e34a73f" title="Convert a 16-bit word from native to little endian byte order.">cpu_to_le16</a>(ret);
<a name="l00087"></a>00087                         <span class="keywordflow">break</span>;
<a name="l00088"></a>00088                 <span class="keywordflow">default</span>:
<a name="l00089"></a>00089                         <span class="keywordflow">break</span>;
<a name="l00090"></a>00090                 }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092                 <a class="code" href="group__udc__group.html#ga2e051f7d27b72d0893fa0eeb7d8fefdb" title="Transmit IN data on the default control endpoint synchronously.">udc_ep0_write_sync</a>(udc, &amp;status, <span class="keyword">sizeof</span>(status));
<a name="l00093"></a>00093                 <a class="code" href="group__udc__group.html#gaf10c1032b3770d4168bca3279d99c53c" title="Signal that a status OUT packet is expected on the default control endpoint.">udc_ep0_expect_status</a>(udc);
<a name="l00094"></a>00094                 <span class="keywordflow">break</span>;
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         <span class="keywordflow">case</span> USB_REQ_CLEAR_FEATURE:
<a name="l00098"></a>00098                 <span class="keywordflow">if</span> (len != 0 || <a class="code" href="group__usb__protocol__group.html#ga2884802a16f19b932f7b5da8b199ea4a" title="Return true if the setup request req indicates IN data transfer.">usb_setup_is_in</a>(req))
<a name="l00099"></a>00099                         <span class="keywordflow">return</span> -1;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101                 <span class="keywordflow">if</span> (<a class="code" href="group__usb__protocol__group.html#gaf91052b7d8ad4aa2541f6dd59ac7df14" title="Return the recipient of the SETUP request req.">usb_setup_recipient</a>(req) == USB_RECIP_DEVICE
<a name="l00102"></a>00102                                 &amp;&amp; value == <a class="code" href="group__usb__protocol__group.html#ggab9975b89ad7079085d0300eab037c3aca9d1f5e6a07463ac38743db611c2c414a" title="Remote wakeup enabled.">USB_DEV_FEATURE_REMOTE_WAKEUP</a>) {
<a name="l00103"></a>00103                         <span class="comment">/* do nothing */</span>
<a name="l00104"></a>00104                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__usb__protocol__group.html#gaf91052b7d8ad4aa2541f6dd59ac7df14" title="Return the recipient of the SETUP request req.">usb_setup_recipient</a>(req) == USB_RECIP_ENDPOINT
<a name="l00105"></a>00105                                 &amp;&amp; value == USB_EP_FEATURE_HALT) {
<a name="l00106"></a>00106                         <span class="keywordflow">if</span> (<a class="code" href="group__udc__group.html#ga3f6290667c4af5e9533fb92ccc60f912" title="Clear the halted state of the endpoint ep.">udc_ep_clear_halt</a>(udc, index &amp; <a class="code" href="group__usb__protocol__group.html#ga0316d8f43a1648b76df257332b26aeb9" title="Mask selecting the index part of an endpoint address.">USB_EP_ADDR_MASK</a>))
<a name="l00107"></a>00107                                 <span class="keywordflow">return</span> -1;
<a name="l00108"></a>00108                 } <span class="keywordflow">else</span> {
<a name="l00109"></a>00109                         <span class="keywordflow">return</span> -1;
<a name="l00110"></a>00110                 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112                 <a class="code" href="group__udc__group.html#ga6869b8335d3c81e1dc5d9980d7508ca4" title="Send a status IN packet on the default control endpoint.">udc_ep0_send_status</a>(udc);
<a name="l00113"></a>00113                 <span class="keywordflow">break</span>;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="keywordflow">case</span> USB_REQ_SET_FEATURE:
<a name="l00116"></a>00116                 <span class="keywordflow">if</span> (len != 0 || <a class="code" href="group__usb__protocol__group.html#ga2884802a16f19b932f7b5da8b199ea4a" title="Return true if the setup request req indicates IN data transfer.">usb_setup_is_in</a>(req))
<a name="l00117"></a>00117                         <span class="keywordflow">return</span> -1;
<a name="l00118"></a>00118                 <span class="keywordflow">if</span> (<a class="code" href="group__udc__group.html#ga030b358ddb593a2b3fd049a01c4bf183" title="Test whether the USB Device Controller is running at high speed.">udc_is_high_speed</a>(udc)
<a name="l00119"></a>00119                                 &amp;&amp; <a class="code" href="group__usb__protocol__group.html#gaf91052b7d8ad4aa2541f6dd59ac7df14" title="Return the recipient of the SETUP request req.">usb_setup_recipient</a>(req) == USB_RECIP_DEVICE
<a name="l00120"></a>00120                                 &amp;&amp; value == <a class="code" href="group__usb__protocol__group.html#ggab9975b89ad7079085d0300eab037c3aca6724ffaefab5a3c54b199c4d1ea7b6ff" title="USB test mode.">USB_DEV_FEATURE_TEST_MODE</a>) {
<a name="l00121"></a>00121                         <span class="keywordflow">if</span> (index &amp; 0xff)
<a name="l00122"></a>00122                                 <span class="keywordflow">return</span> -1;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124                         <span class="comment">/*</span>
<a name="l00125"></a>00125 <span class="comment">                         * Unconfigure the device, terminating all</span>
<a name="l00126"></a>00126 <span class="comment">                         * ongoing requests.</span>
<a name="l00127"></a>00127 <span class="comment">                         */</span>
<a name="l00128"></a>00128                         <a class="code" href="group__usb__dev__core__group.html#ga4a51a8d1b52b0c474bd108f53f34986c" title="Set the active configuration.">usb_dev_set_configuration</a>(udc, 0);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130                         <span class="keywordflow">if</span> (<a class="code" href="group__udc__group.html#ga945f4e427b8ec40a3b8ef6f119abf2bb" title="Enter Test Mode.">udc_enter_test_mode</a>(udc, index &gt;&gt; 8))
<a name="l00131"></a>00131                                 <span class="keywordflow">return</span> -1;
<a name="l00132"></a>00132                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__usb__protocol__group.html#gaf91052b7d8ad4aa2541f6dd59ac7df14" title="Return the recipient of the SETUP request req.">usb_setup_recipient</a>(req) == USB_RECIP_ENDPOINT
<a name="l00133"></a>00133                                 &amp;&amp; value == USB_EP_FEATURE_HALT) {
<a name="l00134"></a>00134                         <span class="keywordflow">if</span> (<a class="code" href="group__udc__group.html#ga4510f29bac8db1085da69b5eddeca9fa" title="Set the halted state of the endpoint ep.">udc_ep_set_halt</a>(udc, index &amp; <a class="code" href="group__usb__protocol__group.html#ga0316d8f43a1648b76df257332b26aeb9" title="Mask selecting the index part of an endpoint address.">USB_EP_ADDR_MASK</a>))
<a name="l00135"></a>00135                                 <span class="keywordflow">return</span> -1;
<a name="l00136"></a>00136                 } <span class="keywordflow">else</span> {
<a name="l00137"></a>00137                         <span class="keywordflow">return</span> -1;
<a name="l00138"></a>00138                 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                 <a class="code" href="group__udc__group.html#ga6869b8335d3c81e1dc5d9980d7508ca4" title="Send a status IN packet on the default control endpoint.">udc_ep0_send_status</a>(udc);
<a name="l00141"></a>00141                 <span class="keywordflow">break</span>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143         <span class="keywordflow">case</span> USB_REQ_SET_ADDRESS:
<a name="l00144"></a>00144                 <span class="keywordflow">if</span> (len != 0 || <a class="code" href="group__usb__protocol__group.html#ga2884802a16f19b932f7b5da8b199ea4a" title="Return true if the setup request req indicates IN data transfer.">usb_setup_is_in</a>(req) || value &gt; 127)
<a name="l00145"></a>00145                         <span class="keywordflow">return</span> -1;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147                 <span class="comment">/*</span>
<a name="l00148"></a>00148 <span class="comment">                 * The address isn&#39;t actually changed until the status</span>
<a name="l00149"></a>00149 <span class="comment">                 * stage is complete. Make sure we don&#39;t handle any</span>
<a name="l00150"></a>00150 <span class="comment">                 * SETUP packets until then.</span>
<a name="l00151"></a>00151 <span class="comment">                 */</span>
<a name="l00152"></a>00152                 <a class="code" href="group__udc__group.html#gaa51143b0198d850a3f0fc86766209a64" title="Signal that the UDC is to change its USB address after the status IN phase is complete...">udc_set_address</a>(udc, value);
<a name="l00153"></a>00153                 <a class="code" href="group__udc__group.html#ga6869b8335d3c81e1dc5d9980d7508ca4" title="Send a status IN packet on the default control endpoint.">udc_ep0_send_status</a>(udc);
<a name="l00154"></a>00154                 <span class="keywordflow">break</span>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="keywordflow">case</span> USB_REQ_GET_DESCRIPTOR:
<a name="l00157"></a>00157                 <span class="keywordflow">if</span> (<a class="code" href="group__usb__protocol__group.html#ga67761209b192e168d2281dfd233c120a" title="Return true if the setup request req indicates OUT data transfer.">usb_setup_is_out</a>(req))
<a name="l00158"></a>00158                         <span class="keywordflow">return</span> -1;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160                 <span class="keywordflow">if</span> (<a class="code" href="group__usb__dev__core__group.html#ga87e8b45006847b28ba394d1daeb5331b" title="Handle a standard GET_DESCRIPTOR request.">usb_dev_get_descriptor</a>(udc, value, index, len) &lt; 0)
<a name="l00161"></a>00161                         <span class="keywordflow">return</span> -1;
<a name="l00162"></a>00162                 <span class="keywordflow">break</span>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordflow">case</span> USB_REQ_SET_DESCRIPTOR:
<a name="l00165"></a>00165                 <span class="comment">/* Not supported (defined as optional by the USB 2.0 spec) */</span>
<a name="l00166"></a>00166                 <span class="keywordflow">return</span> -1;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="keywordflow">case</span> USB_REQ_GET_CONFIGURATION:
<a name="l00169"></a>00169                 <a class="code" href="group__assert__group.html#ga0fae3864357c8f0ddad905cf5c838766" title="Assert that condition is true at build time.">build_assert</a>(<span class="keyword">sizeof</span>(udc-&gt;<a class="code" href="structudc.html#a700a0fda68e68c6c3c2cec20a02c92df" title="Current device configuration value.">config</a>) == 1);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                 <span class="keywordflow">if</span> (len != 1 || <a class="code" href="group__usb__protocol__group.html#ga67761209b192e168d2281dfd233c120a" title="Return true if the setup request req indicates OUT data transfer.">usb_setup_is_out</a>(req))
<a name="l00172"></a>00172                         <span class="keywordflow">return</span> -1;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174                 <a class="code" href="group__udc__group.html#ga2e051f7d27b72d0893fa0eeb7d8fefdb" title="Transmit IN data on the default control endpoint synchronously.">udc_ep0_write_sync</a>(udc, &amp;udc-&gt;<a class="code" href="structudc.html#a700a0fda68e68c6c3c2cec20a02c92df" title="Current device configuration value.">config</a>, 1);
<a name="l00175"></a>00175                 <a class="code" href="group__udc__group.html#gaf10c1032b3770d4168bca3279d99c53c" title="Signal that a status OUT packet is expected on the default control endpoint.">udc_ep0_expect_status</a>(udc);
<a name="l00176"></a>00176                 <span class="keywordflow">break</span>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         <span class="keywordflow">case</span> USB_REQ_SET_CONFIGURATION:
<a name="l00179"></a>00179                 <span class="keywordflow">if</span> (len != 0 || <a class="code" href="group__usb__protocol__group.html#ga2884802a16f19b932f7b5da8b199ea4a" title="Return true if the setup request req indicates IN data transfer.">usb_setup_is_in</a>(req) || !udc-&gt;<a class="code" href="structudc.html#a5508209b9db35d5610d0b4652b825efb" title="Our current device address.">address</a>)
<a name="l00180"></a>00180                         <span class="keywordflow">return</span> -1;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182                 <span class="keywordflow">if</span> (<a class="code" href="group__usb__dev__core__group.html#ga4a51a8d1b52b0c474bd108f53f34986c" title="Set the active configuration.">usb_dev_set_configuration</a>(udc, value) &lt; 0)
<a name="l00183"></a>00183                         <span class="keywordflow">return</span> -1;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185                 <a class="code" href="group__udc__group.html#ga6869b8335d3c81e1dc5d9980d7508ca4" title="Send a status IN packet on the default control endpoint.">udc_ep0_send_status</a>(udc);
<a name="l00186"></a>00186                 <span class="keywordflow">break</span>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         <span class="keywordflow">case</span> USB_REQ_GET_INTERFACE:
<a name="l00189"></a>00189                 <span class="keywordflow">if</span> (len != 1 || <a class="code" href="group__usb__protocol__group.html#ga67761209b192e168d2281dfd233c120a" title="Return true if the setup request req indicates OUT data transfer.">usb_setup_is_out</a>(req) || !udc-&gt;<a class="code" href="structudc.html#a700a0fda68e68c6c3c2cec20a02c92df" title="Current device configuration value.">config</a>)
<a name="l00190"></a>00190                         <span class="keywordflow">return</span> -1;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192                 <span class="keywordflow">if</span> (<a class="code" href="group__usb__dev__core__group.html#ga6cbee0c91abaa976b89f3fdb9861fb52" title="Get the currently active alternate setting of an interface.">usb_dev_get_interface</a>(udc, index) &lt; 0)
<a name="l00193"></a>00193                         <span class="keywordflow">return</span> -1;
<a name="l00194"></a>00194                 <span class="keywordflow">break</span>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="keywordflow">case</span> USB_REQ_SET_INTERFACE:
<a name="l00197"></a>00197                 <span class="keywordflow">if</span> (len != 0 || <a class="code" href="group__usb__protocol__group.html#ga2884802a16f19b932f7b5da8b199ea4a" title="Return true if the setup request req indicates IN data transfer.">usb_setup_is_in</a>(req) || !udc-&gt;<a class="code" href="structudc.html#a700a0fda68e68c6c3c2cec20a02c92df" title="Current device configuration value.">config</a>)
<a name="l00198"></a>00198                         <span class="keywordflow">return</span> -1;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200                 <span class="keywordflow">if</span> (<a class="code" href="group__usb__dev__core__group.html#gac860eb3e674caa8c38bfed5b26a629db" title="Select an alternate setting for an interface.">usb_dev_set_interface</a>(udc, index, value) &lt; 0)
<a name="l00201"></a>00201                         <span class="keywordflow">return</span> -1;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 <a class="code" href="group__udc__group.html#ga6869b8335d3c81e1dc5d9980d7508ca4" title="Send a status IN packet on the default control endpoint.">udc_ep0_send_status</a>(udc);
<a name="l00204"></a>00204                 <span class="keywordflow">break</span>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="keywordflow">default</span>:
<a name="l00207"></a>00207                 <span class="keywordflow">return</span> -1;
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <span class="keywordflow">return</span> 0;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00230"></a>00230 <a class="code" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e" title="Status return value.">status_t</a> <a class="code" href="group__udc__group.html#ga47e1324a894e87760dc7571aca5c5d97" title="Handle a USB SETUP request.">udc_lib_process_setup_request</a>(<span class="keyword">struct</span> <a class="code" href="structudc.html" title="A USB Device Controller.">udc</a> *<a class="code" href="structudc.html" title="A USB Device Controller.">udc</a>,
<a name="l00231"></a>00231                 <span class="keyword">struct</span> <a class="code" href="structusb__setup__req.html" title="A USB Device SETUP request.">usb_setup_req</a> *req)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233         <a class="code" href="group__debug__console.html#ga92394a5c4bbfe2864b7ea1cb488cd3dd" title="Display a verbose debugging message.">dbg_verbose</a>(<span class="stringliteral">&quot;req %02x: t%02x v%04x i%04x l%04x\n&quot;</span>,
<a name="l00234"></a>00234                    req-&gt;bRequest, req-&gt;bmRequestType,
<a name="l00235"></a>00235                    <a class="code" href="group__byte__order__group.html#ga687180d38fb1df3756a55129bc2bc843" title="Convert a 16-bit word from little endian to native byte order.">le16_to_cpu</a>(req-&gt;wValue), <a class="code" href="group__byte__order__group.html#ga687180d38fb1df3756a55129bc2bc843" title="Convert a 16-bit word from little endian to native byte order.">le16_to_cpu</a>(req-&gt;wIndex),
<a name="l00236"></a>00236                    <a class="code" href="group__byte__order__group.html#ga687180d38fb1df3756a55129bc2bc843" title="Convert a 16-bit word from little endian to native byte order.">le16_to_cpu</a>(req-&gt;wLength));
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (<a class="code" href="group__usb__protocol__group.html#ga75f3346a526996ab3458b675e956df0d" title="Return the type of the SETUP request req.">usb_setup_type</a>(req) == <a class="code" href="group__usb__protocol__group.html#gga36b2b70fae97945b76c666573a8ff4b3a51d5623a64a8ef2a06733d5f93bf9201" title="Request defined by USB specification.">USB_REQTYPE_STANDARD</a>)
<a name="l00239"></a>00239                 <span class="keywordflow">return</span> <a class="code" href="group__udc__group.html#ga8e122bb7854e62334210320d94dd4b19" title="Handle a standard USB SETUP request.">udc_lib_standard_request</a>(udc, req);
<a name="l00240"></a>00240         <span class="keywordflow">else</span>
<a name="l00241"></a>00241                 <span class="keywordflow">return</span> <a class="code" href="group__usb__dev__core__group.html#gaaae4b9c7341bb875e7d11f8befcd9d54" title="Handle a class- or vendor-defined setup request.">usb_dev_process_setup_request</a>(udc, req);
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:34 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
