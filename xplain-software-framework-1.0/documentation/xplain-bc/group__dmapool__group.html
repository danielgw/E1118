<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: DMA pool allocator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>DMA pool allocator<br/>
<small>
[<a class="el" href="group__mem__alloc__group.html">Memory Allocation</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for DMA pool allocator:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__dmapool__group.png" border="0" alt="" usemap="#group____dmapool____group_map"/>
<map name="group____dmapool____group_map" id="group____dmapool____group">
<area shape="rect" href="group__dmapool__generic__group.html" title="Generic DMA pool allocator" alt="" coords="367,5,545,35"/><area shape="rect" href="group__mem__alloc__group.html" title="Memory Allocation" alt="" coords="7,5,135,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdma__pool.html">dma_pool</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">DMA memory pool.  <a href="structdma__pool.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmapool__generic__group.html">Generic DMA pool allocator</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmapool__group.html#ga38391440d0554345824d879421bd9216">dma_pool_init_coherent_physmem</a> (struct <a class="el" href="structdma__pool.html">dma_pool</a> *dmapool, struct <a class="el" href="structphysmem__pool.html">physmem_pool</a> *phys_pool, unsigned int nr_objects, size_t objsize, unsigned int align_order)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a DMA pool using the physmem allocator.  <a href="#ga38391440d0554345824d879421bd9216"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmapool__group.html#ga695cfe5d4fd7f3a7230d2a5c02c7d920">dma_pool_init_coherent</a> (struct <a class="el" href="structdma__pool.html">dma_pool</a> *pool, <a class="el" href="cpu_2mega_2include_2cpu_2physmem_8h.html#aaf5dda50732dd08c2496ce37ad95b0cd">phys_addr_t</a> phys_start, size_t size, size_t objsize, unsigned int align_order)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a DMA-coherent memory pool.  <a href="#ga695cfe5d4fd7f3a7230d2a5c02c7d920"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="uniondma__addr__t.html">dma_addr_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmapool__group.html#ga3a7ea201b3a84ecef0c006fac1885324">dma_pool_alloc</a> (struct <a class="el" href="structdma__pool.html">dma_pool</a> *pool)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate an object from a DMA pool.  <a href="#ga3a7ea201b3a84ecef0c006fac1885324"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmapool__group.html#ga3899d64e39956d792006e5832035c241">dma_pool_free</a> (struct <a class="el" href="structdma__pool.html">dma_pool</a> *pool, <a class="el" href="uniondma__addr__t.html">dma_addr_t</a> addr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free an object previously allocated from <em>pool</em>.  <a href="#ga3899d64e39956d792006e5832035c241"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is a memory pool allocator for DMA memory. DMA memory differs from "regular" memory in that both the physical and virtual addresses are kept track of, and cache coherency issues are easier to deal with.</p>
<p>On cache- and MMU-less processors, DMA memory pools are essentially identical to regular memory pools. Nevertheless, it is highly recommended to utilize DMA memory for any memory which is to be used in data transfers involving hardware, as it will make the code more easily portable to other chips. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga3a7ea201b3a84ecef0c006fac1885324"></a><!-- doxytag: member="dmapool_nommu.h::dma_pool_alloc" ref="ga3a7ea201b3a84ecef0c006fac1885324" args="(struct dma_pool *pool)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="uniondma__addr__t.html">dma_addr_t</a> dma_pool_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdma__pool.html">dma_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate an object from a DMA pool. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>The pool from which the object will be allocated </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dmapool__nommu_8h_source.html#l00077">77</a> of file <a class="el" href="dmapool__nommu_8h_source.html">dmapool_nommu.h</a>.</p>

<p>References <a class="el" href="group__mempool__group.html#ga5e7c4701fb65890927dc29ae4ee5e5c4">mem_pool_alloc()</a>, <a class="el" href="dmapool__nommu_8h_source.html#l00066">dma_pool::mempool</a>, and <a class="el" href="dma__nommu_8h_source.html#l00062">dma_addr_t::ptr</a>.</p>

</div>
</div>
<a class="anchor" id="ga3899d64e39956d792006e5832035c241"></a><!-- doxytag: member="dmapool_nommu.h::dma_pool_free" ref="ga3899d64e39956d792006e5832035c241" args="(struct dma_pool *pool, dma_addr_t addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dma_pool_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdma__pool.html">dma_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uniondma__addr__t.html">dma_addr_t</a>&nbsp;</td>
          <td class="paramname"> <em>addr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free an object previously allocated from <em>pool</em>. </p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>If an object is freed into a different pool than the one from which it was allocated, or if the same object is freed multiple times, the DMA pool will get corrupted and subsequent allocations may return invalid objects or fail in other, unexpected ways.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>The pool from which the object was allocated </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>The physical and virtual address of the object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dmapool__nommu_8h_source.html#l00087">87</a> of file <a class="el" href="dmapool__nommu_8h_source.html">dmapool_nommu.h</a>.</p>

<p>References <a class="el" href="group__mempool__group.html#gacf196ba6a68124e0560662840fa8b113">mem_pool_free()</a>, <a class="el" href="dmapool__nommu_8h_source.html#l00066">dma_pool::mempool</a>, and <a class="el" href="dma__nommu_8h_source.html#l00062">dma_addr_t::ptr</a>.</p>

</div>
</div>
<a class="anchor" id="ga695cfe5d4fd7f3a7230d2a5c02c7d920"></a><!-- doxytag: member="dmapool_nommu.h::dma_pool_init_coherent" ref="ga695cfe5d4fd7f3a7230d2a5c02c7d920" args="(struct dma_pool *pool, phys_addr_t phys_start, size_t size, size_t objsize, unsigned int align_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dma_pool_init_coherent </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdma__pool.html">dma_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cpu_2mega_2include_2cpu_2physmem_8h.html#aaf5dda50732dd08c2496ce37ad95b0cd">phys_addr_t</a>&nbsp;</td>
          <td class="paramname"> <em>phys_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>objsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>align_order</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a DMA-coherent memory pool. </p>
<p>This function will initialize a pool of fixed-size objects located in DMA-coherent memory. Since the memory is coherent, no cache synchronization is needed before and after DMA data transfers.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>The DMA pool to be initialized </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>phys_start</em>&nbsp;</td><td>The physical address of the underlying memory area </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>The size of the underlying memory area in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>objsize</em>&nbsp;</td><td>The size of each object in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>align_order</em>&nbsp;</td><td>log2 of the minimum object alignment in bytes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dmapool__nommu_8h_source.html#l00069">69</a> of file <a class="el" href="dmapool__nommu_8h_source.html">dmapool_nommu.h</a>.</p>

<p>References <a class="el" href="group__mempool__group.html#ga3fe315306db90ac9eda83190075bd043">mem_pool_init()</a>, and <a class="el" href="dmapool__nommu_8h_source.html#l00066">dma_pool::mempool</a>.</p>

<p>Referenced by <a class="el" href="dmapool_8c_source.html#l00067">dma_pool_init_coherent_physmem()</a>.</p>

</div>
</div>
<a class="anchor" id="ga38391440d0554345824d879421bd9216"></a><!-- doxytag: member="dmapool.h::dma_pool_init_coherent_physmem" ref="ga38391440d0554345824d879421bd9216" args="(struct dma_pool *dmapool, struct physmem_pool *phys_pool, unsigned int nr_objects, size_t objsize, unsigned int align_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dma_pool_init_coherent_physmem </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdma__pool.html">dma_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>dmapool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structphysmem__pool.html">physmem_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>phys_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>nr_objects</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>objsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>align_order</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a DMA pool using the physmem allocator. </p>
<p>This function will grab enough physical memory for <em>nr_objects</em> from <em>phys_pool</em> and use this to initialize <em>dmapool</em>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dmapool</em>&nbsp;</td><td>The DMA pool to be initialized. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>phys_pool</em>&nbsp;</td><td>The physical memory pool from which to grab memory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nr_objects</em>&nbsp;</td><td>The number of objects in the pool </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>objsize</em>&nbsp;</td><td>The size of each object in bytes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>align_order</em>&nbsp;</td><td>log2 of the minimum object alignment in bytes.</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd><em>nr_objects</em> must be at least one. </dd>
<dd>
There must be enough available memory in <em>phys_pool</em>. </dd>
<dd>
<em>objsize</em> must be larger than the size of a pointer.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>dma_pool_init() </dd></dl>

<p>Definition at line <a class="el" href="dmapool_8c_source.html#l00067">67</a> of file <a class="el" href="dmapool_8c_source.html">dmapool.c</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="dmapool__nommu_8h_source.html#l00069">dma_pool_init_coherent()</a>, <a class="el" href="physmem_8c_source.html#l00066">physmem_alloc()</a>, <a class="el" href="cpu_2mega_2include_2cpu_2physmem_8h_source.html#l00052">PHYSMEM_ALLOC_ERR</a>, and <a class="el" href="util_8h_source.html#l00280">round_up</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:34 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
