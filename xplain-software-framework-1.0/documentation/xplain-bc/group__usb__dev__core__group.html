<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: USB Device Core Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>USB Device Core Interface<br/>
<small>
[<a class="el" href="group__usb__device__group.html">USB Device Framework</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for USB Device Core Interface:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__usb__dev__core__group.png" border="0" alt="" usemap="#group____usb____dev____core____group_map"/>
<map name="group____usb____dev____core____group_map" id="group____usb____dev____core____group">
<area shape="rect" href="group__usb__device__group.html" title="USB Device Framework" alt="" coords="5,5,165,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#ga87e8b45006847b28ba394d1daeb5331b">usb_dev_get_descriptor</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> value, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> index, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle a standard GET_DESCRIPTOR request.  <a href="#ga87e8b45006847b28ba394d1daeb5331b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#ga4a51a8d1b52b0c474bd108f53f34986c">usb_dev_set_configuration</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> config_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the active configuration.  <a href="#ga4a51a8d1b52b0c474bd108f53f34986c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#ga6cbee0c91abaa976b89f3fdb9861fb52">usb_dev_get_interface</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> iface_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the currently active alternate setting of an interface.  <a href="#ga6cbee0c91abaa976b89f3fdb9861fb52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#gac860eb3e674caa8c38bfed5b26a629db">usb_dev_set_interface</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> iface_id, <a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> alt_setting)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Select an alternate setting for an interface.  <a href="#gac860eb3e674caa8c38bfed5b26a629db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#gae1d65a263ed4a92e38f325176a0e3820">usb_dev_reset</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset the USB device.  <a href="#gae1d65a263ed4a92e38f325176a0e3820"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__usb__dev__core__group.html#gaaae4b9c7341bb875e7d11f8befcd9d54">usb_dev_process_setup_request</a> (struct <a class="el" href="structudc.html">udc</a> *<a class="el" href="structudc.html">udc</a>, struct <a class="el" href="structusb__setup__req.html">usb_setup_req</a> *setup)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle a class- or vendor-defined setup request.  <a href="#gaaae4b9c7341bb875e7d11f8befcd9d54"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The functions defined by this module are called by the USB Device Controller driver or the UDC library in response to bus events and control requests from the host. The USB Device Multiplexing layer will, when enabled, implement these, so applications utilizing the UDM should not have to care about these. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga87e8b45006847b28ba394d1daeb5331b"></a><!-- doxytag: member="dev_mux.c::usb_dev_get_descriptor" ref="ga87e8b45006847b28ba394d1daeb5331b" args="(struct udc *udc, uint16_t value, uint16_t index, uint16_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a> usb_dev_get_descriptor </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle a standard GET_DESCRIPTOR request. </p>
<p>This is called when a GET_DESCRIPTOR request is received from the host. The higher-level driver may queue one or more IN buffers with the requested descriptor data if available.</p>
<p>After the descriptor data has been successfully sent, which may or may not happen after this function returns, <a class="el" href="group__udc__group.html#gaf10c1032b3770d4168bca3279d99c53c" title="Signal that a status OUT packet is expected on the default control endpoint.">udc_ep0_expect_status()</a> must be called.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>USB Device Controller instance </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>The wValue of the request in native byte order </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>index</em>&nbsp;</td><td>The wIndex of the request in native byte order </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>The wLength of the request in native byte order. The higher-level driver must never queue more than this number of bytes even if the requested descriptor is larger.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a></em>&nbsp;</td><td>The request was handled successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>The request failed, so ep0 should be stalled. </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="udc__lib_8c_source.html#l00062">udc_lib_standard_request()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6cbee0c91abaa976b89f3fdb9861fb52"></a><!-- doxytag: member="dev_mux.c::usb_dev_get_interface" ref="ga6cbee0c91abaa976b89f3fdb9861fb52" args="(struct udc *udc, uint16_t iface_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a> usb_dev_get_interface </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>iface_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the currently active alternate setting of an interface. </p>
<p>This function will queue a IN packet with a single byte indicating the currently selected alternate setting of the specified interface.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>USB Device Controller instance </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>iface_id</em>&nbsp;</td><td>The bInterfaceNumber of the interface to query</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a></em>&nbsp;</td><td>The request was handled successfully, and the IN packet was queued. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a70aa759d292a0e4be7123d01959357da" title="Invalid argument.">ERR_INVALID_ARG</a></em>&nbsp;</td><td><em>iface_id</em> does not match any interface in the current configuration, so ep0 should be stalled. </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="udc__lib_8c_source.html#l00062">udc_lib_standard_request()</a>.</p>

</div>
</div>
<a class="anchor" id="gaaae4b9c7341bb875e7d11f8befcd9d54"></a><!-- doxytag: member="dev_mux.c::usb_dev_process_setup_request" ref="gaaae4b9c7341bb875e7d11f8befcd9d54" args="(struct udc *udc, struct usb_setup_req *setup)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a> usb_dev_process_setup_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structusb__setup__req.html">usb_setup_req</a> *&nbsp;</td>
          <td class="paramname"> <em>setup</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle a class- or vendor-defined setup request. </p>
<p>This function is called when a SETUP request whose Type field in bmRequestType does not indicate a standard request. It is completely up to the higher-level driver to decide which requests to support; it may choose not to support any.</p>
<p>This function may queue one or more data or status packets asynchronously, and call <a class="el" href="group__udc__group.html#gaf10c1032b3770d4168bca3279d99c53c" title="Signal that a status OUT packet is expected on the default control endpoint.">udc_ep0_expect_status()</a> when any queued IN data has been sent.</p>
<p>Note that the fields in <em>setup</em> are in USB (little-endian) byte order.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>USB Device Controller instance </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>setup</em>&nbsp;</td><td>USB SETUP request</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a></em>&nbsp;</td><td>The request was handled successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>The request failed, so ep0 should be stalled. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gae1d65a263ed4a92e38f325176a0e3820"></a><!-- doxytag: member="dev_mux.c::usb_dev_reset" ref="gae1d65a263ed4a92e38f325176a0e3820" args="(struct udc *udc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_dev_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reset the USB device. </p>
<p>This is called when a USB bus reset is detected, and when the device is disconnected from the host.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>USB Device Controller instance </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="at90usb__udc_8c_source.html#l01536">at90usb_udc_detach()</a>, and <a class="el" href="at90usb__udc_8c_source.html#l01457">at90usb_udc_device_worker()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4a51a8d1b52b0c474bd108f53f34986c"></a><!-- doxytag: member="dev_mux.c::usb_dev_set_configuration" ref="ga4a51a8d1b52b0c474bd108f53f34986c" args="(struct udc *udc, uint16_t config_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a> usb_dev_set_configuration </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>config_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the active configuration. </p>
<p>This function will deselect the currently active configuration, and optionally select a new one. If <em>config_id</em> is zero, no new configuration will be selected, but the function will still report success. If <em>config_id</em> is higher than the number of supported configurations, the function will report failure.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>USB Device Controller instance </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>config_id</em>&nbsp;</td><td>The bConfigurationValue of the new configuration, or zero if the device is to change to the Address state.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a></em>&nbsp;</td><td>The request was handled successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>The request failed, so ep0 should be stalled. </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="udc__lib_8c_source.html#l00062">udc_lib_standard_request()</a>.</p>

</div>
</div>
<a class="anchor" id="gac860eb3e674caa8c38bfed5b26a629db"></a><!-- doxytag: member="dev_mux.c::usb_dev_set_interface" ref="gac860eb3e674caa8c38bfed5b26a629db" args="(struct udc *udc, uint16_t iface_id, uint16_t alt_setting)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a933a3d656c26da40d944fa70ea43a72e">status_t</a> usb_dev_set_interface </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudc.html">udc</a> *&nbsp;</td>
          <td class="paramname"> <em>udc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>iface_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>alt_setting</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Select an alternate setting for an interface. </p>
<p>Select alternate setting <em>alt_setting</em> for interface <em>iface_id</em>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>udc</em>&nbsp;</td><td>USB Device Controller instance </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>iface_id</em>&nbsp;</td><td>The bInterfaceNumber of the interface </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>alt_setting</em>&nbsp;</td><td>The bAlternateSetting to be selected</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a></em>&nbsp;</td><td>The request was handled successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>The request failed, so ep0 should be stalled. </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="udc__lib_8c_source.html#l00062">udc_lib_standard_request()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:35 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
