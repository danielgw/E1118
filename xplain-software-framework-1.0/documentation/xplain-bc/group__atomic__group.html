<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xplain-bc: Atomic Operations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Atomic Operations<br/>
<small>
[<a class="el" href="group__utility__group.html">Utility Library</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for Atomic Operations:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__atomic__group.png" border="0" alt="" usemap="#group____atomic____group_map"/>
<map name="group____atomic____group_map" id="group____atomic____group">
<area shape="rect" href="group__utility__group.html" title="Utility Library" alt="" coords="7,5,103,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structatomic__object.html">atomic_object</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation-specific structure holding an atomic object.  <a href="structatomic__object.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#ga8c61b3ab60d4ce554927e38ee87411d4">atomic_inc</a>(ptr)&nbsp;&nbsp;&nbsp;atomic_add(ptr, 1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Increment the memory object at <em>ptr</em> atomically.  <a href="#ga8c61b3ab60d4ce554927e38ee87411d4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#gad665d89a05070c7b8d39c3b4feade811">atomic_dec</a>(ptr)&nbsp;&nbsp;&nbsp;atomic_sub(ptr, 1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decrement the memory object at <em>ptr</em> atomically.  <a href="#gad665d89a05070c7b8d39c3b4feade811"></a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structatomic__object.html">atomic_object</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#ga0beed7846bdf9b81b11ba535c5c3ddc6">atomic_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An atomic object representing a value which is manipulated atomically.  <a href="#ga0beed7846bdf9b81b11ba535c5c3ddc6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A value held by an atomic object.  <a href="#gae215ecf41b823351e4a7da1cb1f406d2"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#ga6eb3f915c81c7d713f97ecc899142a7a">atomic_read</a> (<a class="el" href="structatomic__object.html">atomic_t</a> *ptr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the value of the atomic object at <em>ptr</em>.  <a href="#ga6eb3f915c81c7d713f97ecc899142a7a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#ga574277a052be95c2dd2a3eae6475c9cc">atomic_write</a> (<a class="el" href="structatomic__object.html">atomic_t</a> *ptr, <a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a> value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write <em>value</em> to the atomic object at <em>ptr</em>.  <a href="#ga574277a052be95c2dd2a3eae6475c9cc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structatomic__object.html">atomic_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#ga4ac5fba2434dd964f2036695d1f6853a">atomic_add</a> (<a class="el" href="structatomic__object.html">atomic_t</a> *ptr, <a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a> value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Atomically add <em>value</em> to the value stored at <em>ptr</em>.  <a href="#ga4ac5fba2434dd964f2036695d1f6853a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structatomic__object.html">atomic_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__atomic__group.html#gaf81fd137ba2999c07cd2f924366a8a84">atomic_sub</a> (<a class="el" href="structatomic__object.html">atomic_t</a> *ptr, <a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a> value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Atomically subtract <em>value</em> from the value stored at <em>ptr</em>.  <a href="#gaf81fd137ba2999c07cd2f924366a8a84"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Atomic operations allow you to do certain arithmetic read-modify-write operations atomically. The atomic operations guarantee that the memory object being modified will not be altered by any other code while the operation is being carried out.</p>
<p>Normally, when incrementing a variable stored in memory, the processor will have to load the current value from memory into a register, increment the value in the register and store the result back into memory. If for example an interrupt comes along while this happens, and the interrupt handler modifies the same variable, the result will usually be wrong since the value stored by the interrupt handler will be ignored. If the variable is incremented using an atomic operation, the read-modify-write operation will happen in its entirety either before or after the interrupt handler runs, thus avoiding this problem.</p>
<p>One common way to implement atomic operations is to disable interrupts around the operation. However, some architectures may have specialized instructions which allow interrupts to be enabled while the read-modify-write operation is being carried out. It is therefore recommended to use atomic operations instead of disabling interrupts "manually" wherever possible. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="gad665d89a05070c7b8d39c3b4feade811"></a><!-- doxytag: member="atomic.h::atomic_dec" ref="gad665d89a05070c7b8d39c3b4feade811" args="(ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define atomic_dec</td>
          <td>(</td>
          <td class="paramtype">ptr&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;atomic_sub(ptr, 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Decrement the memory object at <em>ptr</em> atomically. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The new value stored at <em>ptr</em> </dd></dl>

<p>Definition at line <a class="el" href="include_2atomic_8h_source.html#l00082">82</a> of file <a class="el" href="include_2atomic_8h_source.html">atomic.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga8c61b3ab60d4ce554927e38ee87411d4"></a><!-- doxytag: member="atomic.h::atomic_inc" ref="ga8c61b3ab60d4ce554927e38ee87411d4" args="(ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define atomic_inc</td>
          <td>(</td>
          <td class="paramtype">ptr&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;atomic_add(ptr, 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Increment the memory object at <em>ptr</em> atomically. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The new value stored at <em>ptr</em> </dd></dl>

<p>Definition at line <a class="el" href="include_2atomic_8h_source.html#l00077">77</a> of file <a class="el" href="include_2atomic_8h_source.html">atomic.h</a>.</p>

<p>Referenced by <a class="el" href="msc__bulk_8c_source.html#l01366">msc_submit_write_data_req()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga0beed7846bdf9b81b11ba535c5c3ddc6"></a><!-- doxytag: member="atomic.h::atomic_t" ref="ga0beed7846bdf9b81b11ba535c5c3ddc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structatomic__object.html">atomic_object</a> <a class="el" href="structatomic__object.html">atomic_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>An atomic object representing a value which is manipulated atomically. </p>

</div>
</div>
<a class="anchor" id="gae215ecf41b823351e4a7da1cb1f406d2"></a><!-- doxytag: member="atomic.h::atomic_value_t" ref="gae215ecf41b823351e4a7da1cb1f406d2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A value held by an atomic object. </p>
<p>This type will provide the best performance of atomic operations. Currently, it's the only type which can be manipulated atomically. </p>

<p>Definition at line <a class="el" href="arch_2avr8_2include_2arch_2atomic_8h_source.html#l00052">52</a> of file <a class="el" href="arch_2avr8_2include_2arch_2atomic_8h_source.html">atomic.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga4ac5fba2434dd964f2036695d1f6853a"></a><!-- doxytag: member="atomic.h::atomic_add" ref="ga4ac5fba2434dd964f2036695d1f6853a" args="(atomic_t *ptr, atomic_value_t value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structatomic__object.html">atomic_t</a> atomic_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structatomic__object.html">atomic_t</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a>&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Atomically add <em>value</em> to the value stored at <em>ptr</em>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The result of the addition </dd></dl>

<p>Definition at line <a class="el" href="include_2generic_2atomic_8h_source.html#l00078">78</a> of file <a class="el" href="include_2generic_2atomic_8h_source.html">atomic.h</a>.</p>

<p>References <a class="el" href="arch_2avr8_2include_2arch_2interrupt_8h_source.html#l00069">cpu_irq_restore()</a>, <a class="el" href="arch_2avr8_2include_2arch_2interrupt_8h_source.html#l00055">cpu_irq_save()</a>, and <a class="el" href="include_2generic_2atomic_8h_source.html#l00063">atomic_object::value</a>.</p>

<p>Referenced by <a class="el" href="msc__bulk_8c_source.html#l01067">msc_submit_read_buffers()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6eb3f915c81c7d713f97ecc899142a7a"></a><!-- doxytag: member="atomic.h::atomic_read" ref="ga6eb3f915c81c7d713f97ecc899142a7a" args="(atomic_t *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a> atomic_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structatomic__object.html">atomic_t</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the value of the atomic object at <em>ptr</em>. </p>

<p>Definition at line <a class="el" href="include_2generic_2atomic_8h_source.html#l00066">66</a> of file <a class="el" href="include_2generic_2atomic_8h_source.html">atomic.h</a>.</p>

<p>References <a class="el" href="compiler_8h_source.html#l00246">barrier</a>, and <a class="el" href="include_2generic_2atomic_8h_source.html#l00063">atomic_object::value</a>.</p>

<p>Referenced by <a class="el" href="msc__bulk_8c_source.html#l01111">msc_read_worker()</a>, and <a class="el" href="msc__bulk_8c_source.html#l01409">msc_write_worker()</a>.</p>

</div>
</div>
<a class="anchor" id="gaf81fd137ba2999c07cd2f924366a8a84"></a><!-- doxytag: member="atomic.h::atomic_sub" ref="gaf81fd137ba2999c07cd2f924366a8a84" args="(atomic_t *ptr, atomic_value_t value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structatomic__object.html">atomic_t</a> atomic_sub </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structatomic__object.html">atomic_t</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a>&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Atomically subtract <em>value</em> from the value stored at <em>ptr</em>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The result of the subtraction </dd></dl>

<p>Definition at line <a class="el" href="include_2generic_2atomic_8h_source.html#l00091">91</a> of file <a class="el" href="include_2generic_2atomic_8h_source.html">atomic.h</a>.</p>

<p>References <a class="el" href="arch_2avr8_2include_2arch_2interrupt_8h_source.html#l00069">cpu_irq_restore()</a>, <a class="el" href="arch_2avr8_2include_2arch_2interrupt_8h_source.html#l00055">cpu_irq_save()</a>, and <a class="el" href="include_2generic_2atomic_8h_source.html#l00063">atomic_object::value</a>.</p>

<p>Referenced by <a class="el" href="msc__bulk_8c_source.html#l01067">msc_submit_read_buffers()</a>.</p>

</div>
</div>
<a class="anchor" id="ga574277a052be95c2dd2a3eae6475c9cc"></a><!-- doxytag: member="atomic.h::atomic_write" ref="ga574277a052be95c2dd2a3eae6475c9cc" args="(atomic_t *ptr, atomic_value_t value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void atomic_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structatomic__object.html">atomic_t</a> *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__atomic__group.html#gae215ecf41b823351e4a7da1cb1f406d2">atomic_value_t</a>&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write <em>value</em> to the atomic object at <em>ptr</em>. </p>

<p>Definition at line <a class="el" href="include_2generic_2atomic_8h_source.html#l00072">72</a> of file <a class="el" href="include_2generic_2atomic_8h_source.html">atomic.h</a>.</p>

<p>References <a class="el" href="compiler_8h_source.html#l00246">barrier</a>, and <a class="el" href="include_2generic_2atomic_8h_source.html#l00063">atomic_object::value</a>.</p>

<p>Referenced by <a class="el" href="msc__bulk_8c_source.html#l01286">msc_do_read()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:34 2010 for xplain-bc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
