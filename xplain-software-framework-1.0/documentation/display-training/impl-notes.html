<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-training: Implementation Notes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="impl-notes">Implementation Notes </a></h1><h2><a class="anchor" id="impl-notes-macros">
Function-like Macros</a></h2>
<p>In general, function-like macros must behave exactly like regular functions. This means that all parameters to the macro must be evaluated as if they were normal function parameters even though they may be given as complex expressions from the caller.</p>
<dl class="user"><dt><b>Example: Bad implementation of set_bit()</b></dt><dd><div class="fragment"><pre class="fragment"><span class="preprocessor"> #define set_bit(nr, bitmap)    (bitmap[nr &gt;&gt; 5] |= 1 &lt;&lt; (nr &amp; 31))</span>
<span class="preprocessor"></span>
 <span class="keywordtype">void</span> foo(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)
 {
        <a class="code" href="group__bitops__group.html#ga8cefd6d3ccb7c621b76b8d58ccfd196e" title="Set bit nr in bitmap.">set_bit</a>(a | b, &amp;foo_bitmap);
        <a class="code" href="group__bitops__group.html#ga8cefd6d3ccb7c621b76b8d58ccfd196e" title="Set bit nr in bitmap.">set_bit</a>(a++, &amp;bar_bitmap);
 }
</pre></div></dd></dl>
<p>The preceding example has two problems:</p>
<ul>
<li>The macros parameters aren't parenthesized, so the standard C precedence rules will cause unexpected results. The first call to <a class="el" href="group__bitops__group.html#ga8cefd6d3ccb7c621b76b8d58ccfd196e" title="Set bit nr in bitmap.">set_bit()</a> will be expanded as <code>(&amp;foo_bitmap[a | b &gt;&gt; 5] |= 1 &lt;&lt; (a | b &amp; 31)</code>. Both the <code>&gt;&gt;</code> and <code>&amp;</code> operators have higher precedence than the <code></code>| operator, so the macro will not behave in the same way as a function.</li>
<li>The <em>nr</em> parameter is evaluated twice. In the second call, this will cause <em>a</em> to be incremented twice.</li>
</ul>
<p>For an example of a correct implementation, please see the <a class="el" href="group__bitops__group.html#ga8cefd6d3ccb7c621b76b8d58ccfd196e" title="Set bit nr in bitmap.">set_bit()</a> macro as it appears in the framework. </p>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 15:18:22 2010 for display-training by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
