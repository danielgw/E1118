<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-training: util/membag.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>util/membag.c File Reference</h1>
<p>Memory bag allocator.  
<a href="#_details">More...</a></p>
<code>#include &lt;<a class="el" href="assert_8h_source.html">assert.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="debug_8h_source.html">debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="arch_2avr8_2include_2arch_2interrupt_8h_source.html">interrupt.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="util_8h_source.html">util.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="board_2xplain_2include_2board_2physmem_8h_source.html">physmem.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="arch_2avr8_2include_2arch_2string_8h_source.html">string.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="mempool_8h_source.html">mempool.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="include_2membag_8h_source.html">membag.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="apps_2display-training_2include_2app_2membag_8h_source.html">app/membag.h</a>&gt;</code><br/>

<p><a href="membag_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmembag.html">membag</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal structure used by membag to keep track of memory.  <a href="structmembag.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="membag_8c.html#a8ce87a9fc1294e7b1f9bcca8220d7099">MEMBAG</a>(objsize, nr_objs, pool)&nbsp;&nbsp;&nbsp;{ .block_size = objsize, .num_blocks = nr_objs, .phys_pool = pool }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Macro for configuring memory bag allocator.  <a href="#a8ce87a9fc1294e7b1f9bcca8220d7099"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="membag_8c.html#a657a455ce1e44e08e6cf7ea22ab22d30">membag_pool_init_physmem</a> (struct <a class="el" href="structmembag.html">membag</a> *mb, unsigned int align_order)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#gafc3a131be20d2f345589430df7e8e815">membag_init</a> (const unsigned int align_order)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize memory manager before use.  <a href="group__membag__group.html#gafc3a131be20d2f345589430df7e8e815"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#ga7a43e6df2bd28d5fddfd77ddcc622195">membag_get_total</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Total amount of memory in bytes.  <a href="group__membag__group.html#ga7a43e6df2bd28d5fddfd77ddcc622195"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#gad799b9cd86950091d94f81e08412a0ed">membag_get_smallest_free_block_size</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Smallest free block in bytes.  <a href="group__membag__group.html#gad799b9cd86950091d94f81e08412a0ed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#ga5e90c339c441c6b3240767ad5fa927df">membag_get_largest_free_block_size</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Largest free block size in bytes.  <a href="group__membag__group.html#ga5e90c339c441c6b3240767ad5fa927df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd">membag_alloc</a> (size_t size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate memory.  <a href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27">membag_free</a> (void *ptr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free previously allocated memory.  <a href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structmembag.html">membag</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="membag_8c.html#ab018970cc1f26ffa9bcc695059d01ecd">membags</a> []</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Memory bag.  <a href="#ab018970cc1f26ffa9bcc695059d01ecd"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Memory bag allocator. </p>
<p>Copyright (C) 2009 Atmel Corporation. All rights reserved. </p>

<p>Definition in file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8ce87a9fc1294e7b1f9bcca8220d7099"></a><!-- doxytag: member="membag.c::MEMBAG" ref="a8ce87a9fc1294e7b1f9bcca8220d7099" args="(objsize, nr_objs, pool)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MEMBAG</td>
          <td>(</td>
          <td class="paramtype">objsize, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">nr_objs, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pool&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;{ .block_size = objsize, .num_blocks = nr_objs, .phys_pool = pool }</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Macro for configuring memory bag allocator. </p>
<p>MEMBAG is used in user application to define the size and number of blocks for each bag. Please refer to description in <a class="el" href="membag_8c.html#ab018970cc1f26ffa9bcc695059d01ecd">membags</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>objsize</em>&nbsp;</td><td>Size of each block in this bag </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nr_objs</em>&nbsp;</td><td>Number of blocks in this bag </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>Pointer to <a class="el" href="structphysmem__pool.html" title="A region of available physical memory.">physmem_pool</a> to allocate this memory from. </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structphysmem__pool.html" title="A region of available physical memory.">physmem_pool</a> </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00073">73</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a657a455ce1e44e08e6cf7ea22ab22d30"></a><!-- doxytag: member="membag.c::membag_pool_init_physmem" ref="a657a455ce1e44e08e6cf7ea22ab22d30" args="(struct membag *mb, unsigned int align_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void membag_pool_init_physmem </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmembag.html">membag</a> *&nbsp;</td>
          <td class="paramname"> <em>mb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>align_order</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><b>For internal use only.</b></p>
<p>Internal function for initializing each membag</p>
<p>Initialize a membag by getting memory from physmem.</p>
<p>This function essentially does the same as the <a class="el" href="group__mempool__group.html#ga9cfe0b11ce6861f8b0e2d32c8bf91299">mem_pool_init_physmem</a> function, but keeps track of start and end of the allocated memory.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mb</em>&nbsp;</td><td>Pointer to membag structure to initialize </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>align_order</em>&nbsp;</td><td>log2 of the minimum object alignment in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Not in interrupt context. </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00115">115</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="assert_8h_source.html#l00089">assert</a>, <a class="el" href="membag_8c_source.html#l00050">membag::block_size</a>, <a class="el" href="membag_8c_source.html#l00056">membag::end</a>, <a class="el" href="group__mempool__group.html#ga3fe315306db90ac9eda83190075bd043">mem_pool_init()</a>, <a class="el" href="membag_8c_source.html#l00051">membag::num_blocks</a>, <a class="el" href="physmem__nommu_8h_source.html#l00056">PHYS_MAP_WRBACK</a>, <a class="el" href="physmem__nommu_8h_source.html#l00052">PHYS_MAP_WRBUF</a>, <a class="el" href="membag_8c_source.html#l00052">membag::phys_pool</a>, <a class="el" href="physmem_8c_source.html#l00066">physmem_alloc()</a>, <a class="el" href="cpu_2xmega_2include_2cpu_2physmem_8h_source.html#l00052">PHYSMEM_ALLOC_ERR</a>, <a class="el" href="physmem__nommu_8h_source.html#l00071">physmem_map()</a>, <a class="el" href="membag_8c_source.html#l00053">membag::pool</a>, <a class="el" href="util_8h_source.html#l00280">round_up</a>, and <a class="el" href="membag_8c_source.html#l00055">membag::start</a>.</p>

<p>Referenced by <a class="el" href="membag_8c_source.html#l00163">membag_init()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab018970cc1f26ffa9bcc695059d01ecd"></a><!-- doxytag: member="membag.c::membags" ref="ab018970cc1f26ffa9bcc695059d01ecd" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structmembag.html">membag</a> <a class="el" href="membag_8c.html#ab018970cc1f26ffa9bcc695059d01ecd">membags</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        <a class="code" href="apps_2display-training_2include_2app_2membag_8h.html#a2f257b2e7947f72a3a31087820aa9129" title="Set up memory sizes for Memory bag initializer.">APP_MEMBAG_INITIALIZER</a>
}
</pre></div>
<p>Memory bag. </p>
<p>This structure represents one or more different size bags which memory can be allocated from. The fixed size memory bags avoid internal fragmentation when memory is allocated and freed.</p>
<p>The APP_MEMBAG_INITIALIZER macro needs to be defined in app/membags.h in the user application using the MEMBAG macro. Here is an example:</p>
<div class="fragment"><pre class="fragment"> define <a class="code" href="apps_2display-training_2include_2app_2membag_8h.html#a2f257b2e7947f72a3a31087820aa9129" title="Set up memory sizes for Memory bag initializer.">APP_MEMBAG_INITIALIZER</a>  \
        <a class="code" href="membag_8c.html#a8ce87a9fc1294e7b1f9bcca8220d7099" title="Macro for configuring memory bag allocator.">MEMBAG</a>(16, 2, &amp;<a class="code" href="physmem__pools_8c.html#a860f4167365baf7bed36944aeecf3e55" title="Internal SRAM.">cpu_sram_pool</a>),          \
        <a class="code" href="membag_8c.html#a8ce87a9fc1294e7b1f9bcca8220d7099" title="Macro for configuring memory bag allocator.">MEMBAG</a>(32, 4, &amp;<a class="code" href="physmem__pools_8c.html#a860f4167365baf7bed36944aeecf3e55" title="Internal SRAM.">cpu_sram_pool</a>),
</pre></div><p>The definition above is used to configure membag to use one bag with 2 blocks of 16 bytes each and another bag with 4 blocks of 32 bytes each. Both bags are here allocated from the cpu_sram_pool.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="membag_8c.html#a8ce87a9fc1294e7b1f9bcca8220d7099" title="Macro for configuring memory bag allocator.">MEMBAG</a> </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00098">98</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 15:18:22 2010 for display-training by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
