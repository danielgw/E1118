<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-training: board/xplain/init.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>board/xplain/init.c</h1><a href="init_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="board_8h.html" title="Xplain ATxmega128A1 board-specific declarations.">board.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="chip_2atxmega128a1_2include_2chip_2gpio_8h.html" title="XMEGA GPIO implementation.">gpio.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef __ICCAVR__</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#include &lt;pmic.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044 <span class="preprocessor">#ifdef CONFIG_TOUCH_RESISTIVE</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor"># include &lt;<a class="code" href="board_2xplain_2include_2board_2touch_2resistive_2touch_8h.html" title="Board specific ADC control for resistive touch driver.">board/touch/resistive/touch.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#endif</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_EXTRAM_SDRAM</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor"># include &lt;<a class="code" href="sdram_8h.html" title="Board specific external RAM control.">board/sdram.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#endif</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 <span class="keywordtype">void</span> board_init(<span class="keywordtype">void</span>)
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053         <span class="comment">/* Set LED pins to be outputs, and all off. */</span>
<a name="l00054"></a>00054         <a class="code" href="group__port__driver__group.html#ga30b4aff1943da77c8113e1191db7bf5c" title="Select the GPIO function for a set of pins on a port.">port_select_gpio</a>((<span class="keywordtype">void</span> *)PORTE_BASE, 0xff, <a class="code" href="group__port__driver__group.html#ga1f3c0326a4a0984881d042d6106df54e" title="Pin is Output.">PORT_DIR_OUTPUT</a>
<a name="l00055"></a>00055                         | <a class="code" href="group__port__driver__group.html#ga5fe7665a4bf1a891bf5a7e6c8771fa6a" title="Initial Ouptput State is Low.">PORT_INIT_HIGH</a>);
<a name="l00056"></a>00056         <span class="comment">/* If USARTD0 is used for UART communication set PORTD tx pin as output */</span>
<a name="l00057"></a>00057 <span class="preprocessor">#ifdef CONFIG_XPLAIN_UARTD0</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>        <a class="code" href="group__port__driver__group.html#ga6ea0a06957aa0151906856deeab60bad" title="Select the GPIO function for a single pin.">port_select_gpio_pin</a>(27, <a class="code" href="group__port__driver__group.html#ga1f3c0326a4a0984881d042d6106df54e" title="Pin is Output.">PORT_DIR_OUTPUT</a> | <a class="code" href="group__port__driver__group.html#ga5fe7665a4bf1a891bf5a7e6c8771fa6a" title="Initial Ouptput State is Low.">PORT_INIT_HIGH</a>);
<a name="l00059"></a>00059 <span class="preprocessor">#endif</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>        <span class="comment">/* If USARTD1 is used for UART communication set PORTD tx pin as output */</span>
<a name="l00061"></a>00061 <span class="preprocessor">#ifdef CONFIG_XPLAIN_UARTD1</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>        <a class="code" href="group__port__driver__group.html#ga6ea0a06957aa0151906856deeab60bad" title="Select the GPIO function for a single pin.">port_select_gpio_pin</a>(31, <a class="code" href="group__port__driver__group.html#ga1f3c0326a4a0984881d042d6106df54e" title="Pin is Output.">PORT_DIR_OUTPUT</a> | <a class="code" href="group__port__driver__group.html#ga5fe7665a4bf1a891bf5a7e6c8771fa6a" title="Initial Ouptput State is Low.">PORT_INIT_HIGH</a>);
<a name="l00063"></a>00063 <span class="preprocessor">#endif</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>        <span class="comment">/* Set UART0 TX pin (PC3) as output */</span>
<a name="l00065"></a>00065         <a class="code" href="group__port__driver__group.html#ga6ea0a06957aa0151906856deeab60bad" title="Select the GPIO function for a single pin.">port_select_gpio_pin</a>(19, <a class="code" href="group__port__driver__group.html#ga1f3c0326a4a0984881d042d6106df54e" title="Pin is Output.">PORT_DIR_OUTPUT</a> | <a class="code" href="group__port__driver__group.html#ga5fe7665a4bf1a891bf5a7e6c8771fa6a" title="Initial Ouptput State is Low.">PORT_INIT_HIGH</a>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="comment">/* Init SPI master IO on port C</span>
<a name="l00068"></a>00068 <span class="comment">         * Outputs: SCK on pin 7 and MOSI on pin 5</span>
<a name="l00069"></a>00069 <span class="comment">         * Inputs: MISO on pin 6 (Leave unchanged)</span>
<a name="l00070"></a>00070 <span class="comment">         */</span>
<a name="l00071"></a>00071         <a class="code" href="group__port__driver__group.html#ga6ea0a06957aa0151906856deeab60bad" title="Select the GPIO function for a single pin.">port_select_gpio_pin</a>(21, <a class="code" href="group__port__driver__group.html#ga1f3c0326a4a0984881d042d6106df54e" title="Pin is Output.">PORT_DIR_OUTPUT</a>);
<a name="l00072"></a>00072         <a class="code" href="group__port__driver__group.html#ga6ea0a06957aa0151906856deeab60bad" title="Select the GPIO function for a single pin.">port_select_gpio_pin</a>(23, <a class="code" href="group__port__driver__group.html#ga1f3c0326a4a0984881d042d6106df54e" title="Pin is Output.">PORT_DIR_OUTPUT</a>);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <span class="comment">/* Set button pins on port F to be inputs with pull-up and interrupt</span>
<a name="l00075"></a>00075 <span class="comment">         * sensing on both edges.</span>
<a name="l00076"></a>00076 <span class="comment">         */</span>
<a name="l00077"></a>00077         <a class="code" href="group__port__driver__group.html#ga30b4aff1943da77c8113e1191db7bf5c" title="Select the GPIO function for a set of pins on a port.">port_select_gpio</a>((<span class="keywordtype">void</span> *)PORTF_BASE, 0xFF,
<a name="l00078"></a>00078                         <a class="code" href="group__port__driver__group.html#gaa0b47b54e707608d484ec66e356b8f95" title="Pin is Input.">PORT_DIR_INPUT</a> | <a class="code" href="group__port__driver__group.html#gab7eb11fd7b5fd517cc5d864a6c2c2c17" title="Sense Both Edges.">PORT_BOTHEDGES</a> | <a class="code" href="group__port__driver__group.html#gacf0c426c52be433cd8b3c0437e7fd9ab" title="Pull-Up (when input).">PORT_PULL_UP</a>);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <span class="comment">/* If resistive touch is configured, unset the PR bit for ADC A */</span>
<a name="l00081"></a>00081 <span class="preprocessor">#ifdef CONFIG_TOUCH_RESISTIVE</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>        <a class="code" href="group__touch__driver__board__group.html#gac40af7376d02e0e475e9535b8a423360" title="Clear PR bit for default touch ADC.">board_enable_touch_adc</a>();
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085         <span class="comment">/*</span>
<a name="l00086"></a>00086 <span class="comment">         * IAR does not enable low, medium and high interrupts on startup in</span>
<a name="l00087"></a>00087 <span class="comment">         * PMIC, so they must be enabled &quot;manually&quot;.</span>
<a name="l00088"></a>00088 <span class="comment">         *</span>
<a name="l00089"></a>00089 <span class="comment">         * \todo rewrite this into a constructor for main.</span>
<a name="l00090"></a>00090 <span class="comment">         */</span>
<a name="l00091"></a>00091 <span class="preprocessor">#ifdef __ICCAVR__</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>        <a class="code" href="group__pmic__group.html#ga7d36133c616aff893497bbae1a2c8478" title="Enable low level interrupts.">pmic_enable_low_lvl_int</a>();
<a name="l00093"></a>00093         <a class="code" href="group__pmic__group.html#ga45565aa6e416646eb955d9a3abaa4e5e" title="Enable medium level interrupts.">pmic_enable_medium_lvl_int</a>();
<a name="l00094"></a>00094         <a class="code" href="group__pmic__group.html#gac8615d8417d8c1de9030ad73de18438f" title="Enable high level interrupts.">pmic_enable_high_lvl_int</a>();
<a name="l00095"></a>00095 <span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097         <span class="comment">/* If huge memory is enabled, enable the onboard SDRAM. */</span>
<a name="l00098"></a>00098 <span class="preprocessor">#ifdef CONFIG_EXTRAM_SDRAM</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>        <span class="comment">// Configure I/O ports used by the EBI, except data lines.</span>
<a name="l00100"></a>00100         <a class="code" href="group__port__regs__group.html#gae7c624eb3df89b64e2320a685bf9d7b1" title="Write value to PORT register reg.">port_write_reg</a>(PORTH_BASE, OUT, 0x0f);
<a name="l00101"></a>00101         <a class="code" href="group__port__regs__group.html#gae7c624eb3df89b64e2320a685bf9d7b1" title="Write value to PORT register reg.">port_write_reg</a>(PORTH_BASE, DIR, 0xff);
<a name="l00102"></a>00102         <a class="code" href="group__port__regs__group.html#gae7c624eb3df89b64e2320a685bf9d7b1" title="Write value to PORT register reg.">port_write_reg</a>(PORTK_BASE, DIR, 0xff);
<a name="l00103"></a>00103         <a class="code" href="group__port__regs__group.html#gae7c624eb3df89b64e2320a685bf9d7b1" title="Write value to PORT register reg.">port_write_reg</a>(PORTJ_BASE, DIR, 0xf0);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <a class="code" href="group__board__ram__group.html#ga32d06757f14079ac6e2b7c7b64f8692c" title="Configure the EBI for the 8 MB onboard SDRAM.">board_enable_sdram</a>();
<a name="l00106"></a>00106 <span class="preprocessor">#endif</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>}
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 15:18:21 2010 for display-training by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
