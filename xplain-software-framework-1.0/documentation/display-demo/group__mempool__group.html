<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-demo: Memory Pool Allocator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Memory Pool Allocator<br/>
<small>
[<a class="el" href="group__mem__alloc__group.html">Memory Allocation</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for Memory Pool Allocator:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__mempool__group.png" border="0" alt="" usemap="#group____mempool____group_map"/>
<map name="group____mempool____group_map" id="group____mempool____group">
<area shape="rect" href="group__mem__alloc__group.html" title="Memory Allocation" alt="" coords="7,5,135,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmem__pool.html">mem_pool</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Memory pool.  <a href="structmem__pool.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mempool__group.html#ga3fe315306db90ac9eda83190075bd043">mem_pool_init</a> (struct <a class="el" href="structmem__pool.html">mem_pool</a> *pool, void *start, size_t size, size_t objsize, unsigned int align_order)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a memory pool.  <a href="#ga3fe315306db90ac9eda83190075bd043"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mempool__group.html#ga9cfe0b11ce6861f8b0e2d32c8bf91299">mem_pool_init_physmem</a> (struct <a class="el" href="structmem__pool.html">mem_pool</a> *mempool, struct <a class="el" href="structphysmem__pool.html">physmem_pool</a> *phys_pool, unsigned int nr_objects, size_t objsize, unsigned int align_order)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a memory pool using the physmem allocator.  <a href="#ga9cfe0b11ce6861f8b0e2d32c8bf91299"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mempool__group.html#ga5e7c4701fb65890927dc29ae4ee5e5c4">mem_pool_alloc</a> (struct <a class="el" href="structmem__pool.html">mem_pool</a> *pool)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate an object from a memory pool.  <a href="#ga5e7c4701fb65890927dc29ae4ee5e5c4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mempool__group.html#gacf196ba6a68124e0560662840fa8b113">mem_pool_free</a> (struct <a class="el" href="structmem__pool.html">mem_pool</a> *pool, const void *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free an object previously allocated from a memory pool.  <a href="#gacf196ba6a68124e0560662840fa8b113"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>A memory pool contains a number of objects of the same size that can be allocated in constant time. This is useful for allocating request structures, etc.</p>
<p>Memory pool objects are managed in Last-In-First-Out (LIFO) order to maximize the chances of allocating a cache-hot object. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga5e7c4701fb65890927dc29ae4ee5e5c4"></a><!-- doxytag: member="mempool.c::mem_pool_alloc" ref="ga5e7c4701fb65890927dc29ae4ee5e5c4" args="(struct mem_pool *pool)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * mem_pool_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmem__pool.html">mem_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate an object from a memory pool. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>The memory pool from which the object is allocated. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the newly allocated object, or NULL if the pool is exhausted. </dd></dl>

<p>Referenced by <a class="el" href="buffer_8c_source.html#l00049">buffer_alloc()</a>, <a class="el" href="dataflash_8c_source.html#l00548">dataflash_alloc_req()</a>, and <a class="el" href="membag_8c_source.html#l00270">membag_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="gacf196ba6a68124e0560662840fa8b113"></a><!-- doxytag: member="mempool.c::mem_pool_free" ref="gacf196ba6a68124e0560662840fa8b113" args="(struct mem_pool *pool, const void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mem_pool_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmem__pool.html">mem_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free an object previously allocated from a memory pool. </p>
<p>The caller is responsible for making sure <em>obj</em> was originally allocated from <em>pool</em>. If an object is freed into a different pool, the integrity of the pool can no longer be guaranteed.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The object ceases to exist the moment this function is called, so even though this function casts away the const qualifier internally, it doesn't technically modify the object. Having the const qualifier there allows callers to keep const pointers to objects which are never modified after initialization. Objects stored in flash should obviously never be freed.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>The memory pool which the object belongs to. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The object to be freed. </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="buffer_8c_source.html#l00062">buffer_free()</a>, <a class="el" href="dataflash_8c_source.html#l00566">dataflash_free_req()</a>, and <a class="el" href="membag_8c_source.html#l00327">membag_free()</a>.</p>

</div>
</div>
<a class="anchor" id="ga3fe315306db90ac9eda83190075bd043"></a><!-- doxytag: member="mempool.c::mem_pool_init" ref="ga3fe315306db90ac9eda83190075bd043" args="(struct mem_pool *pool, void *start, size_t size, size_t objsize, unsigned int align_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mem_pool_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmem__pool.html">mem_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>objsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>align_order</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a memory pool. </p>
<p>This function will initialize a memory pool, populating its freelist with objects tightly packed into the specified memory range.</p>
<p>All objects in the pool are guaranteed to be aligned to a multiple of <img class="formulaInl" alt="$2^{align\_order}$" src="form_0.png"/> bytes. For example, if <em>align_order</em> is 4, each object will start on a 16-byte boundary.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>The memory pool to be initialized. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>start</em>&nbsp;</td><td>The memory area to be used for object storage. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>The size of the memory area in bytes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>objsize</em>&nbsp;</td><td>The size of each object in bytes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>align_order</em>&nbsp;</td><td>log2 of the minimum object alignment in bytes.</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd><em>objsize</em> must be larger than the size of a pointer. </dd>
<dd>
<em>size</em> must be large enough to hold at least one object. </dd></dl>

<p>Referenced by <a class="el" href="membag_8c_source.html#l00115">membag_pool_init_physmem()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9cfe0b11ce6861f8b0e2d32c8bf91299"></a><!-- doxytag: member="mempool.c::mem_pool_init_physmem" ref="ga9cfe0b11ce6861f8b0e2d32c8bf91299" args="(struct mem_pool *mempool, struct physmem_pool *phys_pool, unsigned int nr_objects, size_t objsize, unsigned int align_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mem_pool_init_physmem </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmem__pool.html">mem_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>mempool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structphysmem__pool.html">physmem_pool</a> *&nbsp;</td>
          <td class="paramname"> <em>phys_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>nr_objects</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>objsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>align_order</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a memory pool using the physmem allocator. </p>
<p>This function will grab enough physical memory for <em>nr_objects</em> and use this to initialize <em>mempool</em>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mempool</em>&nbsp;</td><td>The memory pool to be initialized. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>phys_pool</em>&nbsp;</td><td>The physical memory pool from which to grab memory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nr_objects</em>&nbsp;</td><td>The number of objects in the pool </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>objsize</em>&nbsp;</td><td>The size of each object in bytes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>align_order</em>&nbsp;</td><td>log2 of the minimum object alignment in bytes.</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd><em>nr_objects</em> must be at least one. </dd>
<dd>
There must be enough available memory in <em>phys_pool</em>. </dd>
<dd>
<em>objsize</em> must be larger than the size of a pointer.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__mempool__group.html#ga3fe315306db90ac9eda83190075bd043" title="Initialize a memory pool.">mem_pool_init()</a> </dd></dl>

<p>Referenced by <a class="el" href="buffer_8c_source.html#l00129">buffer_pool_init()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:00 2010 for display-demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
