<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-demo: util/gfx/wtk_frame.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>util/gfx/wtk_frame.c</h1><a href="wtk__frame_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2stdint_8h.html" title="C99 integer type definitions for AVR.">stdint.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="assert_8h.html" title="Run-time and build-time assertion support.">assert.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="include_2membag_8h.html" title="Memory bag allocator.">membag.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2string_8h.html" title="Standard string operations for AVR.">string.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2wtk_8h.html" title="Graphical Widget toolkit.">gfx/wtk.h</a>&gt;</span>
<a name="l00044"></a>00044 
<a name="l00050"></a>00050 <span class="comment">/*</span>
<a name="l00051"></a>00051 <span class="comment">* Private prototypes are required due to circular references of the functions</span>
<a name="l00052"></a>00052 <span class="comment">*/</span>
<a name="l00053"></a>00053 <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="group__gfx__wtk__frame.html#gaec44ce15831a8487a041010d66df6c2a">wtk_frame_handler</a>(<span class="keyword">struct</span> <a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *win,
<a name="l00054"></a>00054                 <span class="keyword">enum</span> <a class="code" href="group__gfx__win.html#gafd48398368ba40935ca545757cb796a6" title="Valid event types sent to a window event handler.">win_event_type</a> type, <span class="keywordtype">void</span> <span class="keyword">const</span> *data);
<a name="l00055"></a>00055 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#abbc8c1e5b228164290cb2dd5de11c219">wtk_handle_frame_press</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00056"></a>00056                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event);
<a name="l00057"></a>00057 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a953898f5465df55df2aaf9a9332a70aa">wtk_handle_frame_move</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00058"></a>00058                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event);
<a name="l00059"></a>00059 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a8b53a9fd936b7ad9c6e3b912c9caa056">wtk_handle_frame_release</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00060"></a>00060                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a007a1faefd34ee3328061a28400e7846">wtk_handle_resize_press</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00063"></a>00063                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event);
<a name="l00064"></a>00064 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a49a537398b2cad221c9ce5a6214c3ffb">wtk_handle_resize_move</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00065"></a>00065                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event);
<a name="l00066"></a>00066 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a8bf601a69e3951c15fd4d43ab3911bef">wtk_handle_resize_release</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00067"></a>00067                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event);
<a name="l00068"></a>00068 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#ad55fc0268cf3e16a350425330337cf6d">wtk_resize_frame</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00069"></a>00069                 <span class="keyword">struct</span> <a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> <span class="keyword">const</span> *contents_area);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#af4a58731cf4f21289c38a22184919ba0">wtk_prepare_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *pos);
<a name="l00072"></a>00072 <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="wtk__frame_8c.html#a7d3009218d3e82c34565b3b2b9c8ecda">wtk_is_drag_threshold_exceeded</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *pos);
<a name="l00073"></a>00073 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a061b89fb356b944ffc0ab24c1b57c35a">wtk_start_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *pos);
<a name="l00074"></a>00074 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#aa9cb55a075e6dfd0a9152ae9bbbe2537">wtk_continue_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *last_pos,
<a name="l00075"></a>00075                 <span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *pos);
<a name="l00076"></a>00076 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#ab7b47152dce8bf71c738ffffdf89a38e">wtk_stop_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *last_pos);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#if (WTK_FRAME_SHADESIZE &gt; 0)</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a>00080 <span class="keyword">static</span> <span class="keywordtype">void</span> wtk_shade_frame(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *origin,
<a name="l00081"></a>00081                 <span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *size);
<a name="l00082"></a>00082 <span class="preprocessor">#endif</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00085"></a><a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00">00085</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>;
<a name="l00086"></a>00086 
<a name="l00088"></a><a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1">00088</a> <span class="keyword">static</span> <a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a> *<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a>;
<a name="l00089"></a>00089 
<a name="l00091"></a><a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b">00091</a> <span class="keyword">static</span> <a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a> *<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="preprocessor">#if (WTK_FRAME_SHADESIZE &gt; 0)</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 <span class="keyword">static</span> <a class="code" href="group__progmem__group.html#ga4a2f88fbe5059cf8d3cf8974557d6655" title="Define a variable stored in program memory.">DEFINE_PROGMEM</a>(<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>, wtk_frame_shades[<a class="code" href="group__gfx__wtk__frame.html#gad9a18af7489fb0d0840da48e72e96df7" title="Size of drop shadow area outside left/bottom/right border. 0 = no shadow.">WTK_FRAME_SHADESIZE</a>]) =
<a name="l00096"></a>00096                 <a class="code" href="group__gfx__wtk__frame.html#ga9c200dcb2a5eadd82342d92fc8aa07ab" title="Shade factor of drop shadow, first number is farthest from border.">WTK_FRAME_SHADES</a>;
<a name="l00097"></a>00097 <span class="preprocessor">#endif</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00100"></a><a class="code" href="wtk__frame_8c.html#ae328352747db02e040eca2c4d6d9911f">00100</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structgfx__bitmap.html" title="Storage structure for bitmap pixel data and metadata.">gfx_bitmap</a> <a class="code" href="wtk__frame_8c.html#ae328352747db02e040eca2c4d6d9911f" title="Frame background bitmap.">wtk_frame_background</a> = {
<a name="l00101"></a>00101                 .<a class="code" href="structgfx__bitmap.html#a25e3747161bb4053f91cbaab6bdc216d" title="Bitmap type.">type</a> = <a class="code" href="group__gfx__gfx.html#ggaaa3d242c7c08ccafbb00bbcfabe27e3fa5347f7bf0548ae0c3cc8210f49b937a6" title="Solid color bitmap.">BITMAP_SOLID</a>,
<a name="l00102"></a>00102                 .data.color = <a class="code" href="group__gfx__wtk__frame.html#ga23e7d00918c7169e48a46342af48d4ef" title="Background color of frame contents window.">WTK_FRAME_BACKGROUND_COLOR</a>,
<a name="l00103"></a>00103 };
<a name="l00104"></a>00104 
<a name="l00109"></a><a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3">00109</a> <span class="keyword">enum</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3">wtk_frame_state</a> {
<a name="l00111"></a><a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1">00111</a>         <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1" title="Normal state, no moving or resizing.">WTK_FRAME_NORMAL</a>,
<a name="l00113"></a><a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0a66d311fc2d66b7ba2773792f2a09e6">00113</a>         <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0a66d311fc2d66b7ba2773792f2a09e6" title="Waiting for move, from key or drag.">WTK_FRAME_AWAITING_MOVE</a>,
<a name="l00115"></a><a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a5558a293e6387aaf9d44c0c582fdb65b">00115</a>         <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a5558a293e6387aaf9d44c0c582fdb65b" title="Currently moving.">WTK_FRAME_MOVING</a>,
<a name="l00117"></a><a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0fac3813d9dd6b00f3c0f11c2713a5c9">00117</a>         <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0fac3813d9dd6b00f3c0f11c2713a5c9" title="Waiting for resize, from key or drag.">WTK_FRAME_AWAITING_RESIZE</a>,
<a name="l00119"></a><a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3afa38d0d62d2508a1f57480178793166e">00119</a>         <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3afa38d0d62d2508a1f57480178793166e" title="Currently resizing.">WTK_FRAME_RESIZING</a>
<a name="l00120"></a>00120 };
<a name="l00121"></a>00121 
<a name="l00132"></a><a class="code" href="structwtk__frame.html">00132</a> <span class="keyword">struct </span><a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> {
<a name="l00134"></a><a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246">00134</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>       *<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>;
<a name="l00136"></a><a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11">00136</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>       *<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>;
<a name="l00138"></a><a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464">00138</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>       *<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>;
<a name="l00140"></a><a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371">00140</a>         <span class="keywordtype">char</span>                    *<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>;
<a name="l00142"></a><a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c">00142</a>         <span class="keyword">enum</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3">wtk_frame_state</a>    <a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>;
<a name="l00143"></a>00143 
<a name="l00145"></a><a class="code" href="structwtk__frame.html#a0069f958473f3770d3c36d74e0505236">00145</a>         <a class="code" href="group__gfx__wtk__frame.html#ga10dc17f372979410e97fc72280fa1d6c" title="Frame command event handler callback.">wtk_frame_handler_t</a>     <a class="code" href="structwtk__frame.html#a0069f958473f3770d3c36d74e0505236" title="Frame command event handler.">frame_handler</a>;
<a name="l00147"></a><a class="code" href="structwtk__frame.html#aab57402e16fb50e89971711c824ab32f">00147</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structwtk__frame.html#aab57402e16fb50e89971711c824ab32f" title="Data for applications and handlers.">custom_data</a>;
<a name="l00148"></a>00148 };
<a name="l00149"></a>00149 
<a name="l00159"></a><a class="code" href="group__gfx__wtk__frame.html#ga16824744afa2ee56e978d7179862765b">00159</a> <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *<a class="code" href="group__gfx__wtk__frame.html#ga16824744afa2ee56e978d7179862765b">wtk_frame_as_parent</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame)
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(frame);
<a name="l00162"></a>00162         <span class="keywordflow">return</span> frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00173"></a><a class="code" href="group__gfx__wtk__frame.html#ga0052cc92046ad576dcbe432e1db3f58a">00173</a> <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *<a class="code" href="group__gfx__wtk__frame.html#ga0052cc92046ad576dcbe432e1db3f58a">wtk_frame_as_child</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame)
<a name="l00174"></a>00174 {
<a name="l00175"></a>00175         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(frame);
<a name="l00176"></a>00176         <span class="keywordflow">return</span> frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>;
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00187"></a><a class="code" href="group__gfx__wtk__frame.html#ga444b10685cc1ead0024ae085b0d59488">00187</a> <span class="keywordtype">void</span> *<a class="code" href="group__gfx__wtk__frame.html#ga444b10685cc1ead0024ae085b0d59488">wtk_frame_get_custom_data</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> <span class="keyword">const</span> *frame)
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(frame);
<a name="l00190"></a>00190         <span class="keywordflow">return</span> frame-&gt;<a class="code" href="structwtk__frame.html#aab57402e16fb50e89971711c824ab32f" title="Data for applications and handlers.">custom_data</a>;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00201"></a><a class="code" href="wtk__frame_8c.html#abbc8c1e5b228164290cb2dd5de11c219">00201</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#abbc8c1e5b228164290cb2dd5de11c219">wtk_handle_frame_press</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00202"></a>00202                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204         <span class="keywordflow">switch</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>) {
<a name="l00205"></a>00205                 <span class="comment">// If we are in normal state, prepare for move drag.</span>
<a name="l00206"></a>00206         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1" title="Normal state, no moving or resizing.">WTK_FRAME_NORMAL</a>:
<a name="l00207"></a>00207                 <a class="code" href="wtk__frame_8c.html#af4a58731cf4f21289c38a22184919ba0">wtk_prepare_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00208"></a>00208                 <a class="code" href="group__gfx__win.html#gafeab76a239174ba19edacbbf52a5861b" title="Set pointer focus window or NULL, i.e. override pointer event receiver.">win_grab_pointer</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210                 frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0a66d311fc2d66b7ba2773792f2a09e6" title="Waiting for move, from key or drag.">WTK_FRAME_AWAITING_MOVE</a>;
<a name="l00211"></a>00211                 <span class="keywordflow">break</span>;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         <span class="keywordflow">default</span>:
<a name="l00214"></a>00214                 <span class="keywordflow">break</span>;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00227"></a><a class="code" href="wtk__frame_8c.html#a953898f5465df55df2aaf9a9332a70aa">00227</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a953898f5465df55df2aaf9a9332a70aa">wtk_handle_frame_move</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00228"></a>00228                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230         <span class="keywordflow">switch</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>) {
<a name="l00231"></a>00231                 <span class="comment">/* If we are waiting for move, check drag threshold and start</span>
<a name="l00232"></a>00232 <span class="comment">                 * drag if threshold exceeded.</span>
<a name="l00233"></a>00233 <span class="comment">                 */</span>
<a name="l00234"></a>00234         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0a66d311fc2d66b7ba2773792f2a09e6" title="Waiting for move, from key or drag.">WTK_FRAME_AWAITING_MOVE</a>:
<a name="l00235"></a>00235                 <span class="keywordflow">if</span> (<a class="code" href="wtk__frame_8c.html#a7d3009218d3e82c34565b3b2b9c8ecda">wtk_is_drag_threshold_exceeded</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>))) {
<a name="l00236"></a>00236                         <a class="code" href="wtk__frame_8c.html#a061b89fb356b944ffc0ab24c1b57c35a">wtk_start_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00237"></a>00237                         frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a5558a293e6387aaf9d44c0c582fdb65b" title="Currently moving.">WTK_FRAME_MOVING</a>;
<a name="l00238"></a>00238                 }
<a name="l00239"></a>00239                 <span class="keywordflow">break</span>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241                 <span class="comment">// If we are already moving, continue drag.</span>
<a name="l00242"></a>00242         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a5558a293e6387aaf9d44c0c582fdb65b" title="Currently moving.">WTK_FRAME_MOVING</a>:
<a name="l00243"></a>00243                 <a class="code" href="wtk__frame_8c.html#aa9cb55a075e6dfd0a9152ae9bbbe2537">wtk_continue_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a644aa45405116ed212555fb0da54436c" title="Absolute position of last event, set by window system.">last_pos</a>), &amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00244"></a>00244                 <span class="keywordflow">break</span>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="keywordflow">default</span>:
<a name="l00247"></a>00247                 <span class="keywordflow">break</span>;
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00260"></a><a class="code" href="wtk__frame_8c.html#a8b53a9fd936b7ad9c6e3b912c9caa056">00260</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a8b53a9fd936b7ad9c6e3b912c9caa056">wtk_handle_frame_release</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00261"></a>00261                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263         <span class="keywordtype">bool</span> is_inside;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">switch</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>) {
<a name="l00266"></a>00266                 <span class="comment">/* If we were moving when released, ungrab pointer and move if</span>
<a name="l00267"></a>00267 <span class="comment">                 * release was inside parent window extents.</span>
<a name="l00268"></a>00268 <span class="comment">                 */</span>
<a name="l00269"></a>00269         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a5558a293e6387aaf9d44c0c582fdb65b" title="Currently moving.">WTK_FRAME_MOVING</a>:
<a name="l00270"></a>00270                 <span class="comment">// Ungrab pointer.</span>
<a name="l00271"></a>00271                 <a class="code" href="wtk__frame_8c.html#ab7b47152dce8bf71c738ffffdf89a38e">wtk_stop_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a644aa45405116ed212555fb0da54436c" title="Absolute position of last event, set by window system.">last_pos</a>));
<a name="l00272"></a>00272                 <a class="code" href="group__gfx__win.html#gafeab76a239174ba19edacbbf52a5861b" title="Set pointer focus window or NULL, i.e. override pointer event receiver.">win_grab_pointer</a>(NULL);
<a name="l00273"></a>00273                 frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1" title="Normal state, no moving or resizing.">WTK_FRAME_NORMAL</a>;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                 <span class="comment">// Check release position.</span>
<a name="l00276"></a>00276                 is_inside = <a class="code" href="group__gfx__win.html#ga073125e6ab6785548fbe7e290cdd8df2" title="Return true if global point is inside window.">win_is_inside_window</a>(<a class="code" href="group__gfx__win.html#ga6021b50012c76c1e75542c9e19683ad2" title="Get pointer to parent window, or NULL for root window.">win_get_parent</a>(frame-&gt;
<a name="l00277"></a>00277                                                 container), &amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                 <span class="comment">// If inside, move frame according to drag distance.</span>
<a name="l00280"></a>00280                 <span class="keywordflow">if</span> (is_inside) {
<a name="l00281"></a>00281                         <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> area = *<a class="code" href="group__gfx__win.html#ga3b36b88b8811da7248eb23bc9af1c504" title="Get a pointer to the window area struct.">win_get_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>);
<a name="l00282"></a>00282                         area.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x += <span class="keyword">event</span>-&gt;pos.x - <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x;
<a name="l00283"></a>00283                         area.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y += <span class="keyword">event</span>-&gt;pos.y - <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y;
<a name="l00284"></a>00284                         <a class="code" href="group__gfx__win.html#ga814a8aadf21b9d34d9c0cc5d2ff33dc2" title="Update window position and/or size.">win_set_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>, &amp;area,
<a name="l00285"></a>00285                                         <a class="code" href="group__gfx__win.html#gac9ee551a42534b9ce1ca67318f48f257" title="Attribute mask for updating window position.">WIN_ATTR_POSITION</a>);
<a name="l00286"></a>00286                 }
<a name="l00287"></a>00287                 <span class="keywordflow">break</span>;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="keywordflow">default</span>:
<a name="l00290"></a>00290                 <span class="keywordflow">break</span>;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00302"></a><a class="code" href="wtk__frame_8c.html#a007a1faefd34ee3328061a28400e7846">00302</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a007a1faefd34ee3328061a28400e7846">wtk_handle_resize_press</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00303"></a>00303                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305         <span class="keywordflow">switch</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>) {
<a name="l00306"></a>00306                 <span class="comment">// If we are in normal state, prepare for resize drag.</span>
<a name="l00307"></a>00307         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1" title="Normal state, no moving or resizing.">WTK_FRAME_NORMAL</a>:
<a name="l00308"></a>00308                 <a class="code" href="wtk__frame_8c.html#af4a58731cf4f21289c38a22184919ba0">wtk_prepare_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00309"></a>00309                 <a class="code" href="group__gfx__win.html#gafeab76a239174ba19edacbbf52a5861b" title="Set pointer focus window or NULL, i.e. override pointer event receiver.">win_grab_pointer</a>(frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311                 frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0fac3813d9dd6b00f3c0f11c2713a5c9" title="Waiting for resize, from key or drag.">WTK_FRAME_AWAITING_RESIZE</a>;
<a name="l00312"></a>00312                 <span class="keywordflow">break</span>;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="keywordflow">default</span>:
<a name="l00315"></a>00315                 <span class="keywordflow">break</span>;
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00328"></a><a class="code" href="wtk__frame_8c.html#a49a537398b2cad221c9ce5a6214c3ffb">00328</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a49a537398b2cad221c9ce5a6214c3ffb">wtk_handle_resize_move</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00329"></a>00329                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event)
<a name="l00330"></a>00330 {
<a name="l00331"></a>00331         <span class="keywordflow">switch</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>) {
<a name="l00332"></a>00332                 <span class="comment">/* If we are waiting for resize, check drag threshold and start</span>
<a name="l00333"></a>00333 <span class="comment">                 * drag if threshold exceeded.</span>
<a name="l00334"></a>00334 <span class="comment">                 */</span>
<a name="l00335"></a>00335         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3a0fac3813d9dd6b00f3c0f11c2713a5c9" title="Waiting for resize, from key or drag.">WTK_FRAME_AWAITING_RESIZE</a>:
<a name="l00336"></a>00336                 <span class="keywordflow">if</span> (<a class="code" href="wtk__frame_8c.html#a7d3009218d3e82c34565b3b2b9c8ecda">wtk_is_drag_threshold_exceeded</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>))) {
<a name="l00337"></a>00337                         <a class="code" href="wtk__frame_8c.html#a061b89fb356b944ffc0ab24c1b57c35a">wtk_start_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00338"></a>00338                         frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3afa38d0d62d2508a1f57480178793166e" title="Currently resizing.">WTK_FRAME_RESIZING</a>;
<a name="l00339"></a>00339                 }
<a name="l00340"></a>00340                 <span class="keywordflow">break</span>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342                 <span class="comment">// If we are already resizing, continue drag.</span>
<a name="l00343"></a>00343         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3afa38d0d62d2508a1f57480178793166e" title="Currently resizing.">WTK_FRAME_RESIZING</a>:
<a name="l00344"></a>00344                 <a class="code" href="wtk__frame_8c.html#aa9cb55a075e6dfd0a9152ae9bbbe2537">wtk_continue_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a644aa45405116ed212555fb0da54436c" title="Absolute position of last event, set by window system.">last_pos</a>), &amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00345"></a>00345                 <span class="keywordflow">break</span>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         <span class="keywordflow">default</span>:
<a name="l00348"></a>00348                 <span class="keywordflow">break</span>;
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00361"></a><a class="code" href="wtk__frame_8c.html#a8bf601a69e3951c15fd4d43ab3911bef">00361</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a8bf601a69e3951c15fd4d43ab3911bef">wtk_handle_resize_release</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00362"></a>00362                 <span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *event)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364         <span class="keywordtype">bool</span> is_inside;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keywordflow">switch</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a>) {
<a name="l00367"></a>00367                 <span class="comment">/* If we were resizing when released, ungrab pointer and resize</span>
<a name="l00368"></a>00368 <span class="comment">                 * if release was inside parent window extents.</span>
<a name="l00369"></a>00369 <span class="comment">                 */</span>
<a name="l00370"></a>00370         <span class="keywordflow">case</span> <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3afa38d0d62d2508a1f57480178793166e" title="Currently resizing.">WTK_FRAME_RESIZING</a>:
<a name="l00371"></a>00371                 <span class="comment">// Ungrab pointer.</span>
<a name="l00372"></a>00372                 <a class="code" href="wtk__frame_8c.html#ab7b47152dce8bf71c738ffffdf89a38e">wtk_stop_drag</a>(&amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a644aa45405116ed212555fb0da54436c" title="Absolute position of last event, set by window system.">last_pos</a>));
<a name="l00373"></a>00373                 <a class="code" href="group__gfx__win.html#gafeab76a239174ba19edacbbf52a5861b" title="Set pointer focus window or NULL, i.e. override pointer event receiver.">win_grab_pointer</a>(NULL);
<a name="l00374"></a>00374                 frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1" title="Normal state, no moving or resizing.">WTK_FRAME_NORMAL</a>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 <span class="comment">// Check release position.</span>
<a name="l00377"></a>00377                 is_inside = <a class="code" href="group__gfx__win.html#ga073125e6ab6785548fbe7e290cdd8df2" title="Return true if global point is inside window.">win_is_inside_window</a>(<a class="code" href="group__gfx__win.html#ga6021b50012c76c1e75542c9e19683ad2" title="Get pointer to parent window, or NULL for root window.">win_get_parent</a>(frame-&gt;
<a name="l00378"></a>00378                                                 container), &amp;(event-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>));
<a name="l00379"></a>00379 
<a name="l00380"></a>00380                 <span class="comment">// If inside, resize frame according to drag distance.</span>
<a name="l00381"></a>00381                 <span class="keywordflow">if</span> (is_inside) {
<a name="l00382"></a>00382                         <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> contents_area =
<a name="l00383"></a>00383                                         *<a class="code" href="group__gfx__win.html#ga3b36b88b8811da7248eb23bc9af1c504" title="Get a pointer to the window area struct.">win_get_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385                         contents_area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x += <span class="keyword">event</span>-&gt;pos.x - <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x;
<a name="l00386"></a>00386                         contents_area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y += <span class="keyword">event</span>-&gt;pos.y - <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388                         <a class="code" href="wtk__frame_8c.html#ad55fc0268cf3e16a350425330337cf6d">wtk_resize_frame</a>(frame, &amp;contents_area);
<a name="l00389"></a>00389                 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391                 <span class="keywordflow">break</span>;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         <span class="keywordflow">default</span>:
<a name="l00394"></a>00394                 <span class="keywordflow">break</span>;
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00407"></a><a class="code" href="wtk__frame_8c.html#ad55fc0268cf3e16a350425330337cf6d">00407</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#ad55fc0268cf3e16a350425330337cf6d">wtk_resize_frame</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame,
<a name="l00408"></a>00408                 <span class="keyword">struct</span> <a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> <span class="keyword">const</span> *contents_area)
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410         <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a>         container_area;
<a name="l00411"></a>00411         <span class="comment">// Make local copy, so that we can change it.</span>
<a name="l00412"></a>00412         <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a>         area = *contents_area;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414         <span class="comment">// Make sure size is not too small, override if it is.</span>
<a name="l00415"></a>00415         <span class="keywordflow">if</span> (area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x &lt; <a class="code" href="group__gfx__wtk__frame.html#gacbfd8f1e5beedcf45ab374b9b9e2ef2a" title="Minimum width of contents window of a frame.">WTK_FRAME_MIN_WIDTH</a>) {
<a name="l00416"></a>00416                 area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = <a class="code" href="group__gfx__wtk__frame.html#gacbfd8f1e5beedcf45ab374b9b9e2ef2a" title="Minimum width of contents window of a frame.">WTK_FRAME_MIN_WIDTH</a>;
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y &lt; <a class="code" href="group__gfx__wtk__frame.html#ga4e92e4f3419285607652b21b95dd6504" title="Minimum height of contents window of a frame.">WTK_FRAME_MIN_HEIGHT</a>) {
<a name="l00420"></a>00420                 area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = <a class="code" href="group__gfx__wtk__frame.html#ga4e92e4f3419285607652b21b95dd6504" title="Minimum height of contents window of a frame.">WTK_FRAME_MIN_HEIGHT</a>;
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423         <span class="comment">// Change the size of the contents window first.</span>
<a name="l00424"></a>00424         <a class="code" href="group__gfx__win.html#ga814a8aadf21b9d34d9c0cc5d2ff33dc2" title="Update window position and/or size.">win_set_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>, &amp;area, <a class="code" href="group__gfx__win.html#ga0bbe2e4323615d774dcdc35626af27ec" title="Attribute mask for updating window size.">WIN_ATTR_SIZE</a>);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <span class="comment">/* Read back size, in case other event handlers put other minimum</span>
<a name="l00427"></a>00427 <span class="comment">         * limits to the size.</span>
<a name="l00428"></a>00428 <span class="comment">         */</span>
<a name="l00429"></a>00429         area = *<a class="code" href="group__gfx__win.html#ga3b36b88b8811da7248eb23bc9af1c504" title="Get a pointer to the window area struct.">win_get_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="comment">/* Get current area of container and change size according to the new</span>
<a name="l00432"></a>00432 <span class="comment">         * size of the contents window. Then update the container window size.</span>
<a name="l00433"></a>00433 <span class="comment">         */</span>
<a name="l00434"></a>00434         container_area = *<a class="code" href="group__gfx__win.html#ga3b36b88b8811da7248eb23bc9af1c504" title="Get a pointer to the window area struct.">win_get_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         container_area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x +
<a name="l00437"></a>00437                         <a class="code" href="group__gfx__wtk__frame.html#gad9a18af7489fb0d0840da48e72e96df7" title="Size of drop shadow area outside left/bottom/right border. 0 = no shadow.">WTK_FRAME_SHADESIZE</a> + WTK_FRAME_LEFTBORDER +
<a name="l00438"></a>00438                         <a class="code" href="group__gfx__wtk__frame.html#ga278ce1b146da9eafc0f534ac57dc6f9f" title="Left frame border size.">WTK_FRAME_RIGHTBORDER</a> + <a class="code" href="group__gfx__wtk__frame.html#gad9a18af7489fb0d0840da48e72e96df7" title="Size of drop shadow area outside left/bottom/right border. 0 = no shadow.">WTK_FRAME_SHADESIZE</a>;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440         container_area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y +
<a name="l00441"></a>00441                         <a class="code" href="group__gfx__wtk__frame.html#gaa0c521b383427197d98150a1a1124784" title="Top frame border size.">WTK_FRAME_TOPBORDER</a> + <a class="code" href="group__gfx__wtk__frame.html#ga09c5f60fbace2b50d930c04beeda5651" title="Height of titlebar area.">WTK_FRAME_TITLEBAR_HEIGHT</a> +
<a name="l00442"></a>00442                         <a class="code" href="group__gfx__wtk__frame.html#gab197078b3b6abc79a5ac53fdd1284325" title="Bottom frame border size.">WTK_FRAME_BOTTOMBORDER</a> + WTK_FRAME_SHADESIZE;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <a class="code" href="group__gfx__win.html#ga814a8aadf21b9d34d9c0cc5d2ff33dc2" title="Update window position and/or size.">win_set_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>, &amp;container_area, <a class="code" href="group__gfx__win.html#ga0bbe2e4323615d774dcdc35626af27ec" title="Attribute mask for updating window size.">WIN_ATTR_SIZE</a>);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>) {
<a name="l00447"></a>00447                 <span class="comment">/* Get current area of resize window and change position</span>
<a name="l00448"></a>00448 <span class="comment">                 * according to the new size of the container window. The size</span>
<a name="l00449"></a>00449 <span class="comment">                 * of the resize window is unchanged.</span>
<a name="l00450"></a>00450 <span class="comment">                 */</span>
<a name="l00451"></a>00451                 <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> resize_area = *<a class="code" href="group__gfx__win.html#ga3b36b88b8811da7248eb23bc9af1c504" title="Get a pointer to the window area struct.">win_get_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453                 resize_area.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = container_area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x -
<a name="l00454"></a>00454                                 WTK_FRAME_SHADESIZE - <a class="code" href="group__gfx__wtk__frame.html#ga9e8dcd2ece504f395aab159cc7a41283" title="Width of resize handle.">WTK_FRAME_RESIZE_WIDTH</a>;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456                 resize_area.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = container_area.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y -
<a name="l00457"></a>00457                                 WTK_FRAME_SHADESIZE - <a class="code" href="group__gfx__wtk__frame.html#ga8006ec678770821738b2294119bb338b" title="Height of resize handle.">WTK_FRAME_RESIZE_HEIGHT</a>;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459                 <a class="code" href="group__gfx__win.html#ga814a8aadf21b9d34d9c0cc5d2ff33dc2" title="Update window position and/or size.">win_set_area</a>(frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>, &amp;resize_area, <a class="code" href="group__gfx__win.html#gac9ee551a42534b9ce1ca67318f48f257" title="Attribute mask for updating window position.">WIN_ATTR_POSITION</a>);
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00471"></a><a class="code" href="wtk__frame_8c.html#af4a58731cf4f21289c38a22184919ba0">00471</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#af4a58731cf4f21289c38a22184919ba0">wtk_prepare_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>)
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473         <span class="comment">/* Store drag origin, so that we know where to draw the origin symbol</span>
<a name="l00474"></a>00474 <span class="comment">         * if the drag threshold is exceeded.</span>
<a name="l00475"></a>00475 <span class="comment">         */</span>
<a name="l00476"></a>00476         <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a> = *pos;
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00489"></a><a class="code" href="wtk__frame_8c.html#a7d3009218d3e82c34565b3b2b9c8ecda">00489</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="wtk__frame_8c.html#a7d3009218d3e82c34565b3b2b9c8ecda">wtk_is_drag_threshold_exceeded</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>)
<a name="l00490"></a>00490 {
<a name="l00491"></a>00491         <span class="keywordtype">bool</span> isExceeded =
<a name="l00492"></a>00492                         (pos-&gt;x &lt; (<a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x - <a class="code" href="group__gfx__wtk__frame.html#gaa413eb998059d88caf7434ce7cde7608" title="Distance from origin before dragging operation kicks in.">WTK_DRAG_THRESHOLD</a>)) ||
<a name="l00493"></a>00493                         (pos-&gt;x &gt; (<a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x + <a class="code" href="group__gfx__wtk__frame.html#gaa413eb998059d88caf7434ce7cde7608" title="Distance from origin before dragging operation kicks in.">WTK_DRAG_THRESHOLD</a>)) ||
<a name="l00494"></a>00494                         (pos-&gt;y &lt; (<a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y - <a class="code" href="group__gfx__wtk__frame.html#gaa413eb998059d88caf7434ce7cde7608" title="Distance from origin before dragging operation kicks in.">WTK_DRAG_THRESHOLD</a>)) ||
<a name="l00495"></a>00495                         (pos-&gt;y &gt; (<a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y + <a class="code" href="group__gfx__wtk__frame.html#gaa413eb998059d88caf7434ce7cde7608" title="Distance from origin before dragging operation kicks in.">WTK_DRAG_THRESHOLD</a>));
<a name="l00496"></a>00496 
<a name="l00497"></a>00497         <span class="keywordflow">return</span> isExceeded;
<a name="l00498"></a>00498 }
<a name="l00499"></a>00499 
<a name="l00510"></a><a class="code" href="wtk__frame_8c.html#a061b89fb356b944ffc0ab24c1b57c35a">00510</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#a061b89fb356b944ffc0ab24c1b57c35a">wtk_start_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512         <span class="comment">// Allocate memory for bitmaps.</span>
<a name="l00513"></a>00513         <a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a> = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>(
<a name="l00514"></a>00514                         (<a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a> * <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>) *
<a name="l00515"></a>00515                         <span class="keyword">sizeof</span>(<a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a>)
<a name="l00516"></a>00516                         );
<a name="l00517"></a>00517         <span class="keywordflow">if</span> (!<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a>) {
<a name="l00518"></a>00518                 <span class="keywordflow">goto</span> outofmem_origin;
<a name="l00519"></a>00519         }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a> = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>(
<a name="l00522"></a>00522                         (WTK_DRAG_PIXMAP_SIZE * WTK_DRAG_PIXMAP_SIZE) *
<a name="l00523"></a>00523                         <span class="keyword">sizeof</span>(<a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a>)
<a name="l00524"></a>00524                         );
<a name="l00525"></a>00525         <span class="keywordflow">if</span> (!<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>) {
<a name="l00526"></a>00526                 <span class="keywordflow">goto</span> outofmem_target;
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         <span class="comment">/* Make sure we can draw on the entire screen, since dragging is not</span>
<a name="l00530"></a>00530 <span class="comment">         * necessarily limited to within one window.</span>
<a name="l00531"></a>00531 <span class="comment">         */</span>
<a name="l00532"></a>00532         <a class="code" href="group__gfx__gfx.html#gae49753292f3bea04f21414bb2e505b7e" title="Set the clipping region.">gfx_set_clipping</a>(0, 0, <a class="code" href="group__gfx__gfx.html#ga08c77dc3294e612b75aa054f77f22773" title="Return the current width of the screen.">gfx_get_width</a>() - 1, <a class="code" href="group__gfx__gfx.html#ga18bda375fb523cfcb6f41862be5ba7b4" title="Return the current height of the screen.">gfx_get_height</a>() - 1);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534         <span class="comment">// Store screen underneath and draw drag origin symbol.</span>
<a name="l00535"></a>00535         <a class="code" href="group__gfx__gfx.html#ga835cfb5e02e4d19b57f65b45ed6e998b" title="Read a rectangular block of pixels from the screen into data memory.">gfx_get_pixmap</a>(<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a>, WTK_DRAG_PIXMAP_SIZE, 0, 0,
<a name="l00536"></a>00536                         <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00537"></a>00537                         <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00538"></a>00538                         WTK_DRAG_PIXMAP_SIZE, WTK_DRAG_PIXMAP_SIZE);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540         <a class="code" href="group__gfx__gfx.html#gac55aec68e262df67df981b646307bafd" title="Draw a filled circle or sector.">gfx_draw_filled_circle</a>(<a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x, <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y,
<a name="l00541"></a>00541                         <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00542"></a>00542                         <a class="code" href="group__gfx__wtk__frame.html#ga0e6dd2d848a29017a9eec2c69cbbdb82" title="Drag origin handle color.">WTK_DRAG_ORIGIN_COLOR</a>, <a class="code" href="group__gfx__gfx.html#gad283af10f27ea2911968518b9de0d82c" title="Bitmask for drawing whole circle.">GFX_WHOLE</a>);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <span class="comment">// Store screen underneath and draw drag target symbol.</span>
<a name="l00545"></a>00545         <a class="code" href="group__gfx__gfx.html#ga835cfb5e02e4d19b57f65b45ed6e998b" title="Read a rectangular block of pixels from the screen into data memory.">gfx_get_pixmap</a>(<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>, WTK_DRAG_PIXMAP_SIZE, 0, 0,
<a name="l00546"></a>00546                         pos-&gt;x - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00547"></a>00547                         pos-&gt;y - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00548"></a>00548                         WTK_DRAG_PIXMAP_SIZE, WTK_DRAG_PIXMAP_SIZE);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         <a class="code" href="group__gfx__gfx.html#gac55aec68e262df67df981b646307bafd" title="Draw a filled circle or sector.">gfx_draw_filled_circle</a>(pos-&gt;x, pos-&gt;y,
<a name="l00551"></a>00551                         <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00552"></a>00552                         <a class="code" href="group__gfx__wtk__frame.html#gad24f34bee7ba6316ad6c1174a0681e06" title="Drag target handle color.">WTK_DRAG_TARGET_COLOR</a>, <a class="code" href="group__gfx__gfx.html#gad283af10f27ea2911968518b9de0d82c" title="Bitmask for drawing whole circle.">GFX_WHOLE</a>);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="keywordflow">return</span>;
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 outofmem_target:
<a name="l00557"></a>00557         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a>);
<a name="l00558"></a>00558         <a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a> = NULL;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 outofmem_origin:
<a name="l00561"></a>00561         <span class="keywordflow">return</span>;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00575"></a><a class="code" href="wtk__frame_8c.html#aa9cb55a075e6dfd0a9152ae9bbbe2537">00575</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#aa9cb55a075e6dfd0a9152ae9bbbe2537">wtk_continue_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *last_pos,
<a name="l00576"></a>00576                 <span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578         <span class="comment">// Don&#39;t do any graphics if we did not get memory when drag started.</span>
<a name="l00579"></a>00579         <span class="keywordflow">if</span> (!<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a> || !<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>) {
<a name="l00580"></a>00580                 <span class="keywordflow">return</span>;
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         <span class="comment">/* Make sure we can draw on the entire screen, since dragging is not</span>
<a name="l00584"></a>00584 <span class="comment">         * necessarily limited to within one window.</span>
<a name="l00585"></a>00585 <span class="comment">         */</span>
<a name="l00586"></a>00586         <a class="code" href="group__gfx__gfx.html#gae49753292f3bea04f21414bb2e505b7e" title="Set the clipping region.">gfx_set_clipping</a>(0, 0, <a class="code" href="group__gfx__gfx.html#ga08c77dc3294e612b75aa054f77f22773" title="Return the current width of the screen.">gfx_get_width</a>() - 1, <a class="code" href="group__gfx__gfx.html#ga18bda375fb523cfcb6f41862be5ba7b4" title="Return the current height of the screen.">gfx_get_height</a>() - 1);
<a name="l00587"></a>00587 
<a name="l00588"></a>00588         <span class="comment">// Restore screen underneath drag target symbol.</span>
<a name="l00589"></a>00589         <a class="code" href="group__gfx__gfx.html#ga4a45ee8a6eed162b76123b3126599510" title="Write a rectangular block of pixels stored in data memory to the screen.">gfx_put_pixmap</a>(<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, 0, 0,
<a name="l00590"></a>00590                         last_pos-&gt;x - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00591"></a>00591                         last_pos-&gt;y - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00592"></a>00592                         <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         <span class="comment">// Store screen underneath and draw new drag target symbol.</span>
<a name="l00595"></a>00595         <a class="code" href="group__gfx__gfx.html#ga835cfb5e02e4d19b57f65b45ed6e998b" title="Read a rectangular block of pixels from the screen into data memory.">gfx_get_pixmap</a>(<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, 0, 0,
<a name="l00596"></a>00596                         pos-&gt;x - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00597"></a>00597                         pos-&gt;y - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00598"></a>00598                         <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <a class="code" href="group__gfx__gfx.html#gac55aec68e262df67df981b646307bafd" title="Draw a filled circle or sector.">gfx_draw_filled_circle</a>(pos-&gt;x, pos-&gt;y,
<a name="l00601"></a>00601                         <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00602"></a>00602                         <a class="code" href="group__gfx__wtk__frame.html#gad24f34bee7ba6316ad6c1174a0681e06" title="Drag target handle color.">WTK_DRAG_TARGET_COLOR</a>, <a class="code" href="group__gfx__gfx.html#gad283af10f27ea2911968518b9de0d82c" title="Bitmask for drawing whole circle.">GFX_WHOLE</a>);
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00612"></a><a class="code" href="wtk__frame_8c.html#ab7b47152dce8bf71c738ffffdf89a38e">00612</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="wtk__frame_8c.html#ab7b47152dce8bf71c738ffffdf89a38e">wtk_stop_drag</a>(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *last_pos)
<a name="l00613"></a>00613 {
<a name="l00614"></a>00614         <span class="comment">// Don&#39;t do any graphics if we did not get memory when drag started.</span>
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (!<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a> || !<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>) {
<a name="l00616"></a>00616                 <span class="keywordflow">return</span>;
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         <span class="comment">/* Make sure we can draw on the entire screen, since dragging is not</span>
<a name="l00620"></a>00620 <span class="comment">         * necessarily limited to within one window.</span>
<a name="l00621"></a>00621 <span class="comment">         */</span>
<a name="l00622"></a>00622         <a class="code" href="group__gfx__gfx.html#gae49753292f3bea04f21414bb2e505b7e" title="Set the clipping region.">gfx_set_clipping</a>(0, 0, <a class="code" href="group__gfx__gfx.html#ga08c77dc3294e612b75aa054f77f22773" title="Return the current width of the screen.">gfx_get_width</a>() - 1, <a class="code" href="group__gfx__gfx.html#ga18bda375fb523cfcb6f41862be5ba7b4" title="Return the current height of the screen.">gfx_get_height</a>() - 1);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         <span class="comment">// Restore screen underneath drag origin symbol.</span>
<a name="l00625"></a>00625         <a class="code" href="group__gfx__gfx.html#ga4a45ee8a6eed162b76123b3126599510" title="Write a rectangular block of pixels stored in data memory to the screen.">gfx_put_pixmap</a>(<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, 0, 0,
<a name="l00626"></a>00626                         <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.x - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00627"></a>00627                         <a class="code" href="wtk__frame_8c.html#a89512ba2c6c3b09c85cb60d6a2d67f00" title="Drag origin position during drag operations.">wtk_drag_origin</a>.y - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00628"></a>00628                         <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630         <span class="comment">// Restore screen underneath drag target symbol.</span>
<a name="l00631"></a>00631         <a class="code" href="group__gfx__gfx.html#ga4a45ee8a6eed162b76123b3126599510" title="Write a rectangular block of pixels stored in data memory to the screen.">gfx_put_pixmap</a>(<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, 0, 0,
<a name="l00632"></a>00632                         last_pos-&gt;x - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00633"></a>00633                         last_pos-&gt;y - <a class="code" href="group__gfx__wtk__frame.html#gad007fdeb5477b49783cc4e8cacd83a00" title="Radius of drag origin and target handles.">WTK_DRAG_HANDLE_RADIUS</a>,
<a name="l00634"></a>00634                         <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>, <a class="code" href="group__gfx__wtk__frame.html#gad638c8d7a3ee1c0f04ad8a5b81ee5cd6" title="Pixmap pixel count for storing drag handle background graphics.">WTK_DRAG_PIXMAP_SIZE</a>);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <span class="comment">// Free memory when not dragging.</span>
<a name="l00637"></a>00637         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(<a class="code" href="wtk__frame_8c.html#a1f6cff9e2125b74e89a58ff318a507a1" title="Storage for saved screen beneath drag origin, NULL when not dragging.">wtk_drag_origin_pixmap</a>);
<a name="l00638"></a>00638         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(<a class="code" href="wtk__frame_8c.html#aa91dfccb931b9c0231f189493dc4505b" title="Storage for saved screen beneath drag target, NULL when not dragging.">wtk_drag_target_pixmap</a>);
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="preprocessor">#if (WTK_FRAME_SHADESIZE &gt; 0)</span>
<a name="l00642"></a>00642 <span class="preprocessor"></span>
<a name="l00652"></a>00652 <span class="keyword">static</span> <span class="keywordtype">void</span> wtk_shade_frame(<span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *origin,
<a name="l00653"></a>00653                 <span class="keyword">struct</span> <a class="code" href="structwin__point.html" title="Geometric type describing a point or vector on screen, relative or absolute.">win_point</a> <span class="keyword">const</span> *<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655         <span class="comment">/* The drop shadow will be drawn as three parts, left, right and bottom,</span>
<a name="l00656"></a>00656 <span class="comment">         * as shown in the figure below. The # is the border, and the numbers</span>
<a name="l00657"></a>00657 <span class="comment">         * are indices into the wtk_frame_shades table. The left and right</span>
<a name="l00658"></a>00658 <span class="comment">         * shades are shown in an &quot;exploded&quot; view, and is of course ajacent to</span>
<a name="l00659"></a>00659 <span class="comment">         * the border.</span>
<a name="l00660"></a>00660 <span class="comment">         *</span>
<a name="l00661"></a>00661 <span class="comment">         *       #########################       -   -</span>
<a name="l00662"></a>00662 <span class="comment">         *     3 #  Caption              # 3     |   |</span>
<a name="l00663"></a>00663 <span class="comment">         *    23 #-----------------------# 32    |   |</span>
<a name="l00664"></a>00664 <span class="comment">         *   123 #                       # 321   |   |</span>
<a name="l00665"></a>00665 <span class="comment">         *  0123 #  Contents             # 3210  |   |</span>
<a name="l00666"></a>00666 <span class="comment">         *  0123 #                       # 3210  |   |</span>
<a name="l00667"></a>00667 <span class="comment">         *  0123 #                       # 3210  |   |</span>
<a name="l00668"></a>00668 <span class="comment">         *  0123 #                       # 3210  |   |</span>
<a name="l00669"></a>00669 <span class="comment">         *  0123 ######################### 3210  |   - height of contents window</span>
<a name="l00670"></a>00670 <span class="comment">         *  0123 3333333333333333333333333 3210  |</span>
<a name="l00671"></a>00671 <span class="comment">         *  012 222222222222222222222222222 210  |</span>
<a name="l00672"></a>00672 <span class="comment">         *  01 11111111111111111111111111111 10  |</span>
<a name="l00673"></a>00673 <span class="comment">         *  0 0000000000000000000000000000000 0  - height of container window</span>
<a name="l00674"></a>00674 <span class="comment">         *</span>
<a name="l00675"></a>00675 <span class="comment">         *       |-----------------------| width of contents window</span>
<a name="l00676"></a>00676 <span class="comment">         *</span>
<a name="l00677"></a>00677 <span class="comment">         *   |-------------------------------| width of container window</span>
<a name="l00678"></a>00678 <span class="comment">         */</span>
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">// Allocate enough space for the longest horizontal line to be shaded.</span>
<a name="l00681"></a>00681         <a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a> *pixmap = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>((size-&gt;x - 2) * <span class="keyword">sizeof</span>(<a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a>));
<a name="l00682"></a>00682         <span class="keywordflow">if</span> (!pixmap) {
<a name="l00683"></a>00683                 <span class="keywordflow">return</span>;
<a name="l00684"></a>00684         }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686         <span class="comment">// Shade bottom area, line by line, from bottom and upwards.</span>
<a name="l00687"></a>00687         <span class="keywordflow">for</span> (<a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> i = 0; i &lt; <a class="code" href="group__gfx__wtk__frame.html#gad9a18af7489fb0d0840da48e72e96df7" title="Size of drop shadow area outside left/bottom/right border. 0 = no shadow.">WTK_FRAME_SHADESIZE</a>; ++i) {
<a name="l00688"></a>00688                 <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>     length = size-&gt;x - 2 - (i * 2);
<a name="l00689"></a>00689                 <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>         alpha = <a class="code" href="group__progmem__group.html#ga1843032b3f61fd8222e3bbdd72a15f8f" title="Read a byte stored at address p in program memory.">progmem_read8</a>(wtk_frame_shades + i);
<a name="l00690"></a>00690                 <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>        idx;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692                 <span class="comment">// Get old graphics.</span>
<a name="l00693"></a>00693                 <a class="code" href="group__gfx__gfx.html#ga835cfb5e02e4d19b57f65b45ed6e998b" title="Read a rectangular block of pixels from the screen into data memory.">gfx_get_pixmap</a>(pixmap, length, 0, 0, origin-&gt;x + 1 + i,
<a name="l00694"></a>00694                                 origin-&gt;y + size-&gt;y - 1 - i, length, 1);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696                 <span class="comment">// Shade the line.</span>
<a name="l00697"></a>00697                 <span class="keywordflow">for</span> (idx = 0; idx &lt; length; ++idx) {
<a name="l00698"></a>00698                         <a class="code" href="group__gfx__wtk.html#ga05eebb924b8435b2255c469e0be9887c">wtk_shade_pixel</a>(pixmap + idx, alpha);
<a name="l00699"></a>00699                 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701                 <span class="comment">// Draw shaded line.</span>
<a name="l00702"></a>00702                 <a class="code" href="group__gfx__gfx.html#ga4a45ee8a6eed162b76123b3126599510" title="Write a rectangular block of pixels stored in data memory to the screen.">gfx_put_pixmap</a>(pixmap, length, 0, 0, origin-&gt;x + 1 + i,
<a name="l00703"></a>00703                                 origin-&gt;y + size-&gt;y - 1 - i, length, 1);
<a name="l00704"></a>00704         }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706         <span class="comment">// Free allocated mem.</span>
<a name="l00707"></a>00707         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(pixmap);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="comment">// Allocate again, now accommodate for longest vertical line to be shaded.</span>
<a name="l00710"></a>00710         pixmap = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>((size-&gt;y - WTK_FRAME_SHADESIZE) *
<a name="l00711"></a>00711                         <span class="keyword">sizeof</span>(<a class="code" href="group__gfx__gfx.html#ga3512fa493d2ad9c2192af24f6d3eff5c" title="Data type for color values native to the display.">gfx_color_t</a>));
<a name="l00712"></a>00712         <span class="keywordflow">if</span> (!pixmap) {
<a name="l00713"></a>00713                 <span class="keywordflow">return</span>;
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         <span class="comment">// Shade left and right areas, from outside and inwards.</span>
<a name="l00717"></a>00717         <span class="keywordflow">for</span> (<a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> i = 0; i &lt; WTK_FRAME_SHADESIZE; ++i) {
<a name="l00718"></a>00718                 <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>     length = size-&gt;y - WTK_FRAME_SHADESIZE;
<a name="l00719"></a>00719                 <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>         alpha = <a class="code" href="group__progmem__group.html#ga1843032b3f61fd8222e3bbdd72a15f8f" title="Read a byte stored at address p in program memory.">progmem_read8</a>(wtk_frame_shades + i);
<a name="l00720"></a>00720                 <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>        idx;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                 <span class="comment">// Get old graphics for left side.</span>
<a name="l00723"></a>00723                 <a class="code" href="group__gfx__gfx.html#ga835cfb5e02e4d19b57f65b45ed6e998b" title="Read a rectangular block of pixels from the screen into data memory.">gfx_get_pixmap</a>(pixmap, 1, 0, 0, origin-&gt;x + i,
<a name="l00724"></a>00724                                 origin-&gt;y + WTK_FRAME_SHADESIZE - i, 1, length);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726                 <span class="comment">// Shade the line.</span>
<a name="l00727"></a>00727                 <span class="keywordflow">for</span> (idx = 0; idx &lt; length; ++idx) {
<a name="l00728"></a>00728                         <a class="code" href="group__gfx__wtk.html#ga05eebb924b8435b2255c469e0be9887c">wtk_shade_pixel</a>(pixmap + idx, alpha);
<a name="l00729"></a>00729                 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731                 <span class="comment">// Draw shaded line.</span>
<a name="l00732"></a>00732                 <a class="code" href="group__gfx__gfx.html#ga4a45ee8a6eed162b76123b3126599510" title="Write a rectangular block of pixels stored in data memory to the screen.">gfx_put_pixmap</a>(pixmap, 1, 0, 0, origin-&gt;x + i,
<a name="l00733"></a>00733                                 origin-&gt;y + WTK_FRAME_SHADESIZE - i, 1, length);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735                 <span class="comment">// Get old graphics for right side.</span>
<a name="l00736"></a>00736                 <a class="code" href="group__gfx__gfx.html#ga835cfb5e02e4d19b57f65b45ed6e998b" title="Read a rectangular block of pixels from the screen into data memory.">gfx_get_pixmap</a>(pixmap, 1, 0, 0, origin-&gt;x + size-&gt;x - 1 - i,
<a name="l00737"></a>00737                                 origin-&gt;y + WTK_FRAME_SHADESIZE - i, 1, length);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                 <span class="comment">// Shade the line.</span>
<a name="l00740"></a>00740                 <span class="keywordflow">for</span> (idx = 0; idx &lt; length; ++idx) {
<a name="l00741"></a>00741                         <a class="code" href="group__gfx__wtk.html#ga05eebb924b8435b2255c469e0be9887c">wtk_shade_pixel</a>(pixmap + idx, alpha);
<a name="l00742"></a>00742                 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744                 <span class="comment">// Draw shaded line.</span>
<a name="l00745"></a>00745                 <a class="code" href="group__gfx__gfx.html#ga4a45ee8a6eed162b76123b3126599510" title="Write a rectangular block of pixels stored in data memory to the screen.">gfx_put_pixmap</a>(pixmap, 1, 0, 0, origin-&gt;x + size-&gt;x - 1 - i,
<a name="l00746"></a>00746                                 origin-&gt;y + WTK_FRAME_SHADESIZE - i, 1, length);
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="comment">// Free allocated memory.</span>
<a name="l00750"></a>00750         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(pixmap);
<a name="l00751"></a>00751 }
<a name="l00752"></a>00752 <span class="preprocessor">#endif</span>
<a name="l00753"></a>00753 <span class="preprocessor"></span>
<a name="l00764"></a><a class="code" href="group__gfx__wtk__frame.html#gaec44ce15831a8487a041010d66df6c2a">00764</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="group__gfx__wtk__frame.html#gaec44ce15831a8487a041010d66df6c2a">wtk_frame_handler</a>(<span class="keyword">struct</span> <a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *win,
<a name="l00765"></a>00765                 <span class="keyword">enum</span> <a class="code" href="group__gfx__win.html#gafd48398368ba40935ca545757cb796a6" title="Valid event types sent to a window event handler.">win_event_type</a> type, <span class="keywordtype">void</span> <span class="keyword">const</span> *data)
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767         <span class="comment">// Custom data for windows of a widget points back to the widget itself.</span>
<a name="l00768"></a>00768         <span class="keyword">struct </span><a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *frame = (<span class="keyword">struct </span><a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *)<a class="code" href="group__gfx__win.html#ga78b99e57a2493c4861f2d73863d12cf3" title="Get window custom data.">win_get_custom_data</a>(win);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770         <span class="keywordflow">switch</span> (type) {
<a name="l00771"></a>00771         <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6ac6e863c463516b27f2d89eed008cacb6" title="Request to draw contents, after background.">WIN_EVENT_DRAW</a>:
<a name="l00772"></a>00772                 {
<a name="l00773"></a>00773                         <span class="comment">/* For DRAW events, the data parameter points to the</span>
<a name="l00774"></a>00774 <span class="comment">                         * clipping region.</span>
<a name="l00775"></a>00775 <span class="comment">                         */</span>
<a name="l00776"></a>00776                         <span class="keyword">struct </span><a class="code" href="structwin__clip__region.html" title="Geometric type describing a clipping region, used when drawing windows.">win_clip_region</a> const *clip =
<a name="l00777"></a>00777                                         (<span class="keyword">struct </span><a class="code" href="structwin__clip__region.html" title="Geometric type describing a clipping region, used when drawing windows.">win_clip_region</a> const *)data;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779                         <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> const *area = <a class="code" href="group__gfx__win.html#ga3b36b88b8811da7248eb23bc9af1c504" title="Get a pointer to the window area struct.">win_get_area</a>(win);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781                         <span class="comment">// Draw frame decorations if this is the container window.</span>
<a name="l00782"></a>00782                         <span class="keywordflow">if</span> (win == frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>) {
<a name="l00783"></a>00783                                 <span class="comment">// Draw left border.</span>
<a name="l00784"></a>00784                                 <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00785"></a>00785                                                 WTK_FRAME_SHADESIZE,
<a name="l00786"></a>00786                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y,
<a name="l00787"></a>00787                                                 WTK_FRAME_LEFTBORDER,
<a name="l00788"></a>00788                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y -
<a name="l00789"></a>00789                                                 WTK_FRAME_SHADESIZE,
<a name="l00790"></a>00790                                                 <a class="code" href="group__gfx__wtk__frame.html#gafc5c27f53a7360fd11d04630517d6b61" title="Frame border color.">WTK_FRAME_BORDER_COLOR</a>);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792                                 <span class="comment">// Draw right border.</span>
<a name="l00793"></a>00793                                 <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00794"></a>00794                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x -
<a name="l00795"></a>00795                                                 WTK_FRAME_SHADESIZE -
<a name="l00796"></a>00796                                                 <a class="code" href="group__gfx__wtk__frame.html#ga278ce1b146da9eafc0f534ac57dc6f9f" title="Left frame border size.">WTK_FRAME_RIGHTBORDER</a>,
<a name="l00797"></a>00797                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y,
<a name="l00798"></a>00798                                                 <a class="code" href="group__gfx__wtk__frame.html#ga278ce1b146da9eafc0f534ac57dc6f9f" title="Left frame border size.">WTK_FRAME_RIGHTBORDER</a>,
<a name="l00799"></a>00799                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y -
<a name="l00800"></a>00800                                                 WTK_FRAME_SHADESIZE,
<a name="l00801"></a>00801                                                 <a class="code" href="group__gfx__wtk__frame.html#gafc5c27f53a7360fd11d04630517d6b61" title="Frame border color.">WTK_FRAME_BORDER_COLOR</a>);
<a name="l00802"></a>00802 
<a name="l00803"></a>00803                                 <span class="comment">// Draw top border.</span>
<a name="l00804"></a>00804                                 <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00805"></a>00805                                                 WTK_FRAME_SHADESIZE +
<a name="l00806"></a>00806                                                 WTK_FRAME_LEFTBORDER,
<a name="l00807"></a>00807                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y,
<a name="l00808"></a>00808                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x -
<a name="l00809"></a>00809                                                 (WTK_FRAME_SHADESIZE * 2) -
<a name="l00810"></a>00810                                                 WTK_FRAME_LEFTBORDER -
<a name="l00811"></a>00811                                                 <a class="code" href="group__gfx__wtk__frame.html#ga278ce1b146da9eafc0f534ac57dc6f9f" title="Left frame border size.">WTK_FRAME_RIGHTBORDER</a>,
<a name="l00812"></a>00812                                                 <a class="code" href="group__gfx__wtk__frame.html#gaa0c521b383427197d98150a1a1124784" title="Top frame border size.">WTK_FRAME_TOPBORDER</a>,
<a name="l00813"></a>00813                                                 <a class="code" href="group__gfx__wtk__frame.html#gafc5c27f53a7360fd11d04630517d6b61" title="Frame border color.">WTK_FRAME_BORDER_COLOR</a>);
<a name="l00814"></a>00814 
<a name="l00815"></a>00815                                 <span class="comment">// Draw bottom border.</span>
<a name="l00816"></a>00816                                 <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00817"></a>00817                                                 WTK_FRAME_SHADESIZE +
<a name="l00818"></a>00818                                                 WTK_FRAME_LEFTBORDER,
<a name="l00819"></a>00819                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y + area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y -
<a name="l00820"></a>00820                                                 WTK_FRAME_SHADESIZE -
<a name="l00821"></a>00821                                                 <a class="code" href="group__gfx__wtk__frame.html#gab197078b3b6abc79a5ac53fdd1284325" title="Bottom frame border size.">WTK_FRAME_BOTTOMBORDER</a>,
<a name="l00822"></a>00822                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x -
<a name="l00823"></a>00823                                                 (WTK_FRAME_SHADESIZE * 2) -
<a name="l00824"></a>00824                                                 WTK_FRAME_LEFTBORDER -
<a name="l00825"></a>00825                                                 <a class="code" href="group__gfx__wtk__frame.html#ga278ce1b146da9eafc0f534ac57dc6f9f" title="Left frame border size.">WTK_FRAME_RIGHTBORDER</a>,
<a name="l00826"></a>00826                                                 <a class="code" href="group__gfx__wtk__frame.html#gab197078b3b6abc79a5ac53fdd1284325" title="Bottom frame border size.">WTK_FRAME_BOTTOMBORDER</a>,
<a name="l00827"></a>00827                                                 <a class="code" href="group__gfx__wtk__frame.html#gafc5c27f53a7360fd11d04630517d6b61" title="Frame border color.">WTK_FRAME_BORDER_COLOR</a>);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829                                 <span class="comment">// Draw title bar background.</span>
<a name="l00830"></a>00830                                 <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00831"></a>00831                                                 WTK_FRAME_SHADESIZE +
<a name="l00832"></a>00832                                                 WTK_FRAME_LEFTBORDER,
<a name="l00833"></a>00833                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y +
<a name="l00834"></a>00834                                                 <a class="code" href="group__gfx__wtk__frame.html#gaa0c521b383427197d98150a1a1124784" title="Top frame border size.">WTK_FRAME_TOPBORDER</a>,
<a name="l00835"></a>00835                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x -
<a name="l00836"></a>00836                                                 WTK_FRAME_LEFTBORDER -
<a name="l00837"></a>00837                                                 <a class="code" href="group__gfx__wtk__frame.html#ga278ce1b146da9eafc0f534ac57dc6f9f" title="Left frame border size.">WTK_FRAME_RIGHTBORDER</a> -
<a name="l00838"></a>00838                                                 (WTK_FRAME_SHADESIZE * 2),
<a name="l00839"></a>00839                                                 <a class="code" href="group__gfx__wtk__frame.html#ga09c5f60fbace2b50d930c04beeda5651" title="Height of titlebar area.">WTK_FRAME_TITLEBAR_HEIGHT</a>,
<a name="l00840"></a>00840                                                 <a class="code" href="group__gfx__wtk__frame.html#gac83c9d3fb585591efd2fddfe7e635e34" title="Background color of frame title bar.">WTK_FRAME_TITLEBAR_COLOR</a>);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842                                 <span class="comment">// Draw caption string.</span>
<a name="l00843"></a>00843                                 <a class="code" href="group__gfx__gfx.html#gaf6bb28b793aa67278db46230b72d6c50" title="Draws a string to the display.">gfx_draw_string</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>,
<a name="l00844"></a>00844                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00845"></a>00845                                                 WTK_FRAME_SHADESIZE +
<a name="l00846"></a>00846                                                 WTK_FRAME_LEFTBORDER +
<a name="l00847"></a>00847                                                 <a class="code" href="group__gfx__wtk__frame.html#ga7ded0db97a4009266ff4fd2b6782d8bd" title="Caption text X offset inside title bar.">WTK_FRAME_CAPTION_X</a>,
<a name="l00848"></a>00848                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y +
<a name="l00849"></a>00849                                                 <a class="code" href="group__gfx__wtk__frame.html#gaa0c521b383427197d98150a1a1124784" title="Top frame border size.">WTK_FRAME_TOPBORDER</a> +
<a name="l00850"></a>00850                                                 <a class="code" href="group__gfx__wtk__frame.html#gad1ab03f3f473f278f676de5be7a7978b" title="Caption text Y offset inside title bar.">WTK_FRAME_CAPTION_Y</a>, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>,
<a name="l00851"></a>00851                                                 <a class="code" href="group__gfx__wtk__frame.html#ga3c9959a3dd11513f7949e3ae4a88ba86" title="Caption text foreground color.">WTK_FRAME_CAPTION_COLOR</a>,
<a name="l00852"></a>00852                                                 <a class="code" href="group__gfx__gfx.html#gab8aa45e3febdfb476408dffba0cc0103" title="Value used as input to font functions to give a transparent background region.">GFX_COLOR_TRANSPARENT</a>);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 <span class="preprocessor">#if (WTK_FRAME_SHADESIZE &gt; 0)</span>
<a name="l00855"></a>00855 <span class="preprocessor"></span>                                <span class="comment">// Draw drop shadow.</span>
<a name="l00856"></a>00856                                 wtk_shade_frame(&amp;(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>), &amp;(area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>));
<a name="l00857"></a>00857 <span class="preprocessor">#endif</span>
<a name="l00858"></a>00858 <span class="preprocessor"></span>                        }
<a name="l00859"></a>00859                         <span class="comment">// Draw resize handle if this is the resize window.</span>
<a name="l00860"></a>00860                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (win == frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>) {
<a name="l00861"></a>00861                                 <a class="code" href="group__gfx__gfx.html#gac55aec68e262df67df981b646307bafd" title="Draw a filled circle or sector.">gfx_draw_filled_circle</a>(clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.x +
<a name="l00862"></a>00862                                                 area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x - 1,
<a name="l00863"></a>00863                                                 clip-&gt;<a class="code" href="structwin__clip__region.html#a5989475e9092c659a032cb6d4dd99353" title="Absolute coordinates of top-left window corner.">origin</a>.y + area-&gt;<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y -
<a name="l00864"></a>00864                                                 1, <a class="code" href="group__gfx__wtk__frame.html#ga62964af66facd6dd04484a608ba55243" title="Radius of resize handle (second quadrant of circle).">WTK_FRAME_RESIZE_RADIUS</a>,
<a name="l00865"></a>00865                                                 <a class="code" href="group__gfx__wtk__frame.html#ga329a6697dc4279c376edea35966e9062" title="Resize handle color.">WTK_FRAME_RESIZE_COLOR</a>,
<a name="l00866"></a>00866                                                 <a class="code" href="group__gfx__gfx.html#ga8a2a9faf96d4b4d70ddded417050a070" title="Bitmask for drawing circle quadrant 1.">GFX_QUADRANT1</a>);
<a name="l00867"></a>00867                         }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869                         <span class="comment">/* Always accept DRAW events, as the return value is</span>
<a name="l00870"></a>00870 <span class="comment">                         * ignored anyway for that event type.</span>
<a name="l00871"></a>00871 <span class="comment">                         */</span>
<a name="l00872"></a>00872                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00873"></a>00873                 }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6a1e0c0b12cd9f4c453412c5a2437520ac" title="Pointer event, more details in the event itself.">WIN_EVENT_POINTER</a>:
<a name="l00876"></a>00876                 {
<a name="l00877"></a>00877                         <span class="comment">/* For POINTER events, the data parameter points to the</span>
<a name="l00878"></a>00878 <span class="comment">                         * pointer event information.</span>
<a name="l00879"></a>00879 <span class="comment">                         */</span>
<a name="l00880"></a>00880                         <span class="keyword">struct </span><a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> const *<span class="keyword">event</span> =
<a name="l00881"></a>00881                                         (<span class="keyword">struct </span><a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> const *)data;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883                         <span class="comment">// Handle move if this is the container window.</span>
<a name="l00884"></a>00884                         <span class="keywordflow">if</span> (win == frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>) {
<a name="l00885"></a>00885                                 <span class="keywordflow">switch</span> (event-&gt;type) {
<a name="l00886"></a>00886 
<a name="l00887"></a>00887                                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2accdf9dcd8cdb612477834cf3fbc47cf8" title="One or more buttons have been pressed somewhere.">WIN_POINTER_PRESS</a>:
<a name="l00888"></a>00888                                         <a class="code" href="wtk__frame_8c.html#abbc8c1e5b228164290cb2dd5de11c219">wtk_handle_frame_press</a>(frame, event);
<a name="l00889"></a>00889                                         <span class="keywordflow">break</span>;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891                                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2acf38ef7bba0b554929a29b4dabc76815" title="Pointer has moved, with or without buttons.">WIN_POINTER_MOVE</a>:
<a name="l00892"></a>00892                                         <a class="code" href="wtk__frame_8c.html#a953898f5465df55df2aaf9a9332a70aa">wtk_handle_frame_move</a>(frame, event);
<a name="l00893"></a>00893                                         <span class="keywordflow">break</span>;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895                                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2a5d9a8016905f31b1c7726370b2f7f0de" title="One or more buttons have been released somewhere.">WIN_POINTER_RELEASE</a>:
<a name="l00896"></a>00896                                         <a class="code" href="wtk__frame_8c.html#a8b53a9fd936b7ad9c6e3b912c9caa056">wtk_handle_frame_release</a>(frame, event);
<a name="l00897"></a>00897                                         <span class="keywordflow">break</span>;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899                                 <span class="keywordflow">default</span>:
<a name="l00900"></a>00900                                         <span class="keywordflow">break</span>;
<a name="l00901"></a>00901                                 }
<a name="l00902"></a>00902                         }
<a name="l00903"></a>00903                         <span class="comment">// Handle resize if this is the resize handle.</span>
<a name="l00904"></a>00904                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (win == frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>) {
<a name="l00905"></a>00905                                 <span class="keywordflow">switch</span> (event-&gt;type) {
<a name="l00906"></a>00906 
<a name="l00907"></a>00907                                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2accdf9dcd8cdb612477834cf3fbc47cf8" title="One or more buttons have been pressed somewhere.">WIN_POINTER_PRESS</a>:
<a name="l00908"></a>00908                                         <a class="code" href="wtk__frame_8c.html#a007a1faefd34ee3328061a28400e7846">wtk_handle_resize_press</a>(frame, event);
<a name="l00909"></a>00909                                         <span class="keywordflow">break</span>;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911                                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2acf38ef7bba0b554929a29b4dabc76815" title="Pointer has moved, with or without buttons.">WIN_POINTER_MOVE</a>:
<a name="l00912"></a>00912                                         <a class="code" href="wtk__frame_8c.html#a49a537398b2cad221c9ce5a6214c3ffb">wtk_handle_resize_move</a>(frame, event);
<a name="l00913"></a>00913                                         <span class="keywordflow">break</span>;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915                                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2a5d9a8016905f31b1c7726370b2f7f0de" title="One or more buttons have been released somewhere.">WIN_POINTER_RELEASE</a>:
<a name="l00916"></a>00916                                         <a class="code" href="wtk__frame_8c.html#a8bf601a69e3951c15fd4d43ab3911bef">wtk_handle_resize_release</a>(frame, event);
<a name="l00917"></a>00917                                         <span class="keywordflow">break</span>;
<a name="l00918"></a>00918 
<a name="l00919"></a>00919                                 <span class="keywordflow">default</span>:
<a name="l00920"></a>00920                                         <span class="keywordflow">break</span>;
<a name="l00921"></a>00921                                 }
<a name="l00922"></a>00922                         }
<a name="l00923"></a>00923                         <span class="comment">/* Accept all POINTER events so that it does not</span>
<a name="l00924"></a>00924 <span class="comment">                         * propagate up the window tree to our parent in case</span>
<a name="l00925"></a>00925 <span class="comment">                         * we did not click anything useful inside the frame.</span>
<a name="l00926"></a>00926 <span class="comment">                         */</span>
<a name="l00927"></a>00927                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00928"></a>00928                 }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6a4a13cc3406aa6b2ebb9e40a1fc111a64" title="Request to free all allocated memory.">WIN_EVENT_DESTROY</a>:
<a name="l00931"></a>00931                 {
<a name="l00932"></a>00932                         <span class="comment">/* When the container window is destroyed, also destroy</span>
<a name="l00933"></a>00933 <span class="comment">                         * the rest of the non-window frame allocations.</span>
<a name="l00934"></a>00934 <span class="comment">                         */</span>
<a name="l00935"></a>00935                         <span class="keywordflow">if</span> (win == frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>) {
<a name="l00936"></a>00936                                 <span class="comment">/* Memory allocated for windows will be</span>
<a name="l00937"></a>00937 <span class="comment">                                 * automatically destroyed by the window</span>
<a name="l00938"></a>00938 <span class="comment">                                 * system. We must destroy other allocations.</span>
<a name="l00939"></a>00939 <span class="comment">                                 */</span>
<a name="l00940"></a>00940                                 <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>);
<a name="l00941"></a>00941                                 <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(frame);
<a name="l00942"></a>00942                         }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944                         <span class="comment">/* Always accept DESTROY events, as the return value is</span>
<a name="l00945"></a>00945 <span class="comment">                         * ignored anyway for that event type.</span>
<a name="l00946"></a>00946 <span class="comment">                         */</span>
<a name="l00947"></a>00947                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00948"></a>00948                 }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950         <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6a43efd2381d0ac306f0029ca95a9b96a6" title="Command event, more details in the event itself.">WIN_EVENT_COMMAND</a>:
<a name="l00951"></a>00951                 {
<a name="l00952"></a>00952                         <span class="comment">/* When commands are received either directly or</span>
<a name="l00953"></a>00953 <span class="comment">                         * propagated from child widgets and windows, send it</span>
<a name="l00954"></a>00954 <span class="comment">                         * to the frame handler.</span>
<a name="l00955"></a>00955 <span class="comment">                         */</span>
<a name="l00956"></a>00956                         <span class="keywordflow">if</span> (win == frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>) {
<a name="l00957"></a>00957                                 <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structwtk__frame.html#a0069f958473f3770d3c36d74e0505236" title="Frame command event handler.">frame_handler</a>) {
<a name="l00958"></a>00958                                         <span class="comment">/* If the frame handler returns true,</span>
<a name="l00959"></a>00959 <span class="comment">                                         * it wants us to destroy the frame.</span>
<a name="l00960"></a>00960 <span class="comment">                                         * This is normally used by CLOSE</span>
<a name="l00961"></a>00961 <span class="comment">                                         * buttons.</span>
<a name="l00962"></a>00962 <span class="comment">                                         */</span>
<a name="l00963"></a>00963                                         <span class="keywordtype">bool</span> shouldDestroy =
<a name="l00964"></a>00964                                                 frame-&gt;<a class="code" href="structwtk__frame.html#a0069f958473f3770d3c36d74e0505236" title="Frame command event handler.">frame_handler</a>(frame,
<a name="l00965"></a>00965                                                                 (<a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a>)
<a name="l00966"></a>00966                                                                 data);
<a name="l00967"></a>00967 
<a name="l00968"></a>00968                                         <span class="comment">/* It is safe to destroy it here, since</span>
<a name="l00969"></a>00969 <span class="comment">                                         * the event handling finished right</span>
<a name="l00970"></a>00970 <span class="comment">                                         * after this handler returns, and no</span>
<a name="l00971"></a>00971 <span class="comment">                                         * other references to this frame or</span>
<a name="l00972"></a>00972 <span class="comment">                                         * its contents will be done.</span>
<a name="l00973"></a>00973 <span class="comment">                                         */</span>
<a name="l00974"></a>00974                                         <span class="keywordflow">if</span> (shouldDestroy) {
<a name="l00975"></a>00975                                                 <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>);
<a name="l00976"></a>00976                                         }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978                                         <span class="comment">/* Accept the event if there was a</span>
<a name="l00979"></a>00979 <span class="comment">                                         * handler installed.</span>
<a name="l00980"></a>00980 <span class="comment">                                         */</span>
<a name="l00981"></a>00981                                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00982"></a>00982                                 }
<a name="l00983"></a>00983                         }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985                         <span class="comment">/* Reject the event if there was no handler, or this</span>
<a name="l00986"></a>00986 <span class="comment">                         * was not the container window at all.</span>
<a name="l00987"></a>00987 <span class="comment">                         */</span>
<a name="l00988"></a>00988                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00989"></a>00989                 }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991         <span class="keywordflow">default</span>:
<a name="l00992"></a>00992                 <span class="comment">// Reject unknown event types.</span>
<a name="l00993"></a>00993                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995         }
<a name="l00996"></a>00996 }
<a name="l00997"></a>00997 
<a name="l01018"></a><a class="code" href="group__gfx__wtk__frame.html#ga6d0aeff2ce3cdd4e31d917beb58ad7e2">01018</a> <span class="keyword">struct </span><a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a> *<a class="code" href="group__gfx__wtk__frame.html#ga6d0aeff2ce3cdd4e31d917beb58ad7e2">wtk_frame_create</a>(<span class="keyword">struct</span> <a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *parent,
<a name="l01019"></a>01019                 <span class="keyword">struct</span> <a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a> <span class="keyword">const</span> *area,
<a name="l01020"></a>01020                 <span class="keywordtype">char</span> <span class="keyword">const</span> *<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>,
<a name="l01021"></a>01021                 <span class="keywordtype">bool</span> allow_resize,
<a name="l01022"></a>01022                 <a class="code" href="group__gfx__wtk__frame.html#ga10dc17f372979410e97fc72280fa1d6c" title="Frame command event handler callback.">wtk_frame_handler_t</a> <a class="code" href="structwtk__frame.html#a0069f958473f3770d3c36d74e0505236" title="Frame command event handler.">frame_handler</a>, <span class="keywordtype">void</span> *<a class="code" href="structwtk__frame.html#aab57402e16fb50e89971711c824ab32f" title="Data for applications and handlers.">custom_data</a>)
<a name="l01023"></a>01023 {
<a name="l01024"></a>01024         <span class="keyword">struct </span><a class="code" href="structwin__attributes.html" title="Window attribute data.">win_attributes</a>   attr;
<a name="l01025"></a>01025         <span class="keyword">struct </span><a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a>        *frame;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(area);
<a name="l01028"></a>01028         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(caption);
<a name="l01029"></a>01029         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(parent);
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         <span class="comment">// Allocate memory for frame control data.</span>
<a name="l01032"></a>01032         frame = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structwtk__frame.html" title="Frame control struct.">wtk_frame</a>));
<a name="l01033"></a>01033         <span class="keywordflow">if</span> (!frame) {
<a name="l01034"></a>01034                 <span class="keywordflow">goto</span> outofmem_frame;
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037         frame-&gt;<a class="code" href="structwtk__frame.html#a75174b114d6f6f77c1f87bb52b46f79c" title="Current state.">state</a> = <a class="code" href="wtk__frame_8c.html#aebbf5c5752355e7aaedc483e217177b3ad45a8953a62993912f25234be5ffb8c1" title="Normal state, no moving or resizing.">WTK_FRAME_NORMAL</a>;
<a name="l01038"></a>01038         frame-&gt;<a class="code" href="structwtk__frame.html#a0069f958473f3770d3c36d74e0505236" title="Frame command event handler.">frame_handler</a> = frame_handler;
<a name="l01039"></a>01039         frame-&gt;<a class="code" href="structwtk__frame.html#aab57402e16fb50e89971711c824ab32f" title="Data for applications and handlers.">custom_data</a> = custom_data;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041         <span class="comment">// Allocate memory for caption string, and copy text.</span>
<a name="l01042"></a>01042         frame-&gt;<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a> = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>((<a class="code" href="group__string__group.html#ga008e171a518fe0e0352f31b245e03875" title="Calculate the length of a string.">strlen</a>(caption) + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l01043"></a>01043         <span class="keywordflow">if</span> (!frame-&gt;<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>) {
<a name="l01044"></a>01044                 <span class="keywordflow">goto</span> outofmem_caption;
<a name="l01045"></a>01045         }
<a name="l01046"></a>01046 
<a name="l01047"></a>01047         <a class="code" href="group__gfx__wtk.html#ga64a34b691ecceeb0983905e119709871">wtk_copy_string</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>, caption);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="comment">/* Start with valid area info, but only contents frame will keep the</span>
<a name="l01050"></a>01050 <span class="comment">         * original area. The other frames will be resized properly at the end.</span>
<a name="l01051"></a>01051 <span class="comment">         * All windows have the same event handler, and the same link back to</span>
<a name="l01052"></a>01052 <span class="comment">         * the widget object.</span>
<a name="l01053"></a>01053 <span class="comment">         */</span>
<a name="l01054"></a>01054         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a> = *area;
<a name="l01055"></a>01055         attr.<a class="code" href="structwin__attributes.html#a1f7233ed770b597a93a5e1dd3c1917b8" title="Event handler callback, or NULL.">event_handler</a> = <a class="code" href="group__gfx__wtk__frame.html#gaec44ce15831a8487a041010d66df6c2a">wtk_frame_handler</a>;
<a name="l01056"></a>01056         attr.<a class="code" href="structwin__attributes.html#ae9ae6ae18bc42bfeccb37a6fa5a826c5" title="Custom window data, e.g. link to associated widget.">custom</a> = frame;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058         <span class="comment">/* Prepare transparent (if dropshade enabled) container frame, which</span>
<a name="l01059"></a>01059 <span class="comment">         * will contain title bar, border, size handle etc.</span>
<a name="l01060"></a>01060 <span class="comment">         */</span>
<a name="l01061"></a>01061         attr.<a class="code" href="structwin__attributes.html#ab3aaadedb6a8197cbd119cc7bb54ca64" title="Window background.">background</a> = NULL;
<a name="l01062"></a>01062 <span class="preprocessor">#if (WTK_FRAME_SHADESIZE == 0)</span>
<a name="l01063"></a>01063 <span class="preprocessor"></span>        attr.<a class="code" href="structwin__attributes.html#a85bccce89013dbda4173a80d27dd9f90" title="Window behavior flags.">behavior</a> = <a class="code" href="group__gfx__win.html#ga789650d3d663cbd93045f52b3dd9316e" title="Behavior mask for raising a window if itself or children are pressed.">WIN_BEHAVIOR_RAISE_ON_PRESS</a>;
<a name="l01064"></a>01064 <span class="preprocessor">#else</span>
<a name="l01065"></a>01065 <span class="preprocessor"></span>        attr.<a class="code" href="structwin__attributes.html#a85bccce89013dbda4173a80d27dd9f90" title="Window behavior flags.">behavior</a> = <a class="code" href="group__gfx__win.html#ga789650d3d663cbd93045f52b3dd9316e" title="Behavior mask for raising a window if itself or children are pressed.">WIN_BEHAVIOR_RAISE_ON_PRESS</a> |
<a name="l01066"></a>01066                         <a class="code" href="group__gfx__win.html#ga13aa1d186807bb5a1541c319e41aa6e5" title="Behavior mask for requiring redraw of parent, e.g. transparent windows.">WIN_BEHAVIOR_REDRAW_PARENT</a>;
<a name="l01067"></a>01067 <span class="preprocessor">#endif</span>
<a name="l01068"></a>01068 <span class="preprocessor"></span>
<a name="l01069"></a>01069         <span class="comment">// Create the container window, the proper size will be set later.</span>
<a name="l01070"></a>01070         frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a> = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(parent, &amp;attr);
<a name="l01071"></a>01071         <span class="keywordflow">if</span> (!frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>) {
<a name="l01072"></a>01072                 <span class="keywordflow">goto</span> outofmem_container;
<a name="l01073"></a>01073         }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075         <span class="comment">/* Prepare the contents frame, which will contain whatever controls</span>
<a name="l01076"></a>01076 <span class="comment">         * owned by the frame. Size will be equal to the given area parameter.</span>
<a name="l01077"></a>01077 <span class="comment">         */</span>
<a name="l01078"></a>01078         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = WTK_FRAME_SHADESIZE + WTK_FRAME_LEFTBORDER;
<a name="l01079"></a>01079         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = <a class="code" href="group__gfx__wtk__frame.html#gaa0c521b383427197d98150a1a1124784" title="Top frame border size.">WTK_FRAME_TOPBORDER</a> + <a class="code" href="group__gfx__wtk__frame.html#ga09c5f60fbace2b50d930c04beeda5651" title="Height of titlebar area.">WTK_FRAME_TITLEBAR_HEIGHT</a>;
<a name="l01080"></a>01080         attr.<a class="code" href="structwin__attributes.html#ab3aaadedb6a8197cbd119cc7bb54ca64" title="Window background.">background</a> = &amp;wtk_frame_background;
<a name="l01081"></a>01081         attr.<a class="code" href="structwin__attributes.html#a85bccce89013dbda4173a80d27dd9f90" title="Window behavior flags.">behavior</a> = 0;
<a name="l01082"></a>01082 
<a name="l01083"></a>01083         frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a> = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>, &amp;attr);
<a name="l01084"></a>01084         <span class="keywordflow">if</span> (!frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>) {
<a name="l01085"></a>01085                 <span class="keywordflow">goto</span> outofmem_contents;
<a name="l01086"></a>01086         }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088         <span class="comment">// Only create resize handle window if resize is allowed.</span>
<a name="l01089"></a>01089         <span class="keywordflow">if</span> (allow_resize) {
<a name="l01090"></a>01090                 <span class="comment">/* Prepare resize handle. Proper position will be set later.</span>
<a name="l01091"></a>01091 <span class="comment">                 * Size is set here, though.</span>
<a name="l01092"></a>01092 <span class="comment">                 */</span>
<a name="l01093"></a>01093                 attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = <a class="code" href="group__gfx__wtk__frame.html#ga9e8dcd2ece504f395aab159cc7a41283" title="Width of resize handle.">WTK_FRAME_RESIZE_WIDTH</a>;
<a name="l01094"></a>01094                 attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = <a class="code" href="group__gfx__wtk__frame.html#ga8006ec678770821738b2294119bb338b" title="Height of resize handle.">WTK_FRAME_RESIZE_HEIGHT</a>;
<a name="l01095"></a>01095                 attr.<a class="code" href="structwin__attributes.html#ab3aaadedb6a8197cbd119cc7bb54ca64" title="Window background.">background</a> = NULL;
<a name="l01096"></a>01096                 attr.<a class="code" href="structwin__attributes.html#a85bccce89013dbda4173a80d27dd9f90" title="Window behavior flags.">behavior</a> = 0;
<a name="l01097"></a>01097 
<a name="l01098"></a>01098                 frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a> = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>, &amp;attr);
<a name="l01099"></a>01099                 <span class="keywordflow">if</span> (!frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>) {
<a name="l01100"></a>01100                         <span class="keywordflow">goto</span> outofmem_resize;
<a name="l01101"></a>01101                 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103                 <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a>);
<a name="l01104"></a>01104         } <span class="keywordflow">else</span> {
<a name="l01105"></a>01105                 frame-&gt;<a class="code" href="structwtk__frame.html#ab0b9cb539fe701cc90a8539172d5d464" title="The resize handle window.">resize</a> = NULL;
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108         <span class="comment">/* Now, resize and rearrange according to size of contents frame, which</span>
<a name="l01109"></a>01109 <span class="comment">         * is equal to the given area parameter.</span>
<a name="l01110"></a>01110 <span class="comment">         */</span>
<a name="l01111"></a>01111         <a class="code" href="wtk__frame_8c.html#ad55fc0268cf3e16a350425330337cf6d">wtk_resize_frame</a>(frame, area);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113         <span class="comment">// Make sure internals are visible when frame is mapped.</span>
<a name="l01114"></a>01114         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>);
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         <span class="keywordflow">return</span> frame;
<a name="l01117"></a>01117 
<a name="l01118"></a>01118 outofmem_resize:
<a name="l01119"></a>01119         <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(frame-&gt;<a class="code" href="structwtk__frame.html#affa2bbb2c213124a039579b136c1fa11" title="Contents, holds child widgets.">contents</a>);
<a name="l01120"></a>01120 
<a name="l01121"></a>01121 outofmem_contents:
<a name="l01122"></a>01122         <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a13d292e2a9cbe80c9dc3d5f320fd7246" title="Container, ultimate widget parent.">container</a>);
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 outofmem_container:
<a name="l01125"></a>01125         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(frame-&gt;<a class="code" href="structwtk__frame.html#a2b5685fc03db3733030570f958bdf371" title="Copy of caption string.">caption</a>);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 outofmem_caption:
<a name="l01128"></a>01128         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(frame);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130 outofmem_frame:
<a name="l01131"></a>01131         <span class="keywordflow">return</span> NULL;
<a name="l01132"></a>01132 }
<a name="l01133"></a>01133 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:09:58 2010 for display-demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
