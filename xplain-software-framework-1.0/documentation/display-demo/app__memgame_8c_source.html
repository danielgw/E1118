<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-demo: apps/display-demo/app_memgame.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>apps/display-demo/app_memgame.c</h1><a href="app__memgame_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="gfx_8h.html" title="General graphics routines header file.">gfx/gfx.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2win_8h.html" title="Graphical Window system.">gfx/win.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2wtk_8h.html" title="Graphical Widget toolkit.">gfx/wtk.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2sysfont_8h.html" title="Graphical Window system.">gfx/sysfont.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="stream_8h.html" title="Character stream interface.">stream.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2string_8h.html" title="Standard string operations for AVR.">string.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="chip_2atxmega128a1_2include_2chip_2timer_8h.html" title="ATxmega128A1 chip-specific Timer definitions.">timer.h</a>&gt;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="app__desktop_8h.html" title="Display demo desktop application.">app_desktop.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="app__memgame_8h.html" title="Display demo memory game header file.">app_memgame.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="file__loader_8h.html" title="Display Xplained image loader.">file_loader.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="group__apps__memgame__group.html#ga4d6be359a5d1c5bb43caf0ff614a9a29">00064</a> <span class="preprocessor">#define NR_OF_PIECE_PAIRS            6</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a><a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b">00066</a> <span class="preprocessor">#define NR_OF_PIECES                 (2 * NR_OF_PIECE_PAIRS)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a><a class="code" href="group__apps__memgame__group.html#ga077e6344ae3cdd9b2973e80c99c14d81">00068</a> <span class="preprocessor">#define NR_OF_BOARD_COLUMNS          4</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="group__apps__memgame__group.html#ga71825cc52b951b36f0961bafcec583a3">00070</a> <span class="preprocessor">#define BOARD_POS_X                  30</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="group__apps__memgame__group.html#gaf180a8f9b81a5b7afee3fd91dc383323">00072</a> <span class="preprocessor">#define BOARD_POS_Y                  5</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a><a class="code" href="group__apps__memgame__group.html#ga61ae6f1ae401c962137f2ae1d2a158df">00074</a> <span class="preprocessor">#define BACKGROUND_COLOR             GFX_COLOR(0, 0, 0)</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a><a class="code" href="group__apps__memgame__group.html#ga5536e218c61e2849cea7f756ef3e516b">00076</a> <span class="preprocessor">#define WIDGET_FONT_SCALE            2</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>
<a name="l00079"></a>00079 
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="group__apps__memgame__group.html#ga8466392987ece78b4db53efa940afa9b">00087</a> <span class="preprocessor">#define PIECE_PAIR_FILE_0            &quot;i_fonts&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="group__apps__memgame__group.html#gaa82e979427e6f1d29666eabec56bdb8a">00089</a> <span class="preprocessor">#define PIECE_PAIR_FILE_1            &quot;i_pics&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a><a class="code" href="group__apps__memgame__group.html#ga080f84b8d90e66a7a5e1fe33e6c1bb80">00091</a> <span class="preprocessor">#define PIECE_PAIR_FILE_2            &quot;i_avr&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a><a class="code" href="group__apps__memgame__group.html#ga376d31d3d204ee7efe7f18a648f1b1ef">00093</a> <span class="preprocessor">#define PIECE_PAIR_FILE_3            &quot;i_clock&quot;</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a><a class="code" href="group__apps__memgame__group.html#ga2a9b4f2ebb26486e50e39b11145d8901">00095</a> <span class="preprocessor">#define PIECE_PAIR_FILE_4            &quot;i_files&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="group__apps__memgame__group.html#gab849b0cdee26b1d3a9382fad9c3f07be">00097</a> <span class="preprocessor">#define PIECE_PAIR_FILE_5            &quot;i_games&quot;</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a><a class="code" href="group__apps__memgame__group.html#ga7fd65d7eaa674c1d9f8a449aaa2d052b">00099</a> <span class="preprocessor">#define PIECE_BACK_FILE              &quot;cardback&quot;</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a><a class="code" href="group__apps__memgame__group.html#gaf164cea02d507f4ef646ff0f74ec928e">00101</a> <span class="preprocessor">#define PIECE_SIZE_X                 57</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a><a class="code" href="group__apps__memgame__group.html#ga5ced27aac77b72415cd0beb4a7c6ec8c">00103</a> <span class="preprocessor">#define PIECE_SIZE_Y                 PIECE_SIZE_X</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a><a class="code" href="group__apps__memgame__group.html#gacd47a66c8f8c32e31d9e185263c7c92d">00105</a> <span class="preprocessor">#define PIECE_SPACING_X              10</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="group__apps__memgame__group.html#gae0ea911d54115fd70e55d158485fc2fb">00107</a> <span class="preprocessor">#define PIECE_SPACING_Y              PIECE_SPACING_X</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a><a class="code" href="group__apps__memgame__group.html#gaeb00458f59e0b28718cc67dcaaf320c0">00109</a> <span class="preprocessor">#define PIECE_INVALID_INDEX          0xFF</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>
<a name="l00112"></a>00112 
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="group__apps__memgame__group.html#gabe95223955d66c94f48a4d7588ec1c9c">00120</a> <span class="preprocessor">#define BTN_NEW_GAME_TEXT            &quot;New&quot;</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a><a class="code" href="group__apps__memgame__group.html#ga77c240224a7eb37151d008a7fe169d0b">00122</a> <span class="preprocessor">#define BTN_NEW_GAME_POS_X           (APP_EXIT_BUTTON_POS_X -        \</span>
<a name="l00123"></a>00123 <span class="preprocessor">                2 * APP_EXIT_BUTTON_SIZE_X)</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00125"></a><a class="code" href="group__apps__memgame__group.html#ga1885e7f4d599cd8c39d603ea231baed2">00125</a> <span class="preprocessor">#define BTN_NEW_GAME_POS_Y           APP_EXIT_BUTTON_POS_Y</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>
<a name="l00127"></a><a class="code" href="group__apps__memgame__group.html#ga3e2367776233beff751ae4cb748b473b">00127</a> <span class="preprocessor">#define BTN_NEW_GAME_SIZE_X          (2 * APP_EXIT_BUTTON_SIZE_X)</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a><a class="code" href="group__apps__memgame__group.html#ga5eb03f07f5840e59a1c37f95bb907b74">00129</a> <span class="preprocessor">#define BTN_NEW_GAME_SIZE_Y          APP_EXIT_BUTTON_SIZE_Y</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>
<a name="l00132"></a>00132 
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="group__apps__memgame__group.html#ga9e6d30635a04557024a66f0b02a79577">00140</a> <span class="preprocessor">#define MSG_TRIES_TEXT               &quot;Tries: %i&quot;</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>
<a name="l00142"></a><a class="code" href="group__apps__memgame__group.html#ga62012c1c96a3de283e74fdf9ee217737">00142</a> <span class="preprocessor">#define MSG_TRIES_LENGTH             10</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00144"></a><a class="code" href="group__apps__memgame__group.html#gaf3a0a4bf56ce6ac2d621c642587bf850">00144</a> <span class="preprocessor">#define MSG_TRIES_POS_X              0</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a><a class="code" href="group__apps__memgame__group.html#gad9733cba1993ada9acb851ef99fafb99">00146</a> <span class="preprocessor">#define MSG_TRIES_POS_Y              (APP_EXIT_BUTTON_POS_Y +         \</span>
<a name="l00147"></a>00147 <span class="preprocessor">                (APP_EXIT_BUTTON_SIZE_Y / 2) -                        \</span>
<a name="l00148"></a>00148 <span class="preprocessor">                (gfx_font_get_height(&amp;sysfont) / 2))</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>
<a name="l00150"></a><a class="code" href="group__apps__memgame__group.html#ga800a50530a54146257357637adee5445">00150</a> <span class="preprocessor">#define MSG_TRIES_SIZE_X             (gfx_get_width() -               \</span>
<a name="l00151"></a>00151 <span class="preprocessor">                APP_EXIT_BUTTON_SIZE_X - BTN_NEW_GAME_SIZE_X)</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00153"></a><a class="code" href="group__apps__memgame__group.html#ga276c51a2fca67f65302da4f1f27ff99a">00153</a> <span class="preprocessor">#define MSG_TRIES_SIZE_Y             gfx_font_get_height(&amp;sysfont)</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00156"></a>00156 
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="group__apps__memgame__group.html#gaf08c58011518010a4cd1be527de722a4">00164</a> <span class="preprocessor">#define MSG_GAME_OVER_TEXT           &quot;Well done!&quot;</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>
<a name="l00166"></a><a class="code" href="group__apps__memgame__group.html#gaa0f904678f85c7bbefbdff1187e1a4c1">00166</a> <span class="preprocessor">#define MSG_GAME_OVER_SCALE          4</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a><a class="code" href="group__apps__memgame__group.html#gaa01626d16569671186b37d98ad74fd3f">00168</a> <span class="preprocessor">#define MSG_GAME_OVER_POS_X          45</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>
<a name="l00170"></a><a class="code" href="group__apps__memgame__group.html#ga33ad0e04c52f66781f511907d2a17bca">00170</a> <span class="preprocessor">#define MSG_GAME_OVER_POS_Y          105</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>
<a name="l00172"></a><a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe">00172</a> <span class="preprocessor">#define MSG_GAME_OVER_GLOW_OFFSET    1</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="group__apps__memgame__group.html#gad76853670df863a79188dbcdb7af718f">00174</a> <span class="preprocessor">#define MSG_GAME_OVER_COLOR          GFX_COLOR(255, 160, 0)</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a><a class="code" href="group__apps__memgame__group.html#gaf3087ab8d370b4cfc0fe34558cf041ef">00176</a> <span class="preprocessor">#define MSG_GAME_OVER_GLOW_COLOR     GFX_COLOR(250, 250, 250)</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00179"></a>00179 
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="group__apps__memgame__group.html#gae833931244ec1001291dc9866545a3a2">00187</a> <span class="preprocessor">#define TIMER_PAUSE_HALF_SECONDS     3</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>
<a name="l00199"></a><a class="code" href="group__apps__memgame__group.html#gaf7691789d566cc2cc5c3534cc1bf8dd5">00199</a> <span class="preprocessor">#define TIMER_CLOCK_RATE             (0x1ffffUL / 8)</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>
<a name="l00202"></a>00202 
<a name="l00204"></a><a class="code" href="group__apps__memgame__group.html#ga670ed7cd3f186995a25cdafeef4c39b0">00204</a> <span class="keyword">enum</span> <a class="code" href="group__apps__memgame__group.html#ga670ed7cd3f186995a25cdafeef4c39b0" title="Event command IDs for application widgets.">memgame_command_id</a> {
<a name="l00206"></a><a class="code" href="group__apps__memgame__group.html#gga670ed7cd3f186995a25cdafeef4c39b0a93c1ce1fac89139d9f4df4b6db21b1cc">00206</a>         <a class="code" href="group__apps__tank__group.html#gga9c67ad111c5d786be5639fc2d489aa2ea93c1ce1fac89139d9f4df4b6db21b1cc" title="Command event value to use for supply-slider.">CMD_NONE</a>,
<a name="l00208"></a><a class="code" href="group__apps__memgame__group.html#gga670ed7cd3f186995a25cdafeef4c39b0ac3f16d213fa7fbda6e8d9feaeb48046b">00208</a>         <a class="code" href="group__apps__memgame__group.html#gga670ed7cd3f186995a25cdafeef4c39b0ac3f16d213fa7fbda6e8d9feaeb48046b" title="Command event value for new game-button.">CMD_NEW_GAME</a>,
<a name="l00210"></a><a class="code" href="group__apps__memgame__group.html#gga670ed7cd3f186995a25cdafeef4c39b0a423988140dabaa461f133924ca772294">00210</a>         <a class="code" href="group__apps__tank__group.html#gga9c67ad111c5d786be5639fc2d489aa2ea423988140dabaa461f133924ca772294" title="Command event value to use for exit-button.">CMD_EXIT</a>,
<a name="l00211"></a>00211 };
<a name="l00212"></a>00212 
<a name="l00214"></a><a class="code" href="group__apps__memgame__group.html#ga32697485670bea03385dfdd7338c4ee0">00214</a> <span class="keyword">enum</span> <a class="code" href="group__apps__memgame__group.html#ga32697485670bea03385dfdd7338c4ee0" title="States of the memory game.">memgame_state</a> {
<a name="l00216"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a350bde8e132e744de10ab009a3d245bc">00216</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a350bde8e132e744de10ab009a3d245bc" title="Draw all pieces on the board.">DRAW_ALL_PIECES</a>,
<a name="l00218"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af7cc653a0262b47a8fcc4a5b6bbe18c9">00218</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af7cc653a0262b47a8fcc4a5b6bbe18c9" title="Waiting for player to select first piece.">SELECT_FIRST_PIECE</a>,
<a name="l00220"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0aac1bae06c7c5e5b97c3fde32ee6f6f1f">00220</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0aac1bae06c7c5e5b97c3fde32ee6f6f1f" title="First selected piece has been shown.">SHOWN_FIRST_PIECE</a>,
<a name="l00222"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a132a34c851bce7103a523f097ac88bba">00222</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a132a34c851bce7103a523f097ac88bba" title="Waiting for player to select second piece.">SELECT_SECOND_PIECE</a>,
<a name="l00224"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af05b266d4e30c145f99c4d6f32e59c3d">00224</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af05b266d4e30c145f99c4d6f32e59c3d" title="Second selected piece has been shown.">SHOWN_SECOND_PIECE</a>,
<a name="l00226"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a852f81d63945b0d799421f73c8cbc70e">00226</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a852f81d63945b0d799421f73c8cbc70e" title="Hide first selected piece after mismatch.">HIDE_FIRST_PIECE</a>,
<a name="l00228"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a79d8868b27cd53bd432a0e713b4646b0">00228</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a79d8868b27cd53bd432a0e713b4646b0" title="Hide second selected piece after mismatch.">HIDE_SECOND_PIECE</a>,
<a name="l00230"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0ae8683b640b69a48a095d653c8944c261">00230</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0ae8683b640b69a48a095d653c8944c261" title="Both selected pieces have been hidden.">HIDDEN_BOTH_PIECES</a>,
<a name="l00232"></a><a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a871723195985a4ae22d7e10d99bf8a00">00232</a>         <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a871723195985a4ae22d7e10d99bf8a00" title="Game is over, wait for user to restart the game.">GAME_OVER</a>,
<a name="l00233"></a>00233 };
<a name="l00234"></a>00234 
<a name="l00236"></a><a class="code" href="structmemgame__piece.html">00236</a> <span class="keyword">struct </span><a class="code" href="structmemgame__piece.html" title="Game piece data.">memgame_piece</a> {
<a name="l00238"></a><a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176">00238</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> <a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176" title="Which pair the piece belongs to.">pair</a>;
<a name="l00240"></a><a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7">00240</a>         <span class="keywordtype">bool</span>    <a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a>;
<a name="l00241"></a>00241 };
<a name="l00242"></a>00242 
<a name="l00249"></a><a class="code" href="structmemgame__context.html">00249</a> <span class="keyword">struct </span><a class="code" href="structmemgame__context.html" title="Context for the memory game application.">memgame_context</a> {
<a name="l00251"></a><a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03">00251</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>      *<a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03" title="Pointer to the application&amp;#39;s main window.">win</a>;
<a name="l00253"></a><a class="code" href="structmemgame__context.html#a48ba6ce5d17df65ec31780f08a24d686">00253</a>         <span class="keyword">struct </span><a class="code" href="structgfx__bitmap.html" title="Storage structure for bitmap pixel data and metadata.">gfx_bitmap</a>      <a class="code" href="structmemgame__context.html#a48ba6ce5d17df65ec31780f08a24d686" title="Bitmap metadata for application window background.">bitmap</a>;
<a name="l00255"></a><a class="code" href="structmemgame__context.html#a06d1fbccba99172525d77cac97f39c37">00255</a>         <span class="keyword">struct </span><a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a>  *<a class="code" href="structmemgame__context.html#a06d1fbccba99172525d77cac97f39c37" title="Pointer to workqueue task for the application.">task</a>;
<a name="l00257"></a><a class="code" href="structmemgame__context.html#a1a71ff5972e5868af50baf23112356d7">00257</a>         <span class="keyword">struct </span><a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>            <a class="code" href="structmemgame__context.html#a1a71ff5972e5868af50baf23112356d7" title="Backup copy of sysfont, to restore upon application exit.">old_sysfont</a>;
<a name="l00259"></a><a class="code" href="structmemgame__context.html#a00f34951f43c150f01bc01b767a36162">00259</a>         <span class="keyword">struct </span><a class="code" href="structtimer.html" title="Timer data.">timer</a>           <a class="code" href="structtimer.html" title="Timer data.">timer</a>;
<a name="l00261"></a><a class="code" href="structmemgame__context.html#aea645e3c1037f02bcf183bbd86a32782">00261</a>         <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>               <a class="code" href="structmemgame__context.html#aea645e3c1037f02bcf183bbd86a32782" title="Timer delay needed to detect elapsed half-seconds.">timer_delay</a>;
<a name="l00263"></a><a class="code" href="structmemgame__context.html#acc564bfa39c756a7b761ab0fef1501d0">00263</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                <a class="code" href="structmemgame__context.html#acc564bfa39c756a7b761ab0fef1501d0" title="Application timer countdown.">ticks_to_go</a>;
<a name="l00265"></a><a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b">00265</a>         <span class="keyword">struct </span><a class="code" href="structmemgame__piece.html" title="Game piece data.">memgame_piece</a>   <a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>[<a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b" title="Number of pieces in the game.">NR_OF_PIECES</a>];
<a name="l00267"></a><a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90">00267</a>         <span class="keyword">enum</span> <a class="code" href="group__apps__memgame__group.html#ga32697485670bea03385dfdd7338c4ee0" title="States of the memory game.">memgame_state</a>     <a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a>;
<a name="l00269"></a><a class="code" href="structmemgame__context.html#aeaedac5b33fd41930fe5a77678560440">00269</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                <a class="code" href="structmemgame__context.html#aeaedac5b33fd41930fe5a77678560440" title="Index and position of first selected piece.">piece_1</a>;
<a name="l00271"></a><a class="code" href="structmemgame__context.html#a06574003b49ee6349648891478c59dae">00271</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                <a class="code" href="structmemgame__context.html#a06574003b49ee6349648891478c59dae" title="Index and position of second selected piece.">piece_2</a>;
<a name="l00273"></a><a class="code" href="structmemgame__context.html#ad462c945faca2c0b456c7aca54653af4">00273</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                <a class="code" href="structmemgame__context.html#ad462c945faca2c0b456c7aca54653af4" title="Number of piece pairs left before game over.">pairs_left</a>;
<a name="l00275"></a><a class="code" href="structmemgame__context.html#afff3dfd5440143efe055c2ea287f979b">00275</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                <a class="code" href="structmemgame__context.html#afff3dfd5440143efe055c2ea287f979b" title="Number of tries the user has had.">tries</a>;
<a name="l00277"></a><a class="code" href="structmemgame__context.html#a2f4ceca49b5ef7b4f8ca79f6600f24b5">00277</a>         <span class="keyword">struct </span><a class="code" href="structwtk__label.html">wtk_label</a>       *<a class="code" href="structmemgame__context.html#a2f4ceca49b5ef7b4f8ca79f6600f24b5" title="Label widget for displaying number of tries.">tries_label</a>;
<a name="l00279"></a><a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb">00279</a>         <span class="keywordtype">bool</span>                   <a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a>;
<a name="l00280"></a>00280 };
<a name="l00281"></a>00281 
<a name="l00289"></a><a class="code" href="group__apps__memgame__group.html#gae39693779cde00a107eb4c3102aeaaab">00289</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structmemgame__context.html" title="Context for the memory game application.">memgame_context</a> *<a class="code" href="group__apps__memgame__group.html#gae39693779cde00a107eb4c3102aeaaab" title="Pointer to memory game application context.">game_ctx</a>;
<a name="l00290"></a>00290 
<a name="l00296"></a><a class="code" href="group__apps__memgame__group.html#ga73264d71d5f9a9317fa76fb04d5fbc96">00296</a> <span class="keyword">static</span> <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a> <a class="code" href="group__apps__memgame__group.html#ga73264d71d5f9a9317fa76fb04d5fbc96" title="Simple pseudo-random number generator.">memgame_rand</a>(<span class="keywordtype">void</span>)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298         <span class="keyword">static</span> <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a> seed = 12345;
<a name="l00299"></a>00299         seed = (25037 * seed) + 1;
<a name="l00300"></a>00300         <span class="keywordflow">return</span> seed;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00314"></a><a class="code" href="group__apps__memgame__group.html#ga5f367707af274957ad65092e5a12fa9f">00314</a> <span class="preprocessor">#define memgame_print_helper(str, x, y, color) \</span>
<a name="l00315"></a>00315 <span class="preprocessor">        gfx_draw_string(str, x, y, &amp;sysfont, color, GFX_COLOR_TRANSPARENT)</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>
<a name="l00324"></a><a class="code" href="group__apps__memgame__group.html#gabf569f864aa308ec4a8fe32d5ff38897">00324</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#gabf569f864aa308ec4a8fe32d5ff38897" title="Print game over-message.">memgame_print_game_over</a>(<span class="keywordtype">void</span>)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326 <span class="preprocessor">#ifdef CONFIG_GFX_USE_CLIPPING</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>        <a class="code" href="group__gfx__gfx.html#gae49753292f3bea04f21414bb2e505b7e" title="Set the clipping region.">gfx_set_clipping</a>(0, 0, <a class="code" href="group__gfx__gfx.html#ga08c77dc3294e612b75aa054f77f22773" title="Return the current width of the screen.">gfx_get_width</a>(), <a class="code" href="group__gfx__gfx.html#ga18bda375fb523cfcb6f41862be5ba7b4" title="Return the current height of the screen.">gfx_get_height</a>());
<a name="l00328"></a>00328 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_GFX_USE_CLIPPING */</span>
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <span class="comment">// Temporarily enlarge the sysfont.</span>
<a name="l00331"></a>00331         <a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>.<a class="code" href="structfont.html#a93930e293fe0c2a740da28bbd8f1a46d" title="Number of times characters are scaled up when being drawn.">scale</a> = <a class="code" href="group__apps__memgame__group.html#gaa0f904678f85c7bbefbdff1187e1a4c1" title="Font scaling for text string.">MSG_GAME_OVER_SCALE</a>;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         <span class="comment">// Print the string with diagonal offsets.</span>
<a name="l00334"></a>00334         <a class="code" href="group__apps__memgame__group.html#ga5f367707af274957ad65092e5a12fa9f" title="Convenience macro for drawing text.">memgame_print_helper</a>(<a class="code" href="group__apps__memgame__group.html#gaf08c58011518010a4cd1be527de722a4" title="Text to print when game is completed.">MSG_GAME_OVER_TEXT</a>,
<a name="l00335"></a>00335                         <a class="code" href="group__apps__memgame__group.html#gaa01626d16569671186b37d98ad74fd3f" title="X-coordinate of game-over text.">MSG_GAME_OVER_POS_X</a> + <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00336"></a>00336                         <a class="code" href="group__apps__memgame__group.html#ga33ad0e04c52f66781f511907d2a17bca" title="Y-coordinate of game-over text.">MSG_GAME_OVER_POS_Y</a> + <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00337"></a>00337                         <a class="code" href="group__apps__memgame__group.html#gaf3087ab8d370b4cfc0fe34558cf041ef" title="Color to print background &amp;quot;glow&amp;quot; text with.">MSG_GAME_OVER_GLOW_COLOR</a>);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <a class="code" href="group__apps__memgame__group.html#ga5f367707af274957ad65092e5a12fa9f" title="Convenience macro for drawing text.">memgame_print_helper</a>(<a class="code" href="group__apps__memgame__group.html#gaf08c58011518010a4cd1be527de722a4" title="Text to print when game is completed.">MSG_GAME_OVER_TEXT</a>,
<a name="l00340"></a>00340                         <a class="code" href="group__apps__memgame__group.html#gaa01626d16569671186b37d98ad74fd3f" title="X-coordinate of game-over text.">MSG_GAME_OVER_POS_X</a> - <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00341"></a>00341                         <a class="code" href="group__apps__memgame__group.html#ga33ad0e04c52f66781f511907d2a17bca" title="Y-coordinate of game-over text.">MSG_GAME_OVER_POS_Y</a> - <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00342"></a>00342                         <a class="code" href="group__apps__memgame__group.html#gaf3087ab8d370b4cfc0fe34558cf041ef" title="Color to print background &amp;quot;glow&amp;quot; text with.">MSG_GAME_OVER_GLOW_COLOR</a>);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <a class="code" href="group__apps__memgame__group.html#ga5f367707af274957ad65092e5a12fa9f" title="Convenience macro for drawing text.">memgame_print_helper</a>(<a class="code" href="group__apps__memgame__group.html#gaf08c58011518010a4cd1be527de722a4" title="Text to print when game is completed.">MSG_GAME_OVER_TEXT</a>,
<a name="l00345"></a>00345                         <a class="code" href="group__apps__memgame__group.html#gaa01626d16569671186b37d98ad74fd3f" title="X-coordinate of game-over text.">MSG_GAME_OVER_POS_X</a> + <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00346"></a>00346                         <a class="code" href="group__apps__memgame__group.html#ga33ad0e04c52f66781f511907d2a17bca" title="Y-coordinate of game-over text.">MSG_GAME_OVER_POS_Y</a> - <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00347"></a>00347                         <a class="code" href="group__apps__memgame__group.html#gaf3087ab8d370b4cfc0fe34558cf041ef" title="Color to print background &amp;quot;glow&amp;quot; text with.">MSG_GAME_OVER_GLOW_COLOR</a>);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         <a class="code" href="group__apps__memgame__group.html#ga5f367707af274957ad65092e5a12fa9f" title="Convenience macro for drawing text.">memgame_print_helper</a>(<a class="code" href="group__apps__memgame__group.html#gaf08c58011518010a4cd1be527de722a4" title="Text to print when game is completed.">MSG_GAME_OVER_TEXT</a>,
<a name="l00350"></a>00350                         <a class="code" href="group__apps__memgame__group.html#gaa01626d16569671186b37d98ad74fd3f" title="X-coordinate of game-over text.">MSG_GAME_OVER_POS_X</a> - <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00351"></a>00351                         <a class="code" href="group__apps__memgame__group.html#ga33ad0e04c52f66781f511907d2a17bca" title="Y-coordinate of game-over text.">MSG_GAME_OVER_POS_Y</a> + <a class="code" href="group__apps__memgame__group.html#ga789dad93bfa8c117e559c3fb6aa0ccbe" title="Offset in position to use for getting a glow-effect.">MSG_GAME_OVER_GLOW_OFFSET</a>,
<a name="l00352"></a>00352                         <a class="code" href="group__apps__memgame__group.html#gaf3087ab8d370b4cfc0fe34558cf041ef" title="Color to print background &amp;quot;glow&amp;quot; text with.">MSG_GAME_OVER_GLOW_COLOR</a>);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="comment">// Print with no offset.</span>
<a name="l00355"></a>00355         <a class="code" href="group__apps__memgame__group.html#ga5f367707af274957ad65092e5a12fa9f" title="Convenience macro for drawing text.">memgame_print_helper</a>(<a class="code" href="group__apps__memgame__group.html#gaf08c58011518010a4cd1be527de722a4" title="Text to print when game is completed.">MSG_GAME_OVER_TEXT</a>, <a class="code" href="group__apps__memgame__group.html#gaa01626d16569671186b37d98ad74fd3f" title="X-coordinate of game-over text.">MSG_GAME_OVER_POS_X</a>,
<a name="l00356"></a>00356                         <a class="code" href="group__apps__memgame__group.html#ga33ad0e04c52f66781f511907d2a17bca" title="Y-coordinate of game-over text.">MSG_GAME_OVER_POS_Y</a>, <a class="code" href="group__apps__memgame__group.html#gad76853670df863a79188dbcdb7af718f" title="Color to print foreground text with.">MSG_GAME_OVER_COLOR</a>);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358         <span class="comment">// Restore font scale for the widgets.</span>
<a name="l00359"></a>00359         <a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>.<a class="code" href="structfont.html#a93930e293fe0c2a740da28bbd8f1a46d" title="Number of times characters are scaled up when being drawn.">scale</a> = <a class="code" href="group__apps__memgame__group.html#ga5536e218c61e2849cea7f756ef3e516b" title="Font scaling for button widgets.">WIDGET_FONT_SCALE</a>;
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00368"></a><a class="code" href="group__apps__memgame__group.html#gab078d1c7c696c7a995dbfca82022f852">00368</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#gab078d1c7c696c7a995dbfca82022f852" title="Print user&amp;#39;s number of tries.">memgame_print_tries</a>(<span class="keywordtype">void</span>)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370         <span class="keywordtype">char</span> <a class="code" href="group__utility__group.html#gad8ab729381f270b100f3d05b6c6676fc" title="Stringify a macro argument without expansion.">str</a>[<a class="code" href="group__apps__memgame__group.html#ga62012c1c96a3de283e74fdf9ee217737" title="Maximum number of characters in text string.">MSG_TRIES_LENGTH</a> + 1];
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="comment">// Create new string and update the label.</span>
<a name="l00373"></a>00373         <a class="code" href="stream__string_8c.html#ad76145a6edfc98981ded8815a760e0cd" title="Streamed formatted size limited output conversion.">snprintf</a>(str, <a class="code" href="group__apps__memgame__group.html#ga62012c1c96a3de283e74fdf9ee217737" title="Maximum number of characters in text string.">MSG_TRIES_LENGTH</a> + 1, <a class="code" href="group__apps__memgame__group.html#ga9e6d30635a04557024a66f0b02a79577" title="Text to print, for use with snprintf().">MSG_TRIES_TEXT</a>, game_ctx-&gt;<a class="code" href="structmemgame__context.html#afff3dfd5440143efe055c2ea287f979b" title="Number of tries the user has had.">tries</a>);
<a name="l00374"></a>00374         <a class="code" href="group__gfx__wtk__label.html#ga81a354db47129b63f2949c099460c813" title="Set new caption for label, return false if out of mem.">wtk_label_change</a>(game_ctx-&gt;<a class="code" href="structmemgame__context.html#a2f4ceca49b5ef7b4f8ca79f6600f24b5" title="Label widget for displaying number of tries.">tries_label</a>, str);
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00390"></a><a class="code" href="group__apps__memgame__group.html#gaf298896281bf766f6fd86b1398ca8a9c">00390</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#gaf298896281bf766f6fd86b1398ca8a9c" title="Get the coordinates for specified piece.">memgame_get_piece_coordinates</a>(<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> position, <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> *pos_x,
<a name="l00391"></a>00391                 <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> *pos_y)
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393         *pos_x = <a class="code" href="group__apps__memgame__group.html#ga71825cc52b951b36f0961bafcec583a3" title="X-coordinate to start drawing first piece at.">BOARD_POS_X</a> + (position % <a class="code" href="group__apps__memgame__group.html#ga077e6344ae3cdd9b2973e80c99c14d81" title="Number of pieces per row on the board.">NR_OF_BOARD_COLUMNS</a>) *
<a name="l00394"></a>00394                         (<a class="code" href="group__apps__memgame__group.html#gaf164cea02d507f4ef646ff0f74ec928e" title="Width of piece images.">PIECE_SIZE_X</a> + <a class="code" href="group__apps__memgame__group.html#gacd47a66c8f8c32e31d9e185263c7c92d" title="Spacing between pieces in X-dimension.">PIECE_SPACING_X</a>);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         *pos_y = <a class="code" href="group__apps__memgame__group.html#gaf180a8f9b81a5b7afee3fd91dc383323" title="Y-coordinate to start drawing first piece at.">BOARD_POS_Y</a> + (position / <a class="code" href="group__apps__memgame__group.html#ga077e6344ae3cdd9b2973e80c99c14d81" title="Number of pieces per row on the board.">NR_OF_BOARD_COLUMNS</a>) *
<a name="l00397"></a>00397                         (<a class="code" href="group__apps__memgame__group.html#ga5ced27aac77b72415cd0beb4a7c6ec8c" title="Height of piece images.">PIECE_SIZE_Y</a> + <a class="code" href="group__apps__memgame__group.html#gae0ea911d54115fd70e55d158485fc2fb" title="Spacing between pieces in Y-dimension.">PIECE_SPACING_Y</a>);
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00412"></a><a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38">00412</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38" title="Enqueue drawing of specified piece.">memgame_draw_piece</a>(<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> index, <span class="keywordtype">bool</span> show)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>            pos_x;
<a name="l00415"></a>00415         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>            pos_y;
<a name="l00416"></a>00416         <span class="keywordtype">char</span>                   *filename;
<a name="l00417"></a>00417         <span class="keyword">enum</span> <a class="code" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151">status_code</a>       result;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="comment">// Get image filename for piece.</span>
<a name="l00420"></a>00420         <span class="keywordflow">if</span> (show) {
<a name="l00421"></a>00421                 <span class="keywordflow">switch</span> (game_ctx-&gt;<a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>[index].<a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176" title="Which pair the piece belongs to.">pair</a>) {
<a name="l00422"></a>00422                 <span class="keywordflow">case</span> 0:
<a name="l00423"></a>00423                         filename = <a class="code" href="group__apps__memgame__group.html#ga8466392987ece78b4db53efa940afa9b" title="Image file to load when showing piece pair 0.">PIECE_PAIR_FILE_0</a>;
<a name="l00424"></a>00424                         <span class="keywordflow">break</span>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426                 <span class="keywordflow">case</span> 1:
<a name="l00427"></a>00427                         filename = <a class="code" href="group__apps__memgame__group.html#gaa82e979427e6f1d29666eabec56bdb8a" title="Image file to load when showing piece pair 1.">PIECE_PAIR_FILE_1</a>;
<a name="l00428"></a>00428                         <span class="keywordflow">break</span>;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                 <span class="keywordflow">case</span> 2:
<a name="l00431"></a>00431                         filename = <a class="code" href="group__apps__memgame__group.html#ga080f84b8d90e66a7a5e1fe33e6c1bb80" title="Image file to load when showing piece pair 2.">PIECE_PAIR_FILE_2</a>;
<a name="l00432"></a>00432                         <span class="keywordflow">break</span>;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434                 <span class="keywordflow">case</span> 3:
<a name="l00435"></a>00435                         filename = <a class="code" href="group__apps__memgame__group.html#ga376d31d3d204ee7efe7f18a648f1b1ef" title="Image file to load when showing piece pair 3.">PIECE_PAIR_FILE_3</a>;
<a name="l00436"></a>00436                         <span class="keywordflow">break</span>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438                 <span class="keywordflow">case</span> 4:
<a name="l00439"></a>00439                         filename = <a class="code" href="group__apps__memgame__group.html#ga2a9b4f2ebb26486e50e39b11145d8901" title="Image file to load when showing piece pair 4.">PIECE_PAIR_FILE_4</a>;
<a name="l00440"></a>00440                         <span class="keywordflow">break</span>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442                 <span class="keywordflow">case</span> 5:
<a name="l00443"></a>00443                         filename = <a class="code" href="group__apps__memgame__group.html#gab849b0cdee26b1d3a9382fad9c3f07be" title="Image file to load when showing piece pair 5.">PIECE_PAIR_FILE_5</a>;
<a name="l00444"></a>00444                         <span class="keywordflow">break</span>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                 <span class="keywordflow">default</span>:
<a name="l00447"></a>00447                         filename = <a class="code" href="group__apps__memgame__group.html#ga7fd65d7eaa674c1d9f8a449aaa2d052b" title="Image file to load when showing the back of game pieces.">PIECE_BACK_FILE</a>;
<a name="l00448"></a>00448                         <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                 }
<a name="l00450"></a>00450         } <span class="keywordflow">else</span> {
<a name="l00451"></a>00451                 filename = <a class="code" href="group__apps__memgame__group.html#ga7fd65d7eaa674c1d9f8a449aaa2d052b" title="Image file to load when showing the back of game pieces.">PIECE_BACK_FILE</a>;
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453         <a class="code" href="group__apps__memgame__group.html#gaf298896281bf766f6fd86b1398ca8a9c" title="Get the coordinates for specified piece.">memgame_get_piece_coordinates</a>(index, &amp;pos_x, &amp;pos_y);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455         <span class="comment">// Now load the file to the piece&#39;s position.</span>
<a name="l00456"></a>00456         result = <a class="code" href="group__appsutil__fileloader__group.html#gac9ce98d283b3435ab545a59efd9439f1" title="Load file data directly to screen.">load_file_to_screen</a>(filename, pos_x, pos_y, <a class="code" href="group__apps__memgame__group.html#gaf164cea02d507f4ef646ff0f74ec928e" title="Width of piece images.">PIECE_SIZE_X</a>,
<a name="l00457"></a>00457                         <a class="code" href="group__apps__memgame__group.html#ga5ced27aac77b72415cd0beb4a7c6ec8c" title="Height of piece images.">PIECE_SIZE_Y</a>, game_ctx-&gt;<a class="code" href="structmemgame__context.html#a06d1fbccba99172525d77cac97f39c37" title="Pointer to workqueue task for the application.">task</a>);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459         <span class="comment">/* If piece could not be loaded, exit the application since only</span>
<a name="l00460"></a>00460 <span class="comment">         * this game should currently be using the file loader.</span>
<a name="l00461"></a>00461 <span class="comment">         */</span>
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (result != <a class="code" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>) {
<a name="l00463"></a>00463                 <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(game_ctx-&gt;<a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03" title="Pointer to the application&amp;#39;s main window.">win</a>);
<a name="l00464"></a>00464                 <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a1a71ff5972e5868af50baf23112356d7" title="Backup copy of sysfont, to restore upon application exit.">old_sysfont</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00465"></a>00465                 <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(game_ctx);
<a name="l00466"></a>00466                 game_ctx = NULL;
<a name="l00467"></a>00467                 <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00468"></a>00468         };
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00478"></a><a class="code" href="group__apps__memgame__group.html#ga7a37fae62d3265de2e103081e6138b44">00478</a> <span class="keyword">static</span> <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> <a class="code" href="group__apps__memgame__group.html#ga7a37fae62d3265de2e103081e6138b44" title="Pick a random piece index from array.">memgame_get_random_index</a>(<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> indexes[])
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> array_index;
<a name="l00481"></a>00481         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> piece_index;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         piece_index = <a class="code" href="group__apps__memgame__group.html#gaeb00458f59e0b28718cc67dcaaf320c0" title="Index to use to indicate no piece is selected.">PIECE_INVALID_INDEX</a>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485         <span class="comment">// Do a random search for the first free index in the supplied list.</span>
<a name="l00486"></a>00486         <span class="keywordflow">do</span> {
<a name="l00487"></a>00487                 array_index = <a class="code" href="group__apps__memgame__group.html#ga73264d71d5f9a9317fa76fb04d5fbc96" title="Simple pseudo-random number generator.">memgame_rand</a>() % <a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b" title="Number of pieces in the game.">NR_OF_PIECES</a>;
<a name="l00488"></a>00488                 piece_index = indexes[array_index];
<a name="l00489"></a>00489         } <span class="keywordflow">while</span> (piece_index == <a class="code" href="group__apps__memgame__group.html#gaeb00458f59e0b28718cc67dcaaf320c0" title="Index to use to indicate no piece is selected.">PIECE_INVALID_INDEX</a>);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         <span class="comment">// Mark the piece position as taken.</span>
<a name="l00492"></a>00492         indexes[array_index] = <a class="code" href="group__apps__memgame__group.html#gaeb00458f59e0b28718cc67dcaaf320c0" title="Index to use to indicate no piece is selected.">PIECE_INVALID_INDEX</a>;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494         <span class="keywordflow">return</span> piece_index;
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00504"></a><a class="code" href="group__apps__memgame__group.html#gaa35afbf6473ba965f5e64f6fc604d8b8">00504</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#gaa35afbf6473ba965f5e64f6fc604d8b8" title="Start new game.">memgame_start_new_game</a>(<span class="keywordtype">void</span>)
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506         <span class="keyword">struct </span><a class="code" href="structmemgame__piece.html" title="Game piece data.">memgame_piece</a>   *p1;
<a name="l00507"></a>00507         <span class="keyword">struct </span><a class="code" href="structmemgame__piece.html" title="Game piece data.">memgame_piece</a>   *p2;
<a name="l00508"></a>00508         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                indexes[<a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b" title="Number of pieces in the game.">NR_OF_PIECES</a>];
<a name="l00509"></a>00509         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                i;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511         <span class="comment">// Force redraw of application window.</span>
<a name="l00512"></a>00512         <a class="code" href="group__gfx__win.html#ga7f5e9dd7246c26ade8a7a3a764b3dc74" title="Redraw window and its contents, if visible.">win_redraw</a>(game_ctx-&gt;<a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03" title="Pointer to the application&amp;#39;s main window.">win</a>);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="comment">// Initialize list of uninitialized pieces.</span>
<a name="l00515"></a>00515         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b" title="Number of pieces in the game.">NR_OF_PIECES</a>; i++) {
<a name="l00516"></a>00516                 indexes[i] = i;
<a name="l00517"></a>00517         }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="comment">// Initialize the game piece pairs with random locations.</span>
<a name="l00520"></a>00520         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__apps__memgame__group.html#ga4d6be359a5d1c5bb43caf0ff614a9a29" title="Number of piece pairs in the game.">NR_OF_PIECE_PAIRS</a>; i++) {
<a name="l00521"></a>00521                 p1 = &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>[<a class="code" href="group__apps__memgame__group.html#ga7a37fae62d3265de2e103081e6138b44" title="Pick a random piece index from array.">memgame_get_random_index</a>(indexes)];
<a name="l00522"></a>00522                 p1-&gt;<a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176" title="Which pair the piece belongs to.">pair</a> = i;
<a name="l00523"></a>00523                 p1-&gt;<a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a> = <span class="keyword">false</span>;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525                 p2 = &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>[<a class="code" href="group__apps__memgame__group.html#ga7a37fae62d3265de2e103081e6138b44" title="Pick a random piece index from array.">memgame_get_random_index</a>(indexes)];
<a name="l00526"></a>00526                 p2-&gt;<a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176" title="Which pair the piece belongs to.">pair</a> = i;
<a name="l00527"></a>00527                 p2-&gt;<a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a> = <span class="keyword">false</span>;
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         <span class="comment">// Initialize the game state and start drawing all game pieces.</span>
<a name="l00531"></a>00531         game_ctx-&gt;<a class="code" href="structmemgame__context.html#afff3dfd5440143efe055c2ea287f979b" title="Number of tries the user has had.">tries</a> = 0;
<a name="l00532"></a>00532         game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">true</span>;
<a name="l00533"></a>00533         game_ctx-&gt;<a class="code" href="structmemgame__context.html#aeaedac5b33fd41930fe5a77678560440" title="Index and position of first selected piece.">piece_1</a> = 0;
<a name="l00534"></a>00534         game_ctx-&gt;<a class="code" href="structmemgame__context.html#ad462c945faca2c0b456c7aca54653af4" title="Number of piece pairs left before game over.">pairs_left</a> = NR_OF_PIECE_PAIRS;
<a name="l00535"></a>00535         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a350bde8e132e744de10ab009a3d245bc" title="Draw all pieces on the board.">DRAW_ALL_PIECES</a>;
<a name="l00536"></a>00536         <a class="code" href="group__workqueue__group.html#gaba0573bf3d1a0201616ec03944ecfd41" title="Add task to work queue.">workqueue_add_task</a>(&amp;<a class="code" href="group__workqueue__group.html#ga6c0de22a1ae8b7797e67df97f23f4707" title="The main work queue.">main_workqueue</a>, game_ctx-&gt;<a class="code" href="structmemgame__context.html#a06d1fbccba99172525d77cac97f39c37" title="Pointer to workqueue task for the application.">task</a>);
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00555"></a><a class="code" href="group__apps__memgame__group.html#ga495477af72d901a222ff7b871aa7f593">00555</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#ga495477af72d901a222ff7b871aa7f593" title="Update the game.">memgame_update</a>(<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> new_piece)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557         <span class="keyword">struct </span><a class="code" href="structmemgame__piece.html" title="Game piece data.">memgame_piece</a>   *pieces = game_ctx-&gt;<a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>;
<a name="l00558"></a>00558         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                p_1 = game_ctx-&gt;<a class="code" href="structmemgame__context.html#aeaedac5b33fd41930fe5a77678560440" title="Index and position of first selected piece.">piece_1</a>;
<a name="l00559"></a>00559         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>                p_2 = game_ctx-&gt;<a class="code" href="structmemgame__context.html#a06574003b49ee6349648891478c59dae" title="Index and position of second selected piece.">piece_2</a>;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <span class="comment">// Act according to current game state.</span>
<a name="l00562"></a>00562         <span class="keywordflow">switch</span>(game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a>) {
<a name="l00563"></a>00563         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a350bde8e132e744de10ab009a3d245bc" title="Draw all pieces on the board.">DRAW_ALL_PIECES</a>:
<a name="l00564"></a>00564                 <span class="comment">// Draw all pieces, then wait for selection of first piece.</span>
<a name="l00565"></a>00565                 <span class="keywordflow">if</span> (p_1 &lt; <a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b" title="Number of pieces in the game.">NR_OF_PIECES</a>) {
<a name="l00566"></a>00566                         <a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38" title="Enqueue drawing of specified piece.">memgame_draw_piece</a>(p_1, <span class="keyword">false</span>);
<a name="l00567"></a>00567                         p_1++;
<a name="l00568"></a>00568                 } <span class="keywordflow">else</span> {
<a name="l00569"></a>00569                         <a class="code" href="group__apps__memgame__group.html#gab078d1c7c696c7a995dbfca82022f852" title="Print user&amp;#39;s number of tries.">memgame_print_tries</a>();
<a name="l00570"></a>00570                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af7cc653a0262b47a8fcc4a5b6bbe18c9" title="Waiting for player to select first piece.">SELECT_FIRST_PIECE</a>;
<a name="l00571"></a>00571                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">false</span>;
<a name="l00572"></a>00572                 }
<a name="l00573"></a>00573                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#aeaedac5b33fd41930fe5a77678560440" title="Index and position of first selected piece.">piece_1</a> = p_1;
<a name="l00574"></a>00574                 <span class="keywordflow">break</span>;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af7cc653a0262b47a8fcc4a5b6bbe18c9" title="Waiting for player to select first piece.">SELECT_FIRST_PIECE</a>:
<a name="l00577"></a>00577                 <span class="comment">// If piece was not already found, accept selection and draw it.</span>
<a name="l00578"></a>00578                 <span class="keywordflow">if</span> (game_ctx-&gt;<a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>[new_piece].<a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a> == <span class="keyword">false</span>) {
<a name="l00579"></a>00579                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#aeaedac5b33fd41930fe5a77678560440" title="Index and position of first selected piece.">piece_1</a> = new_piece;
<a name="l00580"></a>00580                         <a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38" title="Enqueue drawing of specified piece.">memgame_draw_piece</a>(new_piece, <span class="keyword">true</span>);
<a name="l00581"></a>00581                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0aac1bae06c7c5e5b97c3fde32ee6f6f1f" title="First selected piece has been shown.">SHOWN_FIRST_PIECE</a>;
<a name="l00582"></a>00582                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">true</span>;
<a name="l00583"></a>00583                 }
<a name="l00584"></a>00584                 <span class="keywordflow">break</span>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0aac1bae06c7c5e5b97c3fde32ee6f6f1f" title="First selected piece has been shown.">SHOWN_FIRST_PIECE</a>:
<a name="l00587"></a>00587                 <span class="comment">// Drawing finished, now wait for second piece selection.</span>
<a name="l00588"></a>00588                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a132a34c851bce7103a523f097ac88bba" title="Waiting for player to select second piece.">SELECT_SECOND_PIECE</a>;
<a name="l00589"></a>00589                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">false</span>;
<a name="l00590"></a>00590                 <span class="keywordflow">break</span>;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a132a34c851bce7103a523f097ac88bba" title="Waiting for player to select second piece.">SELECT_SECOND_PIECE</a>:
<a name="l00593"></a>00593                 <span class="comment">/* If selected piece is not the same as the first one and it</span>
<a name="l00594"></a>00594 <span class="comment">                 * has not already been found, accept selection and draw it.</span>
<a name="l00595"></a>00595 <span class="comment">                 */</span>
<a name="l00596"></a>00596                 <span class="keywordflow">if</span> ((new_piece != p_1) &amp;&amp; (game_ctx-&gt;<a class="code" href="structmemgame__context.html#a34767b4b406411f961e4b03d3bc4966b" title="Data for all the game pieces.">pieces</a>[new_piece].<a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a>
<a name="l00597"></a>00597                                 == <span class="keyword">false</span>)) {
<a name="l00598"></a>00598                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a06574003b49ee6349648891478c59dae" title="Index and position of second selected piece.">piece_2</a> = new_piece;
<a name="l00599"></a>00599                         <a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38" title="Enqueue drawing of specified piece.">memgame_draw_piece</a>(new_piece, <span class="keyword">true</span>);
<a name="l00600"></a>00600                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#afff3dfd5440143efe055c2ea287f979b" title="Number of tries the user has had.">tries</a>++;
<a name="l00601"></a>00601                         <a class="code" href="group__apps__memgame__group.html#gab078d1c7c696c7a995dbfca82022f852" title="Print user&amp;#39;s number of tries.">memgame_print_tries</a>();
<a name="l00602"></a>00602                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af05b266d4e30c145f99c4d6f32e59c3d" title="Second selected piece has been shown.">SHOWN_SECOND_PIECE</a>;
<a name="l00603"></a>00603                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">true</span>;
<a name="l00604"></a>00604                 }
<a name="l00605"></a>00605                 <span class="keywordflow">break</span>;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af05b266d4e30c145f99c4d6f32e59c3d" title="Second selected piece has been shown.">SHOWN_SECOND_PIECE</a>:
<a name="l00608"></a>00608                 <span class="comment">// Drawing finished. Check if pieces match.</span>
<a name="l00609"></a>00609                 <span class="keywordflow">if</span> (pieces[p_1].<a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176" title="Which pair the piece belongs to.">pair</a> == pieces[p_2].<a class="code" href="structmemgame__piece.html#a3b0c78631fe8aa9b299a544944b7e176" title="Which pair the piece belongs to.">pair</a>) {
<a name="l00610"></a>00610                         <span class="comment">// Check if game has completed.</span>
<a name="l00611"></a>00611                         <span class="keywordflow">if</span> (--game_ctx-&gt;<a class="code" href="structmemgame__context.html#ad462c945faca2c0b456c7aca54653af4" title="Number of piece pairs left before game over.">pairs_left</a> == 0) {
<a name="l00612"></a>00612                                 <a class="code" href="group__apps__memgame__group.html#gabf569f864aa308ec4a8fe32d5ff38897" title="Print game over-message.">memgame_print_game_over</a>();
<a name="l00613"></a>00613                                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a871723195985a4ae22d7e10d99bf8a00" title="Game is over, wait for user to restart the game.">GAME_OVER</a>;
<a name="l00614"></a>00614                         } <span class="keywordflow">else</span> {
<a name="l00615"></a>00615                                 pieces[p_1].<a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a> = <span class="keyword">true</span>;
<a name="l00616"></a>00616                                 pieces[p_2].<a class="code" href="structmemgame__piece.html#aea6b28128c19bb1f6c7713815ed2c0b7" title="Flag indicating that the piece has been found.">found</a> = <span class="keyword">true</span>;
<a name="l00617"></a>00617                                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af7cc653a0262b47a8fcc4a5b6bbe18c9" title="Waiting for player to select first piece.">SELECT_FIRST_PIECE</a>;
<a name="l00618"></a>00618                         }
<a name="l00619"></a>00619                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">false</span>;
<a name="l00620"></a>00620                 } <span class="keywordflow">else</span> {
<a name="l00621"></a>00621                         <span class="comment">// Start timer to pause before hiding the pieces again.</span>
<a name="l00622"></a>00622                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#acc564bfa39c756a7b761ab0fef1501d0" title="Application timer countdown.">ticks_to_go</a> = <a class="code" href="group__apps__memgame__group.html#gae833931244ec1001291dc9866545a3a2" title="Number of half seconds before hiding mismatched game pieces.">TIMER_PAUSE_HALF_SECONDS</a>;
<a name="l00623"></a>00623                         <a class="code" href="group__timer__group.html#gab0f2bb4f901226817d72d06b683777eb" title="Start the timer.">timer_start</a>(CONFIG_TIMER_ID, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a00f34951f43c150f01bc01b767a36162" title="Timer struct needed for the timer driver.">timer</a>);
<a name="l00624"></a>00624                         <a class="code" href="group__timer__group.html#ga99bcf5cf0bc4c7eda6af86fdf5b6c65e" title="Set timer alarm.">timer_set_alarm</a>(CONFIG_TIMER_ID, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a00f34951f43c150f01bc01b767a36162" title="Timer struct needed for the timer driver.">timer</a>,
<a name="l00625"></a>00625                                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#aea645e3c1037f02bcf183bbd86a32782" title="Timer delay needed to detect elapsed half-seconds.">timer_delay</a>);
<a name="l00626"></a>00626                         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a852f81d63945b0d799421f73c8cbc70e" title="Hide first selected piece after mismatch.">HIDE_FIRST_PIECE</a>;
<a name="l00627"></a>00627                 }
<a name="l00628"></a>00628                 <span class="keywordflow">break</span>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a852f81d63945b0d799421f73c8cbc70e" title="Hide first selected piece after mismatch.">HIDE_FIRST_PIECE</a>:
<a name="l00631"></a>00631                 <span class="comment">// Timer has expired. Now hide the first piece.</span>
<a name="l00632"></a>00632                 <a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38" title="Enqueue drawing of specified piece.">memgame_draw_piece</a>(p_1, <span class="keyword">false</span>);
<a name="l00633"></a>00633                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a79d8868b27cd53bd432a0e713b4646b0" title="Hide second selected piece after mismatch.">HIDE_SECOND_PIECE</a>;
<a name="l00634"></a>00634                 <span class="keywordflow">break</span>;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a79d8868b27cd53bd432a0e713b4646b0" title="Hide second selected piece after mismatch.">HIDE_SECOND_PIECE</a>:
<a name="l00637"></a>00637                 <span class="comment">// Now hide the second one.</span>
<a name="l00638"></a>00638                 <a class="code" href="group__apps__memgame__group.html#gad5a9122397b4554eb0cd5e84e0760b38" title="Enqueue drawing of specified piece.">memgame_draw_piece</a>(p_2, <span class="keyword">false</span>);
<a name="l00639"></a>00639                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0ae8683b640b69a48a095d653c8944c261" title="Both selected pieces have been hidden.">HIDDEN_BOTH_PIECES</a>;
<a name="l00640"></a>00640                 <span class="keywordflow">break</span>;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0ae8683b640b69a48a095d653c8944c261" title="Both selected pieces have been hidden.">HIDDEN_BOTH_PIECES</a>:
<a name="l00643"></a>00643                 <span class="comment">// Clear busy flag and wait for new piece selection.</span>
<a name="l00644"></a>00644                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#a33a051fe146fe64e811bce92e4e70b90" title="Current state of the game.">state</a> = <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0af7cc653a0262b47a8fcc4a5b6bbe18c9" title="Waiting for player to select first piece.">SELECT_FIRST_PIECE</a>;
<a name="l00645"></a>00645                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a> = <span class="keyword">false</span>;
<a name="l00646"></a>00646                 <span class="keywordflow">break</span>;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga32697485670bea03385dfdd7338c4ee0a871723195985a4ae22d7e10d99bf8a00" title="Game is over, wait for user to restart the game.">GAME_OVER</a>:
<a name="l00649"></a>00649                 <span class="comment">// Do nothing. User must restart the game.</span>
<a name="l00650"></a>00650                 <span class="keywordflow">break</span>;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="keywordflow">default</span>:
<a name="l00653"></a>00653                 <span class="keywordflow">break</span>;
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00665"></a><a class="code" href="group__apps__memgame__group.html#ga6068a5b0697bb5547f548c73a4c3c3e8">00665</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#ga6068a5b0697bb5547f548c73a4c3c3e8" title="Command event handler for application.">memgame_handle_command_event</a>(<a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a> data)
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667         <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> <a class="code" href="group__apps__memgame__group.html#ga670ed7cd3f186995a25cdafeef4c39b0" title="Event command IDs for application widgets.">memgame_command_id</a>)(<a class="code" href="group__stdint__group.html#ga2f2d463af0e2a9da3ecdd102ce312832" title="Unsigned integer type capable of holding a pointer.">uintptr_t</a>)data) {
<a name="l00668"></a>00668         <span class="keywordflow">case</span> <a class="code" href="group__apps__memgame__group.html#gga670ed7cd3f186995a25cdafeef4c39b0ac3f16d213fa7fbda6e8d9feaeb48046b" title="Command event value for new game-button.">CMD_NEW_GAME</a>:
<a name="l00669"></a>00669                 <a class="code" href="group__apps__memgame__group.html#gaa35afbf6473ba965f5e64f6fc604d8b8" title="Start new game.">memgame_start_new_game</a>();
<a name="l00670"></a>00670                 <span class="keywordflow">break</span>;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672         <span class="keywordflow">case</span> <a class="code" href="group__apps__tank__group.html#gga9c67ad111c5d786be5639fc2d489aa2ea423988140dabaa461f133924ca772294" title="Command event value to use for exit-button.">CMD_EXIT</a>:
<a name="l00673"></a>00673                 <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(game_ctx-&gt;<a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03" title="Pointer to the application&amp;#39;s main window.">win</a>);
<a name="l00674"></a>00674                 <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a1a71ff5972e5868af50baf23112356d7" title="Backup copy of sysfont, to restore upon application exit.">old_sysfont</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00675"></a>00675                 <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(game_ctx);
<a name="l00676"></a>00676                 game_ctx = NULL;
<a name="l00677"></a>00677                 <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00678"></a>00678                 <span class="keywordflow">break</span>;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="keywordflow">default</span>:
<a name="l00681"></a>00681                 <span class="keywordflow">break</span>;
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683 }
<a name="l00684"></a>00684 
<a name="l00694"></a><a class="code" href="group__apps__memgame__group.html#ga5d19fa4ea782aa856b618f5e0ba54de8">00694</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#ga5d19fa4ea782aa856b618f5e0ba54de8" title="Pointer event handler for application.">memgame_handle_pointer_event</a>(<span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *data)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> x;
<a name="l00697"></a>00697         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> y;
<a name="l00698"></a>00698         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>     i;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="comment">// Only handle pointer presses.</span>
<a name="l00701"></a>00701         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="structwin__pointer__event.html#aaa4a37836e543dbc11329b0c2863fdba" title="Type of this event.">type</a> != <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2accdf9dcd8cdb612477834cf3fbc47cf8" title="One or more buttons have been pressed somewhere.">WIN_POINTER_PRESS</a>) {
<a name="l00702"></a>00702                 <span class="keywordflow">return</span>;
<a name="l00703"></a>00703         }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         <span class="comment">// Find the piece under the pointer, if any.</span>
<a name="l00706"></a>00706         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__apps__memgame__group.html#gacb2e8a8dd7c0c9357c384a8ff987689b" title="Number of pieces in the game.">NR_OF_PIECES</a>; i++) {
<a name="l00707"></a>00707                 <a class="code" href="group__apps__memgame__group.html#gaf298896281bf766f6fd86b1398ca8a9c" title="Get the coordinates for specified piece.">memgame_get_piece_coordinates</a>(i, &amp;x, &amp;y);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709                 <span class="comment">// If a piece was found, update the game.</span>
<a name="l00710"></a>00710                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>.x &gt;= x) &amp;&amp; (data-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>.y &gt;= y) &amp;&amp;
<a name="l00711"></a>00711                                 (data-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>.x &lt; (x + <a class="code" href="group__apps__memgame__group.html#gaf164cea02d507f4ef646ff0f74ec928e" title="Width of piece images.">PIECE_SIZE_X</a>)) &amp;&amp;
<a name="l00712"></a>00712                                 (data-&gt;<a class="code" href="structwin__pointer__event.html#a24b912d856a1c59565f8f830ed13d40a" title="Position of press/release, or destination of move.">pos</a>.y &lt; (y + <a class="code" href="group__apps__memgame__group.html#ga5ced27aac77b72415cd0beb4a7c6ec8c" title="Height of piece images.">PIECE_SIZE_Y</a>))) {
<a name="l00713"></a>00713                         <a class="code" href="group__apps__memgame__group.html#ga495477af72d901a222ff7b871aa7f593" title="Update the game.">memgame_update</a>(i);
<a name="l00714"></a>00714                         <span class="keywordflow">break</span>;
<a name="l00715"></a>00715                 }
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00733"></a><a class="code" href="group__apps__memgame__group.html#ga5bbe08389898a6224041f86008386489">00733</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="group__apps__memgame__group.html#ga5bbe08389898a6224041f86008386489" title="Window event handler for application.">memgame_window_handler</a>(<span class="keyword">struct</span> <a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *win,
<a name="l00734"></a>00734                 <span class="keyword">enum</span> <a class="code" href="group__gfx__win.html#gafd48398368ba40935ca545757cb796a6" title="Valid event types sent to a window event handler.">win_event_type</a> type, <span class="keywordtype">void</span> <span class="keyword">const</span> *data)
<a name="l00735"></a>00735 {
<a name="l00736"></a>00736         <span class="comment">// Only process input if application is not currently busy.</span>
<a name="l00737"></a>00737         <span class="keywordflow">if</span> (!game_ctx-&gt;<a class="code" href="structmemgame__context.html#ada18d703fc973ded4f007bd6a74baecb" title="Flag indicating that the application is busy loading images.">busy</a>) {
<a name="l00738"></a>00738                 <span class="keywordflow">switch</span> (type) {
<a name="l00739"></a>00739                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6a43efd2381d0ac306f0029ca95a9b96a6" title="Command event, more details in the event itself.">WIN_EVENT_COMMAND</a>:
<a name="l00740"></a>00740                         <a class="code" href="group__apps__memgame__group.html#ga6068a5b0697bb5547f548c73a4c3c3e8" title="Command event handler for application.">memgame_handle_command_event</a>((<a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a>)data);
<a name="l00741"></a>00741                         <span class="keywordflow">break</span>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743                 <span class="keywordflow">case</span> <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6a1e0c0b12cd9f4c453412c5a2437520ac" title="Pointer event, more details in the event itself.">WIN_EVENT_POINTER</a>:
<a name="l00744"></a>00744                         <a class="code" href="group__apps__memgame__group.html#ga5d19fa4ea782aa856b618f5e0ba54de8" title="Pointer event handler for application.">memgame_handle_pointer_event</a>(
<a name="l00745"></a>00745                                         (<span class="keyword">struct</span> <a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> <span class="keyword">const</span> *)data);
<a name="l00746"></a>00746                         <span class="keywordflow">break</span>;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748                 <span class="keywordflow">default</span>:
<a name="l00749"></a>00749                         <span class="keywordflow">break</span>;
<a name="l00750"></a>00750                 }
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00765"></a><a class="code" href="group__apps__memgame__group.html#ga76ac694c6d398da4255385154f272847">00765</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#ga76ac694c6d398da4255385154f272847" title="Application task worker.">memgame_worker</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767         <a class="code" href="group__apps__memgame__group.html#ga495477af72d901a222ff7b871aa7f593" title="Update the game.">memgame_update</a>(<a class="code" href="group__apps__memgame__group.html#gaeb00458f59e0b28718cc67dcaaf320c0" title="Index to use to indicate no piece is selected.">PIECE_INVALID_INDEX</a>);
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
<a name="l00778"></a><a class="code" href="group__apps__memgame__group.html#gac1339b42cab4906f003be45bfd0e8724">00778</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#gac1339b42cab4906f003be45bfd0e8724" title="Timer callback function.">memgame_timer_callback</a>(<span class="keyword">struct</span> <a class="code" href="structtimer.html" title="Timer data.">timer</a> *<a class="code" href="structtimer.html" title="Timer data.">timer</a>)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780         <span class="keywordflow">if</span> (--game_ctx-&gt;<a class="code" href="structmemgame__context.html#acc564bfa39c756a7b761ab0fef1501d0" title="Application timer countdown.">ticks_to_go</a> &gt; 0) {
<a name="l00781"></a>00781                 <a class="code" href="group__timer__group.html#ga99bcf5cf0bc4c7eda6af86fdf5b6c65e" title="Set timer alarm.">timer_set_alarm</a>(CONFIG_TIMER_ID, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a00f34951f43c150f01bc01b767a36162" title="Timer struct needed for the timer driver.">timer</a>,
<a name="l00782"></a>00782                                 game_ctx-&gt;<a class="code" href="structmemgame__context.html#aea645e3c1037f02bcf183bbd86a32782" title="Timer delay needed to detect elapsed half-seconds.">timer_delay</a>);
<a name="l00783"></a>00783         } <span class="keywordflow">else</span> {
<a name="l00784"></a>00784                 <a class="code" href="group__timer__group.html#ga590ac9452b480e00dfc03987c4d68bd6" title="Stop the timer.">timer_stop</a>(CONFIG_TIMER_ID, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a00f34951f43c150f01bc01b767a36162" title="Timer struct needed for the timer driver.">timer</a>);
<a name="l00785"></a>00785                 <a class="code" href="group__workqueue__group.html#gaba0573bf3d1a0201616ec03944ecfd41" title="Add task to work queue.">workqueue_add_task</a>(&amp;<a class="code" href="group__workqueue__group.html#ga6c0de22a1ae8b7797e67df97f23f4707" title="The main work queue.">main_workqueue</a>, game_ctx-&gt;<a class="code" href="structmemgame__context.html#a06d1fbccba99172525d77cac97f39c37" title="Pointer to workqueue task for the application.">task</a>);
<a name="l00786"></a>00786         }
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00800"></a><a class="code" href="group__apps__memgame__group.html#ga0a851278758013a4292c38c227b31ed8">00800</a> <span class="keywordtype">void</span> <a class="code" href="group__apps__memgame__group.html#ga0a851278758013a4292c38c227b31ed8" title="Memory game application launcher.">app_memgame_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802         <span class="keyword">struct </span><a class="code" href="structwin__attributes.html" title="Window attribute data.">win_attributes</a>  attr;
<a name="l00803"></a>00803         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>      *win;
<a name="l00804"></a>00804         <span class="keyword">struct </span><a class="code" href="structwtk__button.html">wtk_button</a>      *button;
<a name="l00805"></a>00805         <span class="keyword">struct </span><a class="code" href="structwtk__label.html">wtk_label</a>       *label;
<a name="l00806"></a>00806         <span class="keyword">struct </span><a class="code" href="structtimer.html" title="Timer data.">timer</a>           *<a class="code" href="structtimer.html" title="Timer data.">timer</a>;
<a name="l00807"></a>00807         <a class="code" href="group__timer__xmega__group.html#ga846389f68c68d6bc2f6344b16eb84165" title="Driver internal timer resolution type.">timer_res_t</a>            timer_res;
<a name="l00808"></a>00808         <a class="code" href="group__stdint__group.html#ga09a1e304d66d35dd47daffee9731edaa" title="32-bit unsigned integer">uint32_t</a>               timer_clk;
<a name="l00809"></a>00809         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>            width = <a class="code" href="group__gfx__gfx.html#ga08c77dc3294e612b75aa054f77f22773" title="Return the current width of the screen.">gfx_get_width</a>();
<a name="l00810"></a>00810         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>            height = <a class="code" href="group__gfx__gfx.html#ga18bda375fb523cfcb6f41862be5ba7b4" title="Return the current height of the screen.">gfx_get_height</a>();
<a name="l00811"></a>00811 
<a name="l00812"></a>00812         <span class="comment">// Clear the screen right away.</span>
<a name="l00813"></a>00813 <span class="preprocessor">#ifdef CONFIG_GFX_USE_CLIPPING</span>
<a name="l00814"></a>00814 <span class="preprocessor"></span>        <a class="code" href="group__gfx__gfx.html#gae49753292f3bea04f21414bb2e505b7e" title="Set the clipping region.">gfx_set_clipping</a>(0, 0, width, height);
<a name="l00815"></a>00815 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_GFX_USE_CLIPPING */</span>
<a name="l00816"></a>00816         <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(0, 0, width, height, <a class="code" href="group__apps__memgame__group.html#ga61ae6f1ae401c962137f2ae1d2a158df" title="Background color for the game.">BACKGROUND_COLOR</a>);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818         <span class="comment">// Allocate the application context.</span>
<a name="l00819"></a>00819         game_ctx = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structmemgame__context.html" title="Context for the memory game application.">memgame_context</a>));
<a name="l00820"></a>00820         <span class="keywordflow">if</span>(!game_ctx){
<a name="l00821"></a>00821                 <span class="keywordflow">goto</span> exit_no_context;
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(task);
<a name="l00825"></a>00825         <a class="code" href="group__workqueue__group.html#ga3e86382d7bdc644fbc706e7d1ad1ce2d" title="Change the worker function of a task.">workqueue_task_set_work_func</a>(task, <a class="code" href="group__apps__memgame__group.html#ga76ac694c6d398da4255385154f272847" title="Application task worker.">memgame_worker</a>);
<a name="l00826"></a>00826         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a06d1fbccba99172525d77cac97f39c37" title="Pointer to workqueue task for the application.">task</a> = task;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828         <span class="comment">// Use larger sysfont for this app.</span>
<a name="l00829"></a>00829         <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a1a71ff5972e5868af50baf23112356d7" title="Backup copy of sysfont, to restore upon application exit.">old_sysfont</a>, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00830"></a>00830         <a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>.<a class="code" href="structfont.html#a93930e293fe0c2a740da28bbd8f1a46d" title="Number of times characters are scaled up when being drawn.">scale</a> = <a class="code" href="group__apps__memgame__group.html#ga5536e218c61e2849cea7f756ef3e516b" title="Font scaling for button widgets.">WIDGET_FONT_SCALE</a>;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832         <span class="comment">// Initialize the timer with the configured resolution.</span>
<a name="l00833"></a>00833         timer = &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a00f34951f43c150f01bc01b767a36162" title="Timer struct needed for the timer driver.">timer</a>;
<a name="l00834"></a>00834         <a class="code" href="group__timer__group.html#ga258c7ae0c4f9ffb72ca8dd28d34e78d1" title="Timer initialization.">timer_init</a>(CONFIG_TIMER_ID, timer, <a class="code" href="group__apps__memgame__group.html#gac1339b42cab4906f003be45bfd0e8724" title="Timer callback function.">memgame_timer_callback</a>);
<a name="l00835"></a>00835         timer_res = <a class="code" href="group__timer__group.html#gad5e3c0958bdd6c47513a9751ad340bbc" title="Generate a timer resolution configuration.">timer_set_resolution</a>(CONFIG_TIMER_ID, timer,
<a name="l00836"></a>00836                         <a class="code" href="group__apps__slide__group.html#gaf7691789d566cc2cc5c3534cc1bf8dd5" title="Minimum timer clock rate to use.">TIMER_CLOCK_RATE</a>);
<a name="l00837"></a>00837         <a class="code" href="group__timer__group.html#ga9b6dab6d3c270cfa7a19fab34e6e121a" title="Set a timer resolution.">timer_write_resolution</a>(CONFIG_TIMER_ID, timer, timer_res);
<a name="l00838"></a>00838         timer_clk = <a class="code" href="group__timer__group.html#ga21f6055136e82c90855ec5b3cb2e7ba1" title="Convert the timer resolution configuration to ticks per second.">timer_get_resolution</a>(CONFIG_TIMER_ID, timer, timer_res);
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(timer_clk &lt;= (<a class="code" href="group__stdint__group.html#ga09a1e304d66d35dd47daffee9731edaa" title="32-bit unsigned integer">uint32_t</a>)0x1ffff);
<a name="l00841"></a>00841         game_ctx-&gt;<a class="code" href="structmemgame__context.html#aea645e3c1037f02bcf183bbd86a32782" title="Timer delay needed to detect elapsed half-seconds.">timer_delay</a> = timer_clk / 2;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="comment">// Set up bitmap for window background.</span>
<a name="l00844"></a>00844         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a48ba6ce5d17df65ec31780f08a24d686" title="Bitmap metadata for application window background.">bitmap</a>.<a class="code" href="structgfx__bitmap.html#a25e3747161bb4053f91cbaab6bdc216d" title="Bitmap type.">type</a> = <a class="code" href="group__gfx__gfx.html#ggaaa3d242c7c08ccafbb00bbcfabe27e3fa5347f7bf0548ae0c3cc8210f49b937a6" title="Solid color bitmap.">BITMAP_SOLID</a>;
<a name="l00845"></a>00845         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a48ba6ce5d17df65ec31780f08a24d686" title="Bitmap metadata for application window background.">bitmap</a>.data.<a class="code" href="structgfx__bitmap.html#a79b389912a0bf990d9c23e8b21f02569" title="Color for solid color bitmaps.">color</a> = <a class="code" href="group__apps__memgame__group.html#ga61ae6f1ae401c962137f2ae1d2a158df" title="Background color for the game.">BACKGROUND_COLOR</a>;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         <span class="comment">// Create main application window.</span>
<a name="l00848"></a>00848         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = 0;
<a name="l00849"></a>00849         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = 0;
<a name="l00850"></a>00850         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = width;
<a name="l00851"></a>00851         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = height;
<a name="l00852"></a>00852         attr.<a class="code" href="structwin__attributes.html#ab3aaadedb6a8197cbd119cc7bb54ca64" title="Window background.">background</a> = &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a48ba6ce5d17df65ec31780f08a24d686" title="Bitmap metadata for application window background.">bitmap</a>;
<a name="l00853"></a>00853         attr.<a class="code" href="structwin__attributes.html#a1f7233ed770b597a93a5e1dd3c1917b8" title="Event handler callback, or NULL.">event_handler</a> = <a class="code" href="group__apps__memgame__group.html#ga5bbe08389898a6224041f86008386489" title="Window event handler for application.">memgame_window_handler</a>;
<a name="l00854"></a>00854         win = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(<a class="code" href="group__gfx__win.html#gabb0c95ee3810418e2dff2264aac277fa" title="Get pointer to root window, i.e. desktop window.">win_get_root</a>(), &amp;attr);
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (!win) {
<a name="l00856"></a>00856                 <span class="keywordflow">goto</span> exit_no_window;
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858         game_ctx-&gt;<a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03" title="Pointer to the application&amp;#39;s main window.">win</a> = win;
<a name="l00859"></a>00859 
<a name="l00860"></a>00860         <span class="comment">// Create standard exit-button.</span>
<a name="l00861"></a>00861         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = <a class="code" href="group__app__desktop__group.html#ga5bbdd8d99101726755ec0409b134c2a3" title="Common application exit button position.">APP_EXIT_BUTTON_POS_X</a>;
<a name="l00862"></a>00862         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = <a class="code" href="group__app__desktop__group.html#gacb8ee3f83aa45ade6b1a42e4fa3cdf3e" title="Common application exit button position.">APP_EXIT_BUTTON_POS_Y</a>;
<a name="l00863"></a>00863         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = <a class="code" href="group__app__desktop__group.html#ga143dc232ad4bf9b5f0a1abab1807dae9" title="Common application exit button size.">APP_EXIT_BUTTON_SIZE_X</a>;
<a name="l00864"></a>00864         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = <a class="code" href="group__app__desktop__group.html#gad91551723f80d14a01e432a0573977f4" title="Common application exit button size.">APP_EXIT_BUTTON_SIZE_Y</a>;
<a name="l00865"></a>00865         button = <a class="code" href="group__gfx__wtk__button.html#gaebe80c65856294eab28bb29264e2bd64">wtk_button_create</a>(win, &amp;attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>, <a class="code" href="group__app__desktop__group.html#gafbd2c3cda74c4c7efee584275f4ca26e" title="Common application exit button text.">APP_EXIT_BUTTON_TEXT</a>,
<a name="l00866"></a>00866                         (<a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a>)<a class="code" href="group__apps__tank__group.html#gga9c67ad111c5d786be5639fc2d489aa2ea423988140dabaa461f133924ca772294" title="Command event value to use for exit-button.">CMD_EXIT</a>);
<a name="l00867"></a>00867         <span class="keywordflow">if</span> (!button) {
<a name="l00868"></a>00868                 <span class="keywordflow">goto</span> exit_no_widget;
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(<a class="code" href="group__gfx__wtk__button.html#ga5fc0cc848622a1e21f00648be089ae63">wtk_button_as_child</a>(button));
<a name="l00871"></a>00871 
<a name="l00872"></a>00872         <span class="comment">// Create new game-button.</span>
<a name="l00873"></a>00873         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = <a class="code" href="group__apps__memgame__group.html#ga77c240224a7eb37151d008a7fe169d0b" title="X-coordinate of button.">BTN_NEW_GAME_POS_X</a>;
<a name="l00874"></a>00874         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = <a class="code" href="group__apps__memgame__group.html#ga1885e7f4d599cd8c39d603ea231baed2" title="Y-coordinate of button.">BTN_NEW_GAME_POS_Y</a>;
<a name="l00875"></a>00875         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = <a class="code" href="group__apps__memgame__group.html#ga3e2367776233beff751ae4cb748b473b" title="Width of button.">BTN_NEW_GAME_SIZE_X</a>;
<a name="l00876"></a>00876         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = <a class="code" href="group__apps__memgame__group.html#ga5eb03f07f5840e59a1c37f95bb907b74" title="Height of button.">BTN_NEW_GAME_SIZE_Y</a>;
<a name="l00877"></a>00877         button = <a class="code" href="group__gfx__wtk__button.html#gaebe80c65856294eab28bb29264e2bd64">wtk_button_create</a>(win, &amp;attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>, <a class="code" href="group__apps__memgame__group.html#gabe95223955d66c94f48a4d7588ec1c9c" title="Text to draw on button.">BTN_NEW_GAME_TEXT</a>,
<a name="l00878"></a>00878                         (<a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a>)<a class="code" href="group__apps__memgame__group.html#gga670ed7cd3f186995a25cdafeef4c39b0ac3f16d213fa7fbda6e8d9feaeb48046b" title="Command event value for new game-button.">CMD_NEW_GAME</a>);
<a name="l00879"></a>00879         <span class="keywordflow">if</span> (!button) {
<a name="l00880"></a>00880                 <span class="keywordflow">goto</span> exit_no_widget;
<a name="l00881"></a>00881         }
<a name="l00882"></a>00882         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(<a class="code" href="group__gfx__wtk__button.html#ga5fc0cc848622a1e21f00648be089ae63">wtk_button_as_child</a>(button));
<a name="l00883"></a>00883 
<a name="l00884"></a>00884         <span class="comment">// Create label to show number of tries.</span>
<a name="l00885"></a>00885         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = <a class="code" href="group__apps__memgame__group.html#gaf3a0a4bf56ce6ac2d621c642587bf850" title="X-coordinate of label.">MSG_TRIES_POS_X</a>;
<a name="l00886"></a>00886         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = <a class="code" href="group__apps__memgame__group.html#gad9733cba1993ada9acb851ef99fafb99" title="Y-coordinate of label, vertically centered on buttons.">MSG_TRIES_POS_Y</a>;
<a name="l00887"></a>00887         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = <a class="code" href="group__apps__memgame__group.html#ga800a50530a54146257357637adee5445" title="Width of label widget.">MSG_TRIES_SIZE_X</a>;
<a name="l00888"></a>00888         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = <a class="code" href="group__apps__memgame__group.html#ga276c51a2fca67f65302da4f1f27ff99a" title="Height of label widget.">MSG_TRIES_SIZE_Y</a>;
<a name="l00889"></a>00889         label = <a class="code" href="group__gfx__wtk__label.html#gaba01e03f0544afa6636be71df716c3fd">wtk_label_create</a>(win, &amp;attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>, <span class="stringliteral">&quot; &quot;</span>, <span class="keyword">false</span>);
<a name="l00890"></a>00890         <span class="keywordflow">if</span> (!label) {
<a name="l00891"></a>00891                 <span class="keywordflow">goto</span> exit_no_widget;
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893         game_ctx-&gt;<a class="code" href="structmemgame__context.html#a2f4ceca49b5ef7b4f8ca79f6600f24b5" title="Label widget for displaying number of tries.">tries_label</a> = label;
<a name="l00894"></a>00894         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(<a class="code" href="group__gfx__wtk__label.html#ga8764b372528db23f52d80ffe692a5679">wtk_label_as_child</a>(label));
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         <span class="comment">// Show the application window and start a new game.</span>
<a name="l00897"></a>00897         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(win);
<a name="l00898"></a>00898         <a class="code" href="group__apps__memgame__group.html#gaa35afbf6473ba965f5e64f6fc604d8b8" title="Start new game.">memgame_start_new_game</a>();
<a name="l00899"></a>00899         <span class="keywordflow">return</span>;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901         <span class="comment">// Handle memory allocation errors.</span>
<a name="l00902"></a>00902 exit_no_widget:
<a name="l00903"></a>00903         <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(game_ctx-&gt;<a class="code" href="structmemgame__context.html#aad1dc6597c656e4b35621e869fbe0b03" title="Pointer to the application&amp;#39;s main window.">win</a>);
<a name="l00904"></a>00904 exit_no_window:
<a name="l00905"></a>00905         <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, &amp;game_ctx-&gt;<a class="code" href="structmemgame__context.html#a1a71ff5972e5868af50baf23112356d7" title="Backup copy of sysfont, to restore upon application exit.">old_sysfont</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00906"></a>00906         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(game_ctx);
<a name="l00907"></a>00907         game_ctx = NULL;
<a name="l00908"></a>00908 exit_no_context:
<a name="l00909"></a>00909         <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00910"></a>00910         <span class="keywordflow">return</span>;
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:09:58 2010 for display-demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
