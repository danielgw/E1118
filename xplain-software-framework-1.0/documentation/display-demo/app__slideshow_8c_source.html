<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-demo: apps/display-demo/app_slideshow.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>apps/display-demo/app_slideshow.c</h1><a href="app__slideshow_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="assert_8h.html" title="Run-time and build-time assertion support.">assert.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="board_8h.html" title="Xplain ATxmega128A1 board-specific declarations.">board.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2interrupt_8h.html" title="AVR-specific interrupt masking/unmasking.">interrupt.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="board_2xplain_2include_2board_2led_8h.html" title="Board-specific LED control.">led.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="mainloop_8h.html" title="Main loop processing.">mainloop.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2string_8h.html" title="Standard string operations for AVR.">string.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="chip_2atxmega128a1_2include_2chip_2timer_8h.html" title="ATxmega128A1 chip-specific Timer definitions.">timer.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="tsfs_8h.html" title="Tiny Simple File System (TSFS) header file.">fs/tsfs.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="gfx_8h.html" title="General graphics routines header file.">gfx/gfx.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2win_8h.html" title="Graphical Window system.">gfx/win.h</a>&gt;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="app__desktop_8h.html" title="Display demo desktop application.">app_desktop.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="app__slideshow_8h.html" title="Display demo slideshow.">app_slideshow.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="file__loader_8h.html" title="Display Xplained image loader.">file_loader.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structtsfs.html" title="Holds information on a TSFS instance.">tsfs</a> <a class="code" href="group__app__files__group.html#gae7e8285ea1d54eda40d2f6635eec56c7" title="TSFS control struct, needed for file listing.">myfs</a>;
<a name="l00062"></a>00062 
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="group__apps__slide__group.html#gaf27cfac70191e90ee59f2fbfc0142df5">00070</a> <span class="preprocessor">#define COLOR_BACKGROUND     GFX_COLOR(0, 0, 0)</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00073"></a>00073 
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="group__apps__slide__group.html#gab82e260d20453bc773d974118ff42e31">00081</a> <span class="preprocessor">#define SECONDS_PER_SLIDE    4</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="group__apps__slide__group.html#gad8f3e961754872023ac1c9cc021ed70a">00086</a> <span class="preprocessor">#define SECONDS_PER_PAUSE    16</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00095"></a><a class="code" href="group__apps__slide__group.html#gaf7691789d566cc2cc5c3534cc1bf8dd5">00095</a> <span class="preprocessor">#define TIMER_CLOCK_RATE     (0xffff / 4)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00098"></a>00098 
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="group__apps__slide__group.html#ga424845fcd198d7b588aa4595e736c95e">00106</a> <span class="preprocessor">#define SLIDE_SIZE_X         320</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a><a class="code" href="group__apps__slide__group.html#ga873aff4597d1ac1bcb0dada0e5cd6218">00108</a> <span class="preprocessor">#define SLIDE_SIZE_Y         240</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>
<a name="l00111"></a>00111 
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="group__apps__slide__group.html#ga8c8514a5c77651325d4f8f0cf0a52067">00118</a> <span class="preprocessor">#define SLIDE_PREFIX_PICS    &quot;s_&quot;</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a><a class="code" href="group__apps__slide__group.html#gaf280981544b3506c9a518f87fc592c63">00120</a> <span class="preprocessor">#define SLIDE_PREFIX_AVR     &quot;avr&quot;</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a><a class="code" href="group__apps__slide__group.html#gafe5cf461d029f10d0df3de210f36f828">00122</a> <span class="preprocessor">#define SLIDE_PREFIX_UC3     &quot;uc3&quot;</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>
<a name="l00124"></a><a class="code" href="group__apps__slide__group.html#ga0a7bea162941bde4a6046314c623358e">00124</a> <span class="preprocessor">#define SLIDE_PREFIX_XMEGA   &quot;xmega&quot;</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>
<a name="l00126"></a><a class="code" href="group__apps__slide__group.html#ga884c95d12cdd5bd1db489a08b85328bb">00126</a> <span class="preprocessor">#define SLIDE_PREFIX_DX      &quot;dispxpl&quot;</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>
<a name="l00129"></a>00129 
<a name="l00131"></a><a class="code" href="structslide__context.html">00131</a> <span class="keyword">struct </span><a class="code" href="structslide__context.html" title="Context for the slideshow application.">slide_context</a> {
<a name="l00133"></a><a class="code" href="structslide__context.html#a6d862b93a79619c375312d2e8c5a4653">00133</a>         <span class="keyword">struct </span><a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *<a class="code" href="structslide__context.html#a6d862b93a79619c375312d2e8c5a4653" title="Pointer to the workqueue task of the application.">task</a>;
<a name="l00135"></a><a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8">00135</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>     *<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a>;
<a name="l00137"></a><a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a">00137</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>     *<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a>;
<a name="l00139"></a><a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e">00139</a>         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>     *<a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e" title="Pointer to right application window.">right</a>;
<a name="l00141"></a><a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514">00141</a>         <span class="keyword">struct </span><a class="code" href="structtimer.html" title="Timer data.">timer</a>          <a class="code" href="structtimer.html" title="Timer data.">timer</a>;
<a name="l00143"></a><a class="code" href="structslide__context.html#a92cbe45ab0e631abd23220f9af511740">00143</a>         <a class="code" href="group__stdint__group.html#ga5a8b2dc9e45a9ee81a94ef304fb62505" title="16-bit unsigned integer">uint16_t</a>              <a class="code" href="structslide__context.html#a92cbe45ab0e631abd23220f9af511740" title="Timer delay needed for detection of 1 elapsed second.">timer_delay</a>;
<a name="l00145"></a><a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba">00145</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>               <a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a>;
<a name="l00147"></a><a class="code" href="structslide__context.html#a2264cae6e0a9eda4e1e177608e037010">00147</a>         <span class="keywordtype">bool</span>                  <a class="code" href="structslide__context.html#a2264cae6e0a9eda4e1e177608e037010" title="Flag indicating that a slide is currently being loaded.">busy</a>;
<a name="l00149"></a><a class="code" href="structslide__context.html#a6a69655b19730971b7ced422b2441833">00149</a>         <span class="keywordtype">bool</span>                  <a class="code" href="structslide__context.html#a6a69655b19730971b7ced422b2441833" title="Flag indicating that application shall exit.">exit_now</a>;
<a name="l00151"></a><a class="code" href="structslide__context.html#a4ade9caedcc8e09dd906747a4824fcd0">00151</a>         <span class="keywordtype">char</span>                  *<a class="code" href="structslide__context.html#a4ade9caedcc8e09dd906747a4824fcd0" title="Pointer to string with file prefix for current slideshow.">file_prefix</a>;
<a name="l00153"></a><a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254">00153</a>         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>               <a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a>;
<a name="l00154"></a>00154 };
<a name="l00155"></a>00155 
<a name="l00163"></a><a class="code" href="group__apps__slide__group.html#gab80487a994e1954cee2e980f29af3485">00163</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structslide__context.html" title="Context for the slideshow application.">slide_context</a> *<a class="code" href="structslide__context.html" title="Context for the slideshow application.">slide_context</a>;
<a name="l00164"></a>00164 
<a name="l00176"></a><a class="code" href="group__apps__slide__group.html#ga3e7b4aebfbd855f55f46339d43c8bed6">00176</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#ga3e7b4aebfbd855f55f46339d43c8bed6" title="Find index of next slideshow file to load.">slide_get_next_file</a>(<span class="keywordtype">bool</span> increment)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178         <span class="keywordtype">char</span> filename[<a class="code" href="group__tsfs__group.html#ga9fd4f8fe49119798137c73fa0ba43eb6" title="Max characters in a filename.">TSFS_FILENAME_LEN</a> + 1];
<a name="l00179"></a>00179         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> <a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a>;
<a name="l00180"></a>00180         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> prefix_len;
<a name="l00181"></a>00181         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> nr_of_files;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         file_index = slide_context-&gt;<a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a>;
<a name="l00184"></a>00184         prefix_len = <a class="code" href="group__string__group.html#ga008e171a518fe0e0352f31b245e03875" title="Calculate the length of a string.">strlen</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a4ade9caedcc8e09dd906747a4824fcd0" title="Pointer to string with file prefix for current slideshow.">file_prefix</a>);
<a name="l00185"></a>00185         nr_of_files = <a class="code" href="group__tsfs__group.html#ga88cf5b8a152cf863fefd20fc99869545" title="Returns the number of files present in a file system.">tsfs_nr_files</a>(&amp;<a class="code" href="group__app__files__group.html#gae7e8285ea1d54eda40d2f6635eec56c7" title="TSFS control struct, needed for file listing.">myfs</a>);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="comment">// Search for next file with matching filename prefix.</span>
<a name="l00188"></a>00188         <span class="keywordflow">do</span> {
<a name="l00189"></a>00189                 <span class="keywordflow">if</span> (increment) {
<a name="l00190"></a>00190                         file_index++;
<a name="l00191"></a>00191                 } <span class="keywordflow">else</span> {
<a name="l00192"></a>00192                         file_index--;
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195                 <span class="comment">// Handle out-of-bounds file indexes.</span>
<a name="l00196"></a>00196                 <span class="keywordflow">if</span> (file_index &gt; nr_of_files) {
<a name="l00197"></a>00197                         file_index -= nr_of_files;
<a name="l00198"></a>00198                 }
<a name="l00199"></a>00199                 <span class="keywordflow">if</span> (file_index &lt; 1) {
<a name="l00200"></a>00200                         file_index += nr_of_files;
<a name="l00201"></a>00201                 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 <span class="comment">// Break out of the loop if no new file could be found.</span>
<a name="l00204"></a>00204                 <span class="keywordflow">if</span> (file_index == slide_context-&gt;<a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a>) {
<a name="l00205"></a>00205                         <span class="keywordflow">break</span>;
<a name="l00206"></a>00206                 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208                 <span class="comment">/* Get the filename associated with the file index for</span>
<a name="l00209"></a>00209 <span class="comment">                 * comparison with the current filename prefix.</span>
<a name="l00210"></a>00210 <span class="comment">                 */</span>
<a name="l00211"></a>00211                 <a class="code" href="group__tsfs__group.html#gaab9c9ffdd0717336e1ccac397e158f06" title="Reads the filename of an indexed file into a buffer.">tsfs_get_filename</a>(&amp;<a class="code" href="group__app__files__group.html#gae7e8285ea1d54eda40d2f6635eec56c7" title="TSFS control struct, needed for file listing.">myfs</a>, file_index, (<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> *)filename);
<a name="l00212"></a>00212         } <span class="keywordflow">while</span> (<a class="code" href="group__string__group.html#gab36f95eb212013e67f97dacede2751db" title="Compare the first n characters of two strings str1 and str2.">strncmp</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a4ade9caedcc8e09dd906747a4824fcd0" title="Pointer to string with file prefix for current slideshow.">file_prefix</a>, filename, prefix_len) !=
<a name="l00213"></a>00213                         0);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         slide_context-&gt;<a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a> = file_index;
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00225"></a><a class="code" href="group__apps__slide__group.html#gafb2e8815a7e29a8d46dec70ff7d76ac4">00225</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#gafb2e8815a7e29a8d46dec70ff7d76ac4" title="Start loading current file to screen.">slide_show_file</a>(<span class="keywordtype">void</span>)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227         <span class="keyword">enum</span> <a class="code" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151">status_code</a> result;
<a name="l00228"></a>00228         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> filename[<a class="code" href="group__tsfs__group.html#ga9fd4f8fe49119798137c73fa0ba43eb6" title="Max characters in a filename.">TSFS_FILENAME_LEN</a> + 1];
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <a class="code" href="group__tsfs__group.html#gaab9c9ffdd0717336e1ccac397e158f06" title="Reads the filename of an indexed file into a buffer.">tsfs_get_filename</a>(&amp;<a class="code" href="group__app__files__group.html#gae7e8285ea1d54eda40d2f6635eec56c7" title="TSFS control struct, needed for file listing.">myfs</a>, slide_context-&gt;<a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a>, filename);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         result = <a class="code" href="group__appsutil__fileloader__group.html#gac9ce98d283b3435ab545a59efd9439f1" title="Load file data directly to screen.">load_file_to_screen</a>((<span class="keywordtype">char</span> *)filename, 0, 0, <a class="code" href="group__apps__slide__group.html#ga424845fcd198d7b588aa4595e736c95e" title="Width of slideshow images.">SLIDE_SIZE_X</a>,
<a name="l00233"></a>00233                         <a class="code" href="group__apps__slide__group.html#ga873aff4597d1ac1bcb0dada0e5cd6218" title="Height of slideshow images.">SLIDE_SIZE_Y</a>, slide_context-&gt;<a class="code" href="structslide__context.html#a6d862b93a79619c375312d2e8c5a4653" title="Pointer to the workqueue task of the application.">task</a>);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="keywordflow">if</span> (result == <a class="code" href="status__codes_8h.html#a751c892e5a46b8e7d282085a5a5bf151a7e4a42e3b6dd63708c64cf3db6f69566" title="Success.">STATUS_OK</a>) {
<a name="l00236"></a>00236                 slide_context-&gt;<a class="code" href="structslide__context.html#a2264cae6e0a9eda4e1e177608e037010" title="Flag indicating that a slide is currently being loaded.">busy</a> = <span class="keyword">true</span>;
<a name="l00237"></a>00237         } <span class="keywordflow">else</span> {
<a name="l00238"></a>00238                 slide_context-&gt;<a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a> = 1;
<a name="l00239"></a>00239                 <a class="code" href="group__timer__group.html#gab0f2bb4f901226817d72d06b683777eb" title="Start the timer.">timer_start</a>(CONFIG_TIMER_ID, &amp;slide_context-&gt;<a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514" title="Timer struct needed for the timer driver.">timer</a>);
<a name="l00240"></a>00240                 <a class="code" href="group__timer__group.html#ga99bcf5cf0bc4c7eda6af86fdf5b6c65e" title="Set timer alarm.">timer_set_alarm</a>(CONFIG_TIMER_ID, &amp;slide_context-&gt;<a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514" title="Timer struct needed for the timer driver.">timer</a>,
<a name="l00241"></a>00241                                 slide_context-&gt;<a class="code" href="structslide__context.html#a92cbe45ab0e631abd23220f9af511740" title="Timer delay needed for detection of 1 elapsed second.">timer_delay</a>);
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00258"></a><a class="code" href="group__apps__slide__group.html#gaccc0c9f5a24d0f6a97a08cbf8d90c614">00258</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#gaccc0c9f5a24d0f6a97a08cbf8d90c614" title="Timer alarm callback for automatic loading.">slide_timer_callback</a>(<span class="keyword">struct</span> <a class="code" href="structtimer.html" title="Timer data.">timer</a> *<a class="code" href="structtimer.html" title="Timer data.">timer</a>)
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> <a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a>;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         secs_to_go = slide_context-&gt;<a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <span class="comment">// Start loading next slide on timeout, otherwise reset the alarm.</span>
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (--secs_to_go == 0) {
<a name="l00266"></a>00266                 secs_to_go = <a class="code" href="group__apps__slide__group.html#gab82e260d20453bc773d974118ff42e31" title="Number of seconds to wait before loading the next slide.">SECONDS_PER_SLIDE</a>;
<a name="l00267"></a>00267                 <a class="code" href="group__apps__slide__group.html#ga3e7b4aebfbd855f55f46339d43c8bed6" title="Find index of next slideshow file to load.">slide_get_next_file</a>(<span class="keyword">true</span>);
<a name="l00268"></a>00268                 <a class="code" href="group__apps__slide__group.html#gafb2e8815a7e29a8d46dec70ff7d76ac4" title="Start loading current file to screen.">slide_show_file</a>();
<a name="l00269"></a>00269         } <span class="keywordflow">else</span> {
<a name="l00270"></a>00270                 <a class="code" href="group__timer__group.html#ga99bcf5cf0bc4c7eda6af86fdf5b6c65e" title="Set timer alarm.">timer_set_alarm</a>(CONFIG_TIMER_ID, timer,
<a name="l00271"></a>00271                                 slide_context-&gt;<a class="code" href="structslide__context.html#a92cbe45ab0e631abd23220f9af511740" title="Timer delay needed for detection of 1 elapsed second.">timer_delay</a>);
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273         slide_context-&gt;<a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a> = secs_to_go;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00294"></a><a class="code" href="group__apps__slide__group.html#gaad7ab9424f73bf8fb064bcef6933b5f5">00294</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="group__apps__slide__group.html#gaad7ab9424f73bf8fb064bcef6933b5f5" title="Event handler for the application windows.">slide_window_handler</a>(<span class="keyword">struct</span> <a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *win,
<a name="l00295"></a>00295                 <span class="keyword">enum</span> <a class="code" href="group__gfx__win.html#gafd48398368ba40935ca545757cb796a6" title="Valid event types sent to a window event handler.">win_event_type</a> type, <span class="keywordtype">void</span> <span class="keyword">const</span> *data)
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297         <a class="code" href="arch_2avr8_2include_2arch_2interrupt_8h.html#a59a24f6c541d2c1b20d7c897ed7bdbca" title="Type used for holding the current interrupt state.">irqflags_t</a> flags;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="keywordflow">if</span> (type == <a class="code" href="group__gfx__win.html#ggafd48398368ba40935ca545757cb796a6a1e0c0b12cd9f4c453412c5a2437520ac" title="Pointer event, more details in the event itself.">WIN_EVENT_POINTER</a>) {
<a name="l00300"></a>00300                 <span class="comment">// The data parameter points to the POINTER event information.</span>
<a name="l00301"></a>00301                 <span class="keyword">struct </span><a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> const *<span class="keyword">event</span> =
<a name="l00302"></a>00302                                 (<span class="keyword">struct </span><a class="code" href="structwin__pointer__event.html" title="Event data for all pointer events, e.g. touch screen or mouse.">win_pointer_event</a> const *)data;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304                 <span class="comment">// Wait for the pointer to be released.</span>
<a name="l00305"></a>00305                 <span class="keywordflow">if</span> (event-&gt;type == <a class="code" href="group__gfx__win.html#gga977ff672b3aea585f00cb10950e5aaf2a5d9a8016905f31b1c7726370b2f7f0de" title="One or more buttons have been released somewhere.">WIN_POINTER_RELEASE</a>) {
<a name="l00306"></a>00306                         <span class="comment">/* The timer must be stopped before checking if</span>
<a name="l00307"></a>00307 <span class="comment">                         * the application is currently loading a slide.</span>
<a name="l00308"></a>00308 <span class="comment">                         */</span>
<a name="l00309"></a>00309                         flags = <a class="code" href="arch_2avr8_2include_2arch_2interrupt_8h.html#ad0c5a270013dca8848f9902ec131c51f" title="Save the current interrupt state and disable interrupts.">cpu_irq_save</a>();
<a name="l00310"></a>00310                         <a class="code" href="group__timer__group.html#ga590ac9452b480e00dfc03987c4d68bd6" title="Stop the timer.">timer_stop</a>(CONFIG_TIMER_ID, &amp;slide_context-&gt;<a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514" title="Timer struct needed for the timer driver.">timer</a>);
<a name="l00311"></a>00311                         <a class="code" href="arch_2avr8_2include_2arch_2interrupt_8h.html#a7a4dcaf82a88398e7da6fe6099ebfc10" title="Restore saved interrupt state.">cpu_irq_restore</a>(flags);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313                         <span class="keywordflow">if</span> (slide_context-&gt;<a class="code" href="structslide__context.html#a2264cae6e0a9eda4e1e177608e037010" title="Flag indicating that a slide is currently being loaded.">busy</a>) {
<a name="l00314"></a>00314                                 <span class="comment">// Do nothing if a slide is currently loading.</span>
<a name="l00315"></a>00315                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (win == slide_context-&gt;<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a>) {
<a name="l00318"></a>00318                                 <span class="comment">/* Start loading of previous slide, and set</span>
<a name="l00319"></a>00319 <span class="comment">                                 * the longer pause timeout for the autoloading.</span>
<a name="l00320"></a>00320 <span class="comment">                                 */</span>
<a name="l00321"></a>00321                                 slide_context-&gt;<a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a> = <a class="code" href="group__apps__slide__group.html#gad8f3e961754872023ac1c9cc021ed70a" title="Number of seconds to wait before loading the next slide, when the user previously...">SECONDS_PER_PAUSE</a>;
<a name="l00322"></a>00322                                 <a class="code" href="group__apps__slide__group.html#ga3e7b4aebfbd855f55f46339d43c8bed6" title="Find index of next slideshow file to load.">slide_get_next_file</a>(<span class="keyword">false</span>);
<a name="l00323"></a>00323                                 <a class="code" href="group__apps__slide__group.html#gafb2e8815a7e29a8d46dec70ff7d76ac4" title="Start loading current file to screen.">slide_show_file</a>();
<a name="l00324"></a>00324 
<a name="l00325"></a>00325                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (win == slide_context-&gt;<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a>) {
<a name="l00326"></a>00326                                 <span class="comment">// Exit the application immediately.</span>
<a name="l00327"></a>00327                                 <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a>);
<a name="l00328"></a>00328                                 <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(slide_context-&gt;<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a>);
<a name="l00329"></a>00329                                 <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e" title="Pointer to right application window.">right</a>);
<a name="l00330"></a>00330                                 <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(slide_context);
<a name="l00331"></a>00331                                 <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (win == slide_context-&gt;<a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e" title="Pointer to right application window.">right</a>) {
<a name="l00334"></a>00334                                 <span class="comment">/* Start loading of next slide, and set the</span>
<a name="l00335"></a>00335 <span class="comment">                                 * regular timeout for the autoloading.</span>
<a name="l00336"></a>00336 <span class="comment">                                 */</span>
<a name="l00337"></a>00337                                 slide_context-&gt;<a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a> = <a class="code" href="group__apps__slide__group.html#gab82e260d20453bc773d974118ff42e31" title="Number of seconds to wait before loading the next slide.">SECONDS_PER_SLIDE</a>;
<a name="l00338"></a>00338                                 <a class="code" href="group__apps__slide__group.html#ga3e7b4aebfbd855f55f46339d43c8bed6" title="Find index of next slideshow file to load.">slide_get_next_file</a>(<span class="keyword">true</span>);
<a name="l00339"></a>00339                                 <a class="code" href="group__apps__slide__group.html#gafb2e8815a7e29a8d46dec70ff7d76ac4" title="Start loading current file to screen.">slide_show_file</a>();
<a name="l00340"></a>00340                         }
<a name="l00341"></a>00341                 }
<a name="l00342"></a>00342         }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <span class="comment">// Always accept all events</span>
<a name="l00345"></a>00345         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00357"></a><a class="code" href="group__apps__slide__group.html#ga83d6564d70c85c63df484f1b415e1073">00357</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#ga83d6564d70c85c63df484f1b415e1073" title="Application task worker.">slide_worker</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359         slide_context-&gt;<a class="code" href="structslide__context.html#a2264cae6e0a9eda4e1e177608e037010" title="Flag indicating that a slide is currently being loaded.">busy</a> = <span class="keyword">false</span>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         <a class="code" href="group__timer__group.html#gab0f2bb4f901226817d72d06b683777eb" title="Start the timer.">timer_start</a>(CONFIG_TIMER_ID, &amp;slide_context-&gt;<a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514" title="Timer struct needed for the timer driver.">timer</a>);
<a name="l00362"></a>00362         <a class="code" href="group__timer__group.html#ga99bcf5cf0bc4c7eda6af86fdf5b6c65e" title="Set timer alarm.">timer_set_alarm</a>(CONFIG_TIMER_ID, &amp;slide_context-&gt;<a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514" title="Timer struct needed for the timer driver.">timer</a>,
<a name="l00363"></a>00363                         slide_context-&gt;<a class="code" href="structslide__context.html#a92cbe45ab0e631abd23220f9af511740" title="Timer delay needed for detection of 1 elapsed second.">timer_delay</a>);
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00384"></a><a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f">00384</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f" title="Common slideshow launcher.">slide_launch_helper</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task,
<a name="l00385"></a>00385                 <span class="keywordtype">char</span> *file_prefix)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387         <span class="keyword">struct </span><a class="code" href="structwin__attributes.html" title="Window attribute data.">win_attributes</a> attr;
<a name="l00388"></a>00388         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>     *root_win = <a class="code" href="group__gfx__win.html#gabb0c95ee3810418e2dff2264aac277fa" title="Get pointer to root window, i.e. desktop window.">win_get_root</a>();
<a name="l00389"></a>00389         <span class="keyword">struct </span><a class="code" href="structtimer.html" title="Timer data.">timer</a>          *<a class="code" href="structtimer.html" title="Timer data.">timer</a>;
<a name="l00390"></a>00390         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>           <a class="code" href="group__gfx__gfx.html#ga5e8b38d01fb938b2d8001e0e95f8219a" title="Current width of screen.">gfx_width</a> = <a class="code" href="group__gfx__gfx.html#ga08c77dc3294e612b75aa054f77f22773" title="Return the current width of the screen.">gfx_get_width</a>();
<a name="l00391"></a>00391         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a>           <a class="code" href="group__gfx__gfx.html#gae19ecc2f5ddc105132d31c4c6dcb42ad" title="Current height of screen.">gfx_height</a> = <a class="code" href="group__gfx__gfx.html#ga18bda375fb523cfcb6f41862be5ba7b4" title="Return the current height of the screen.">gfx_get_height</a>();
<a name="l00392"></a>00392         <a class="code" href="group__timer__xmega__group.html#ga846389f68c68d6bc2f6344b16eb84165" title="Driver internal timer resolution type.">timer_res_t</a>           timer_res;
<a name="l00393"></a>00393         <a class="code" href="group__stdint__group.html#ga09a1e304d66d35dd47daffee9731edaa" title="32-bit unsigned integer">uint32_t</a>              timer_clk;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(task);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397         <span class="comment">// Allocate memory for the application context.</span>
<a name="l00398"></a>00398         slide_context = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> slide_context));
<a name="l00399"></a>00399         <span class="keywordflow">if</span> (!slide_context) {
<a name="l00400"></a>00400                 <span class="keywordflow">goto</span> exit_no_context;
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403         <span class="comment">// Clear the display.</span>
<a name="l00404"></a>00404 <span class="preprocessor">#ifdef CONFIG_GFX_USE_CLIPPING</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>        <a class="code" href="group__gfx__gfx.html#gae49753292f3bea04f21414bb2e505b7e" title="Set the clipping region.">gfx_set_clipping</a>(0, 0, gfx_width, gfx_height);
<a name="l00406"></a>00406 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_GFX_USE_CLIPPING */</span>
<a name="l00407"></a>00407         <a class="code" href="group__gfx__gfx.html#gac466c148896f0b12a313294560e3c10c" title="Draw a filled rectangle.">gfx_draw_filled_rect</a>(0, 0, gfx_width, gfx_height, <a class="code" href="group__app__clock__group.html#gaf27cfac70191e90ee59f2fbfc0142df5" title="Background color.">COLOR_BACKGROUND</a>);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         <span class="comment">// Initialize the timer with the configured resolution.</span>
<a name="l00410"></a>00410         timer = &amp;slide_context-&gt;<a class="code" href="structslide__context.html#a3696a87646128149a541a1c7631b9514" title="Timer struct needed for the timer driver.">timer</a>;
<a name="l00411"></a>00411         <a class="code" href="group__timer__group.html#ga258c7ae0c4f9ffb72ca8dd28d34e78d1" title="Timer initialization.">timer_init</a>(CONFIG_TIMER_ID, timer, <a class="code" href="group__apps__slide__group.html#gaccc0c9f5a24d0f6a97a08cbf8d90c614" title="Timer alarm callback for automatic loading.">slide_timer_callback</a>);
<a name="l00412"></a>00412         timer_res = <a class="code" href="group__timer__group.html#gad5e3c0958bdd6c47513a9751ad340bbc" title="Generate a timer resolution configuration.">timer_set_resolution</a>(CONFIG_TIMER_ID, timer,
<a name="l00413"></a>00413                         <a class="code" href="group__apps__slide__group.html#gaf7691789d566cc2cc5c3534cc1bf8dd5" title="Minimum timer clock rate to use.">TIMER_CLOCK_RATE</a>);
<a name="l00414"></a>00414         <a class="code" href="group__timer__group.html#ga9b6dab6d3c270cfa7a19fab34e6e121a" title="Set a timer resolution.">timer_write_resolution</a>(CONFIG_TIMER_ID, timer, timer_res);
<a name="l00415"></a>00415         timer_clk = <a class="code" href="group__timer__group.html#ga21f6055136e82c90855ec5b3cb2e7ba1" title="Convert the timer resolution configuration to ticks per second.">timer_get_resolution</a>(CONFIG_TIMER_ID, timer, timer_res);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="comment">// Timer clock should be slow enough to allow for detection of 1 second.</span>
<a name="l00418"></a>00418         <a class="code" href="group__assert__group.html#gacdcc5aaebf3f273c1762f24a6ece2e5e" title="Assert that condition is true at run time.">assert</a>(timer_clk &lt;= 0xffff);
<a name="l00419"></a>00419 
<a name="l00420"></a>00420         <span class="comment">// Initialize the application context and task.</span>
<a name="l00421"></a>00421         slide_context-&gt;<a class="code" href="structslide__context.html#a92cbe45ab0e631abd23220f9af511740" title="Timer delay needed for detection of 1 elapsed second.">timer_delay</a> = timer_clk;
<a name="l00422"></a>00422         slide_context-&gt;<a class="code" href="structslide__context.html#a0048cee991ea96356c0a6f35bafbf0ba" title="Seconds to go before next slide is loaded.">secs_to_go</a> = <a class="code" href="group__apps__slide__group.html#gab82e260d20453bc773d974118ff42e31" title="Number of seconds to wait before loading the next slide.">SECONDS_PER_SLIDE</a>;
<a name="l00423"></a>00423         slide_context-&gt;<a class="code" href="structslide__context.html#a4ade9caedcc8e09dd906747a4824fcd0" title="Pointer to string with file prefix for current slideshow.">file_prefix</a> = file_prefix;
<a name="l00424"></a>00424         slide_context-&gt;<a class="code" href="structslide__context.html#a0f724cb56ac3ca900b6e570f068c7254" title="Index of current slideshow file in TSFS.">file_index</a> = 0;
<a name="l00425"></a>00425         slide_context-&gt;<a class="code" href="structslide__context.html#a6d862b93a79619c375312d2e8c5a4653" title="Pointer to the workqueue task of the application.">task</a> = task;
<a name="l00426"></a>00426         <a class="code" href="group__workqueue__group.html#ga3e86382d7bdc644fbc706e7d1ad1ce2d" title="Change the worker function of a task.">workqueue_task_set_work_func</a>(task, <a class="code" href="group__apps__slide__group.html#ga83d6564d70c85c63df484f1b415e1073" title="Application task worker.">slide_worker</a>);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <span class="comment">/* Create windows for the left, middle and right sections of display.</span>
<a name="l00429"></a>00429 <span class="comment">         * The middle window is half the width of the display, while the two</span>
<a name="l00430"></a>00430 <span class="comment">         * others are a quarter of the width.</span>
<a name="l00431"></a>00431 <span class="comment">         * These will use a common window event handler.</span>
<a name="l00432"></a>00432 <span class="comment">         */</span>
<a name="l00433"></a>00433         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x = 0;
<a name="l00434"></a>00434         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.y = 0;
<a name="l00435"></a>00435         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = gfx_width / 4;
<a name="l00436"></a>00436         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.y = gfx_height;
<a name="l00437"></a>00437         attr.<a class="code" href="structwin__attributes.html#ab3aaadedb6a8197cbd119cc7bb54ca64" title="Window background.">background</a> = NULL;
<a name="l00438"></a>00438         attr.<a class="code" href="structwin__attributes.html#a1f7233ed770b597a93a5e1dd3c1917b8" title="Event handler callback, or NULL.">event_handler</a> = <a class="code" href="group__apps__slide__group.html#gaad7ab9424f73bf8fb064bcef6933b5f5" title="Event handler for the application windows.">slide_window_handler</a>;
<a name="l00439"></a>00439         slide_context-&gt;<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a> = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(root_win, &amp;attr);
<a name="l00440"></a>00440         <span class="keywordflow">if</span> (!slide_context-&gt;<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a>) {
<a name="l00441"></a>00441                 <span class="keywordflow">goto</span> exit_no_left_window;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x += attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x;
<a name="l00444"></a>00444         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = gfx_width / 2;
<a name="l00445"></a>00445         slide_context-&gt;<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a> = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(root_win, &amp;attr);
<a name="l00446"></a>00446         <span class="keywordflow">if</span> (!slide_context-&gt;<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a>) {
<a name="l00447"></a>00447                 <span class="keywordflow">goto</span> exit_no_middle_window;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x += attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x;
<a name="l00451"></a>00451         attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#afb961948c18ea282b2c4ea2d06542540" title="Width and height of area.">size</a>.x = gfx_width - attr.<a class="code" href="structwin__attributes.html#a37c5f9ad4e8f35c8817cdccd321cb4a7" title="Position and size of window, relative to parent.">area</a>.<a class="code" href="structwin__area.html#a69c7b4744c2bd3c7135847feb9ee5504" title="Top-left corner of area.">pos</a>.x;
<a name="l00452"></a>00452         slide_context-&gt;<a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e" title="Pointer to right application window.">right</a> = <a class="code" href="group__gfx__win.html#ga2fef2c618144f46b67fb95ae138131b5" title="Create a window and return its pointer. Use win_destroy() to free memory.">win_create</a>(root_win, &amp;attr);
<a name="l00453"></a>00453         <span class="keywordflow">if</span> (!slide_context-&gt;<a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e" title="Pointer to right application window.">right</a>) {
<a name="l00454"></a>00454                 <span class="keywordflow">goto</span> exit_no_right_window;
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         <span class="comment">// Show the windows to enable user input.</span>
<a name="l00458"></a>00458         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a>);
<a name="l00459"></a>00459         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(slide_context-&gt;<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a>);
<a name="l00460"></a>00460         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a85ce9cc9183c8c7960def3b89893943e" title="Pointer to right application window.">right</a>);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         <span class="comment">// Find first slideshow file and start loading.</span>
<a name="l00463"></a>00463         <a class="code" href="group__apps__slide__group.html#ga3e7b4aebfbd855f55f46339d43c8bed6" title="Find index of next slideshow file to load.">slide_get_next_file</a>(<span class="keyword">true</span>);
<a name="l00464"></a>00464         <a class="code" href="group__apps__slide__group.html#gafb2e8815a7e29a8d46dec70ff7d76ac4" title="Start loading current file to screen.">slide_show_file</a>();
<a name="l00465"></a>00465 
<a name="l00466"></a>00466         <span class="keywordflow">return</span>;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <span class="comment">// Handle allocation errors.</span>
<a name="l00469"></a>00469 exit_no_right_window:
<a name="l00470"></a>00470         <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(slide_context-&gt;<a class="code" href="structslide__context.html#ae479f9b515908959dd51b48b60fc594a" title="Pointer to middle application window.">middle</a>);
<a name="l00471"></a>00471 exit_no_middle_window:
<a name="l00472"></a>00472         <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(slide_context-&gt;<a class="code" href="structslide__context.html#a5d9bcf5355485d97b977433f840496f8" title="Pointer to left application window.">left</a>);
<a name="l00473"></a>00473 exit_no_left_window:
<a name="l00474"></a>00474         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(slide_context);
<a name="l00475"></a>00475 exit_no_context:
<a name="l00476"></a>00476         <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00477"></a>00477         <span class="keywordflow">return</span>;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00488"></a><a class="code" href="group__apps__slide__group.html#gad694a5d1bfe9990e022313b786481d5d">00488</a> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#gad694a5d1bfe9990e022313b786481d5d" title="Launch picture slideshow.">app_slideshow_pics_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490         <a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f" title="Common slideshow launcher.">slide_launch_helper</a>(task, <a class="code" href="group__apps__slide__group.html#ga8c8514a5c77651325d4f8f0cf0a52067" title="Filename prefix for picture slideshow.">SLIDE_PREFIX_PICS</a>);
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00501"></a><a class="code" href="group__apps__slide__group.html#gad8c454adf15443cf869456ed8b14325f">00501</a> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#gad8c454adf15443cf869456ed8b14325f" title="Launch 8-bit AVR presentation slideshow.">app_slideshow_avr_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00502"></a>00502 {
<a name="l00503"></a>00503         <a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f" title="Common slideshow launcher.">slide_launch_helper</a>(task, <a class="code" href="group__apps__slide__group.html#gaf280981544b3506c9a518f87fc592c63" title="Filename prefix for AVR presentation slideshow.">SLIDE_PREFIX_AVR</a>);
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00514"></a><a class="code" href="group__apps__slide__group.html#ga2167e4d6a3d29a6f5465af1b3d0ecca2">00514</a> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#ga2167e4d6a3d29a6f5465af1b3d0ecca2" title="Launch UC3 presentation slideshow.">app_slideshow_uc3_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00515"></a>00515 {
<a name="l00516"></a>00516         <a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f" title="Common slideshow launcher.">slide_launch_helper</a>(task, <a class="code" href="group__apps__slide__group.html#gafe5cf461d029f10d0df3de210f36f828" title="Filename prefix for UC3 presentation slideshow.">SLIDE_PREFIX_UC3</a>);
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00527"></a><a class="code" href="group__apps__slide__group.html#gaaf5673fc541372e608ec4d89fe28f2a2">00527</a> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#gaaf5673fc541372e608ec4d89fe28f2a2" title="Launch AVR XMEGA presentation slideshow.">app_slideshow_xmega_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529         <a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f" title="Common slideshow launcher.">slide_launch_helper</a>(task, <a class="code" href="group__apps__slide__group.html#ga0a7bea162941bde4a6046314c623358e" title="Filename prefix for AVR XMEGA presentation slideshow.">SLIDE_PREFIX_XMEGA</a>);
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00540"></a><a class="code" href="group__apps__slide__group.html#ga9fc9bc919c8a40eff101f9857d613a3e">00540</a> <span class="keywordtype">void</span> <a class="code" href="group__apps__slide__group.html#ga9fc9bc919c8a40eff101f9857d613a3e" title="Launch Display Xplain presentation slideshow.">app_slideshow_dx_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542         <a class="code" href="group__apps__slide__group.html#gabfb296d8b5a1d674399d8a4492ea929f" title="Common slideshow launcher.">slide_launch_helper</a>(task, <a class="code" href="group__apps__slide__group.html#ga884c95d12cdd5bd1db489a08b85328bb" title="Filename prefix for Display Xplained presentation slideshow.">SLIDE_PREFIX_DX</a>);
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:09:58 2010 for display-demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
