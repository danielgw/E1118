<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-demo: Memory Bag Allocator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Memory Bag Allocator<br/>
<small>
[<a class="el" href="group__mem__alloc__group.html">Memory Allocation</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for Memory Bag Allocator:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__membag__group.png" border="0" alt="" usemap="#group____membag____group_map"/>
<map name="group____membag____group_map" id="group____membag____group">
<area shape="rect" href="group__mem__alloc__group.html" title="Memory Allocation" alt="" coords="7,5,135,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#gafc3a131be20d2f345589430df7e8e815">membag_init</a> (unsigned int align_order)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize memory manager before use.  <a href="#gafc3a131be20d2f345589430df7e8e815"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#ga7a43e6df2bd28d5fddfd77ddcc622195">membag_get_total</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Total amount of memory in bytes.  <a href="#ga7a43e6df2bd28d5fddfd77ddcc622195"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#gad799b9cd86950091d94f81e08412a0ed">membag_get_smallest_free_block_size</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Smallest free block in bytes.  <a href="#gad799b9cd86950091d94f81e08412a0ed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#ga5e90c339c441c6b3240767ad5fa927df">membag_get_largest_free_block_size</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Largest free block size in bytes.  <a href="#ga5e90c339c441c6b3240767ad5fa927df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd">membag_alloc</a> (size_t size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate memory.  <a href="#gad2210e38b675715afcd6e1f154ba2ecd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27">membag_free</a> (void *ptr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free previously allocated memory.  <a href="#ga48cbe39bcafbfff70f900aeca0748b27"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The memory bag allocator uses several bags of different size to allocate memory from. The Memory bag allocator will always allocate from the smallest available bag which is equal to or larger than the number of bytes requested. The size of each bag and number of blocks in each bag is user configurable. See <a class="el" href="membag_8c.html#ab018970cc1f26ffa9bcc695059d01ecd">membags</a> and <a class="el" href="group__membag__group.html#gafc3a131be20d2f345589430df7e8e815">membag_init</a>.</p>
<p>The allocator also has statistics functionality for tuning the size of bags and number of blocks within each bag to get the best memory usage for the application. See CONFIG_MEMBAG_USE_TUNING and membag_get_bag_stats</p>
<p>The memory bag allocator always allocates memory from a fixed size bag/pool in the same way as the <a class="el" href="group__mempool__group.html">Memory Pool Allocator</a>. This helps reduce fragmentation compared to an generic allocator that gives exactly the bytes requested. (Reduces external fragmentation)</p>
<p>Compared to the <a class="el" href="group__mempool__group.html">Memory Pool Allocator</a>, the membag allocator has the advantage of providing several bags of different sizes to allocate from which can help reduce the memory usage in applications where different size objects is allocated. (Reduces internal fragmentation)</p>
<p>Allocation of memory with the membag allocator has a max run time which is dependent on the number of bags that is configured. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gad2210e38b675715afcd6e1f154ba2ecd"></a><!-- doxytag: member="membag.h::membag_alloc" ref="gad2210e38b675715afcd6e1f154ba2ecd" args="(size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* membag_alloc </td>
          <td>(</td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate memory. </p>
<p>This function finds the smallest bag with available memory that is equal or larger than the number of bytes requested. Memory is then allocated from within that bag.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Size of buffer to allocate </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the memory block. NULL if no memory was available </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00270">270</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="util_8h_source.html#l00068">ARRAY_LEN</a>, <a class="el" href="membag_8c_source.html#l00050">membag::block_size</a>, <a class="el" href="group__mempool__group.html#ga5e7c4701fb65890927dc29ae4ee5e5c4">mem_pool_alloc()</a>, and <a class="el" href="membag_8c_source.html#l00053">membag::pool</a>.</p>

<p>Referenced by <a class="el" href="app__memgame_8c_source.html#l00800">app_memgame_launch()</a>, <a class="el" href="app__tank_8c_source.html#l00618">app_tank_launch()</a>, <a class="el" href="app__slideshow_8c_source.html#l00384">slide_launch_helper()</a>, <a class="el" href="wtk__basic__frame_8c_source.html#l00236">wtk_basic_frame_create()</a>, <a class="el" href="wtk__button_8c_source.html#l00307">wtk_button_create()</a>, <a class="el" href="wtk__check__box_8c_source.html#l00333">wtk_check_box_create()</a>, <a class="el" href="wtk__frame_8c_source.html#l01018">wtk_frame_create()</a>, <a class="el" href="wtk__label_8c_source.html#l00081">wtk_label_change()</a>, <a class="el" href="wtk__label_8c_source.html#l00235">wtk_label_create()</a>, <a class="el" href="wtk__progress__bar_8c_source.html#l00308">wtk_progress_bar_create()</a>, <a class="el" href="wtk__radio__button_8c_source.html#l00372">wtk_radio_button_create()</a>, <a class="el" href="wtk__radio__button_8c_source.html#l00453">wtk_radio_group_create()</a>, <a class="el" href="wtk__slider_8c_source.html#l00466">wtk_slider_create()</a>, and <a class="el" href="wtk__frame_8c_source.html#l00510">wtk_start_drag()</a>.</p>

</div>
</div>
<a class="anchor" id="ga48cbe39bcafbfff70f900aeca0748b27"></a><!-- doxytag: member="membag.h::membag_free" ref="ga48cbe39bcafbfff70f900aeca0748b27" args="(void *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void membag_free </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free previously allocated memory. </p>
<p>This function returns a block of memory to the correct memory bag</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Invalid addresses will be ignored. </dd>
<dd>
Do not free previously freed memory </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00327">327</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="util_8h_source.html#l00068">ARRAY_LEN</a>, <a class="el" href="membag_8c_source.html#l00056">membag::end</a>, <a class="el" href="group__mempool__group.html#gacf196ba6a68124e0560662840fa8b113">mem_pool_free()</a>, <a class="el" href="membag_8c_source.html#l00053">membag::pool</a>, and <a class="el" href="membag_8c_source.html#l00055">membag::start</a>.</p>

<p>Referenced by <a class="el" href="app__clock_8c_source.html#l00185">app_clock_frame_command_handler()</a>, <a class="el" href="app__files_8c_source.html#l00391">app_files_frame_command_handler()</a>, <a class="el" href="app__fonts_8c_source.html#l00436">app_fonts_frame_command_handler()</a>, <a class="el" href="app__fonts_8c_source.html#l00487">app_fonts_load_worker()</a>, <a class="el" href="app__memgame_8c_source.html#l00800">app_memgame_launch()</a>, <a class="el" href="app__tank_8c_source.html#l00618">app_tank_launch()</a>, <a class="el" href="app__calc_8c_source.html#l00184">calc_frame_command_handler()</a>, <a class="el" href="app__memgame_8c_source.html#l00412">memgame_draw_piece()</a>, <a class="el" href="app__memgame_8c_source.html#l00665">memgame_handle_command_event()</a>, <a class="el" href="app__slideshow_8c_source.html#l00384">slide_launch_helper()</a>, <a class="el" href="app__slideshow_8c_source.html#l00294">slide_window_handler()</a>, <a class="el" href="app__tank_8c_source.html#l00298">tank_frame_handler()</a>, <a class="el" href="app__tank_8c_source.html#l00506">tank_loader()</a>, <a class="el" href="app__calibrate_8c_source.html#l00142">touch_calibrate_task_handler()</a>, <a class="el" href="app__widget_8c_source.html#l00227">widget_frame_command_handler()</a>, <a class="el" href="win_8c_source.html#l01491">win_destroy_children()</a>, <a class="el" href="wtk__basic__frame_8c_source.html#l00236">wtk_basic_frame_create()</a>, <a class="el" href="wtk__basic__frame_8c_source.html#l00115">wtk_basic_frame_handler()</a>, <a class="el" href="wtk__button_8c_source.html#l00307">wtk_button_create()</a>, <a class="el" href="wtk__button_8c_source.html#l00103">wtk_button_handler()</a>, <a class="el" href="wtk__check__box_8c_source.html#l00333">wtk_check_box_create()</a>, <a class="el" href="wtk__check__box_8c_source.html#l00146">wtk_check_box_handler()</a>, <a class="el" href="wtk__frame_8c_source.html#l01018">wtk_frame_create()</a>, <a class="el" href="wtk__frame_8c_source.html#l00764">wtk_frame_handler()</a>, <a class="el" href="wtk__label_8c_source.html#l00081">wtk_label_change()</a>, <a class="el" href="wtk__label_8c_source.html#l00235">wtk_label_create()</a>, <a class="el" href="wtk__label_8c_source.html#l00131">wtk_label_handler()</a>, <a class="el" href="wtk__progress__bar_8c_source.html#l00308">wtk_progress_bar_create()</a>, <a class="el" href="wtk__progress__bar_8c_source.html#l00195">wtk_progress_bar_handler()</a>, <a class="el" href="wtk__radio__button_8c_source.html#l00372">wtk_radio_button_create()</a>, <a class="el" href="wtk__radio__button_8c_source.html#l00162">wtk_radio_button_handler()</a>, <a class="el" href="wtk__slider_8c_source.html#l00466">wtk_slider_create()</a>, <a class="el" href="wtk__slider_8c_source.html#l00213">wtk_slider_handler()</a>, <a class="el" href="wtk__frame_8c_source.html#l00510">wtk_start_drag()</a>, and <a class="el" href="wtk__frame_8c_source.html#l00612">wtk_stop_drag()</a>.</p>

</div>
</div>
<a class="anchor" id="ga5e90c339c441c6b3240767ad5fa927df"></a><!-- doxytag: member="membag.h::membag_get_largest_free_block_size" ref="ga5e90c339c441c6b3240767ad5fa927df" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t membag_get_largest_free_block_size </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Largest free block size in bytes. </p>
<p>This searches through all bags to find the largest available block</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Number of bytes for largest available block </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00246">246</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="util_8h_source.html#l00068">ARRAY_LEN</a>, <a class="el" href="membag_8c_source.html#l00050">membag::block_size</a>, <a class="el" href="mempool_8h_source.html#l00074">mem_pool::freelist</a>, and <a class="el" href="membag_8c_source.html#l00053">membag::pool</a>.</p>

</div>
</div>
<a class="anchor" id="gad799b9cd86950091d94f81e08412a0ed"></a><!-- doxytag: member="membag.h::membag_get_smallest_free_block_size" ref="gad799b9cd86950091d94f81e08412a0ed" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t membag_get_smallest_free_block_size </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Smallest free block in bytes. </p>
<p>This searches through all bags to find the smallest available block</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Number of bytes for smallest available block </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00226">226</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="util_8h_source.html#l00068">ARRAY_LEN</a>, <a class="el" href="membag_8c_source.html#l00050">membag::block_size</a>, <a class="el" href="mempool_8h_source.html#l00074">mem_pool::freelist</a>, and <a class="el" href="membag_8c_source.html#l00053">membag::pool</a>.</p>

</div>
</div>
<a class="anchor" id="ga7a43e6df2bd28d5fddfd77ddcc622195"></a><!-- doxytag: member="membag.h::membag_get_total" ref="ga7a43e6df2bd28d5fddfd77ddcc622195" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t membag_get_total </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Total amount of memory in bytes. </p>
<p>This function returns the total memory ie. the total number of blocks in each bag multiplied by the block size for each bag.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Sum of total bytes in all bags </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00181">181</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="util_8h_source.html#l00068">ARRAY_LEN</a>, <a class="el" href="membag_8c_source.html#l00050">membag::block_size</a>, and <a class="el" href="membag_8c_source.html#l00051">membag::num_blocks</a>.</p>

</div>
</div>
<a class="anchor" id="gafc3a131be20d2f345589430df7e8e815"></a><!-- doxytag: member="membag.h::membag_init" ref="gafc3a131be20d2f345589430df7e8e815" args="(unsigned int align_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void membag_init </td>
          <td>(</td>
          <td class="paramtype">const unsigned int&nbsp;</td>
          <td class="paramname"> <em>align_order</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize memory manager before use. </p>
<p>This function will allocate all the memory bags using <a class="el" href="structphysmem__pool.html">physmem_pool</a> and <a class="el" href="group__mempool__group.html">Memory Pool</a>. Memory sizes and number of blocks are defined with APP_MEMBAG_INITIALIZER defined in <a class="el" href="apps_2display-demo_2include_2app_2membag_8h.html" title="Declaration of membag sizes for the test suite.">app/membag.h</a> for each individual application.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>align_order</em>&nbsp;</td><td>log2 of the minimum object alignment in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="membag_8c.html#ab018970cc1f26ffa9bcc695059d01ecd" title="Memory bag.">membags</a> </dd>
<dd>
<a class="el" href="group__mempool__group.html#ga9cfe0b11ce6861f8b0e2d32c8bf91299" title="Initialize a memory pool using the physmem allocator.">mem_pool_init_physmem</a> </dd></dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>Not in interrupt context. </dd></dl>

<p>Definition at line <a class="el" href="membag_8c_source.html#l00163">163</a> of file <a class="el" href="membag_8c_source.html">membag.c</a>.</p>

<p>References <a class="el" href="util_8h_source.html#l00068">ARRAY_LEN</a>, and <a class="el" href="membag_8c_source.html#l00115">membag_pool_init_physmem()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:10:00 2010 for display-demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
