<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>display-demo: apps/display-demo/app_clock.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>apps/display-demo/app_clock.c</h1><a href="app__clock_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="assert_8h.html" title="Run-time and build-time assertion support.">assert.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="arch_2avr8_2include_2arch_2string_8h.html" title="Standard string operations for AVR.">string.h</a>&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="gfx_8h.html" title="General graphics routines header file.">gfx/gfx.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2win_8h.html" title="Graphical Window system.">gfx/win.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2wtk_8h.html" title="Graphical Widget toolkit.">gfx/wtk.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="include_2gfx_2sysfont_8h.html" title="Graphical Window system.">gfx/sysfont.h</a>&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="app__clock_8h.html" title="Display Xplained clock application.">app_clock.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="app__desktop_8h.html" title="Display demo desktop application.">app_desktop.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="group__app__clock__group.html#ga9f4dfe30a7d1c96f6d4438c0b2019cd6">00062</a> <span class="preprocessor">#define COLOR_TEXT              GFX_COLOR(255, 255, 255)</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a><a class="code" href="group__app__clock__group.html#gaf27cfac70191e90ee59f2fbfc0142df5">00064</a> <span class="preprocessor">#define COLOR_BACKGROUND        GFX_COLOR(0, 0, 0)</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a><a class="code" href="group__app__clock__group.html#ga141cd00ea67187f1e0275d3d20691969">00066</a> <span class="preprocessor">#define COLOR_BORDER            GFX_COLOR(150, 150, 150)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00069"></a>00069 
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="group__app__clock__group.html#ga7d099fc267f4ddf015624c63097d6fcc">00077</a> <span class="preprocessor">#define FRAME_PADDING           40</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00079"></a><a class="code" href="group__app__clock__group.html#ga915e7581e140dd2d625fa1cfca365100">00079</a> <span class="preprocessor">#define FRAME_HEIGHT            (gfx_get_height() - (2 * FRAME_PADDING))</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a><a class="code" href="group__app__clock__group.html#gaf193f69a079134ae165cc495b9b62d70">00081</a> <span class="preprocessor">#define FRAME_WIDTH             (gfx_get_width() - (2 * FRAME_PADDING))</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00083"></a><a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6">00083</a> <span class="preprocessor">#define FRAME_POS_X             FRAME_PADDING</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a><a class="code" href="group__app__clock__group.html#gadf70f2bb6b747e7f1d4bb4fcb76a6d96">00085</a> <span class="preprocessor">#define FRAME_POS_Y             FRAME_PADDING</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00088"></a>00088 
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="group__app__clock__group.html#ga4519ae02121b8d7615bff33cb868048e">00096</a> <span class="preprocessor">#define TEXT_INDENT             15</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a><a class="code" href="group__app__clock__group.html#ga9751a4bf00a3048680619885fda90d56">00098</a> <span class="preprocessor">#define TEXT_PADDING_NEWLINE    4</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00101"></a>00101 
<a name="l00105"></a><a class="code" href="group__app__clock__group.html#ga2bc113a341c05c331d40e25dac1f9a1a">00105</a> <span class="keyword">enum</span> <a class="code" href="group__app__clock__group.html#ga2bc113a341c05c331d40e25dac1f9a1a" title="Event command ID for the application widgets.">app_clock_button_ids</a> {
<a name="l00107"></a><a class="code" href="group__app__clock__group.html#gga2bc113a341c05c331d40e25dac1f9a1aab547812177a881b890bf0df572c50d7f">00107</a>         <a class="code" href="group__app__widget__group.html#gga10c6050053c4f5010590044cc7879556ab547812177a881b890bf0df572c50d7f" title="Command event ID for exit button.">BUTTON_EXIT_ID</a> = 1,
<a name="l00108"></a>00108 };
<a name="l00109"></a>00109 
<a name="l00113"></a><a class="code" href="structapp__clock.html">00113</a> <span class="keyword">struct </span><a class="code" href="structapp__clock.html" title="Context for the clock application.">app_clock</a> {
<a name="l00115"></a><a class="code" href="structapp__clock.html#ad1ea38737e557cad363dd3ccb6f9fc0d">00115</a>         <span class="keyword">struct </span><a class="code" href="structwtk__basic__frame.html" title="Basic frame control struct.">wtk_basic_frame</a>  *<a class="code" href="structapp__clock.html#ad1ea38737e557cad363dd3ccb6f9fc0d" title="Pointer to the main frame of the application.">frame</a>;
<a name="l00117"></a><a class="code" href="structapp__clock.html#a9f6b87b4a161d065a04bde4b3cdbbcd9">00117</a>         <span class="keyword">struct </span><a class="code" href="structgfx__bitmap.html" title="Storage structure for bitmap pixel data and metadata.">gfx_bitmap</a>       <a class="code" href="structapp__clock.html#a9f6b87b4a161d065a04bde4b3cdbbcd9" title="Background bitmap for application.">background</a>;
<a name="l00119"></a><a class="code" href="structapp__clock.html#a2ab888d81156427bc31318694ef84376">00119</a>         <span class="keyword">struct </span><a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>             <a class="code" href="structapp__clock.html#a2ab888d81156427bc31318694ef84376" title="Font used to store a copy of the system font while running.">prev_sysfont</a>;
<a name="l00120"></a>00120 };
<a name="l00121"></a>00121 
<a name="l00129"></a><a class="code" href="group__app__clock__group.html#ga17569a4d23efd427e61b8dc7eb88271c">00129</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structapp__clock.html" title="Context for the clock application.">app_clock</a> *<a class="code" href="group__app__clock__group.html#ga17569a4d23efd427e61b8dc7eb88271c" title="Pointer to the clock application context.">the_clock_app</a>;
<a name="l00130"></a>00130 
<a name="l00138"></a><a class="code" href="group__app__clock__group.html#ga857901b36449b6e82ac11b4e0f3b11d2">00138</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__app__clock__group.html#ga857901b36449b6e82ac11b4e0f3b11d2" title="Frame draw handler handling draw events.">app_clock_frame_draw_handler</a>(<span class="keyword">struct</span> <a class="code" href="structwin__window.html" title="Window control data.">win_window</a> *win,
<a name="l00139"></a>00139                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structwin__clip__region.html" title="Geometric type describing a clipping region, used when drawing windows.">win_clip_region</a> *clip)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141         <a class="code" href="group__gfx__gfx.html#ga32e82d1159c77b5fa73c8e5ffd962eba" title="Data type representing a coordinate on the screen.">gfx_coord_t</a> y = <a class="code" href="group__app__clock__group.html#gadf70f2bb6b747e7f1d4bb4fcb76a6d96" title="Y position of top left corner.">FRAME_POS_Y</a> + <a class="code" href="group__app__clock__group.html#ga4519ae02121b8d7615bff33cb868048e" title="Number of pixels to indent a string.">TEXT_INDENT</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143         <a class="code" href="group__gfx__gfx.html#gab42059725ca38dc3e876afcc86d00260" title="Draw an outline of a rectangle.">gfx_draw_rect</a>(<a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a>, <a class="code" href="group__app__clock__group.html#gadf70f2bb6b747e7f1d4bb4fcb76a6d96" title="Y position of top left corner.">FRAME_POS_Y</a>, <a class="code" href="group__app__clock__group.html#gaf193f69a079134ae165cc495b9b62d70" title="Width of frame.">FRAME_WIDTH</a>, <a class="code" href="group__app__clock__group.html#ga915e7581e140dd2d625fa1cfca365100" title="Height of frame.">FRAME_HEIGHT</a>,
<a name="l00144"></a>00144                         <a class="code" href="group__app__clock__group.html#ga141cd00ea67187f1e0275d3d20691969" title="Color on frame border.">COLOR_BORDER</a>);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <a class="code" href="group__gfx__gfx.html#gaf6bb28b793aa67278db46230b72d6c50" title="Draws a string to the display.">gfx_draw_string</a>(<span class="stringliteral">&quot;Clock application&quot;</span>,
<a name="l00147"></a>00147                         <a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a> + TEXT_INDENT, y, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <a class="code" href="group__app__clock__group.html#ga9f4dfe30a7d1c96f6d4438c0b2019cd6" title="Color on text strings.">COLOR_TEXT</a>,
<a name="l00148"></a>00148                         <a class="code" href="group__gfx__gfx.html#gab8aa45e3febdfb476408dffba0cc0103" title="Value used as input to font functions to give a transparent background region.">GFX_COLOR_TRANSPARENT</a>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="comment">/*</span>
<a name="l00151"></a>00151 <span class="comment">         * The system font will print very dense if not adding some extra</span>
<a name="l00152"></a>00152 <span class="comment">         * padding between lines, hence padding with TEXT_PADDING_NEWLINE.</span>
<a name="l00153"></a>00153 <span class="comment">         */</span>
<a name="l00154"></a>00154         y += (2 * <a class="code" href="group__gfx__gfx.html#gaf3ab81c08d4d2a7638b4aa9a17e8033f" title="Get scaled height of a font.">gfx_font_get_height</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>)) + <a class="code" href="group__app__clock__group.html#ga9751a4bf00a3048680619885fda90d56" title="Number of pixels to pad after a string newline.">TEXT_PADDING_NEWLINE</a>;
<a name="l00155"></a>00155         <a class="code" href="group__gfx__gfx.html#gaf6bb28b793aa67278db46230b72d6c50" title="Draws a string to the display.">gfx_draw_string</a>(<span class="stringliteral">&quot;This application&quot;</span>,
<a name="l00156"></a>00156                         <a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a> + TEXT_INDENT, y, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <a class="code" href="group__app__clock__group.html#ga9f4dfe30a7d1c96f6d4438c0b2019cd6" title="Color on text strings.">COLOR_TEXT</a>,
<a name="l00157"></a>00157                         <a class="code" href="group__gfx__gfx.html#gab8aa45e3febdfb476408dffba0cc0103" title="Value used as input to font functions to give a transparent background region.">GFX_COLOR_TRANSPARENT</a>);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         y += <a class="code" href="group__gfx__gfx.html#gaf3ab81c08d4d2a7638b4aa9a17e8033f" title="Get scaled height of a font.">gfx_font_get_height</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>) + <a class="code" href="group__app__clock__group.html#ga9751a4bf00a3048680619885fda90d56" title="Number of pixels to pad after a string newline.">TEXT_PADDING_NEWLINE</a>;
<a name="l00160"></a>00160         <a class="code" href="group__gfx__gfx.html#gaf6bb28b793aa67278db46230b72d6c50" title="Draws a string to the display.">gfx_draw_string</a>(<span class="stringliteral">&quot;is left as an&quot;</span>,
<a name="l00161"></a>00161                         <a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a> + TEXT_INDENT, y, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <a class="code" href="group__app__clock__group.html#ga9f4dfe30a7d1c96f6d4438c0b2019cd6" title="Color on text strings.">COLOR_TEXT</a>,
<a name="l00162"></a>00162                         <a class="code" href="group__gfx__gfx.html#gab8aa45e3febdfb476408dffba0cc0103" title="Value used as input to font functions to give a transparent background region.">GFX_COLOR_TRANSPARENT</a>);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         y += <a class="code" href="group__gfx__gfx.html#gaf3ab81c08d4d2a7638b4aa9a17e8033f" title="Get scaled height of a font.">gfx_font_get_height</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>) + <a class="code" href="group__app__clock__group.html#ga9751a4bf00a3048680619885fda90d56" title="Number of pixels to pad after a string newline.">TEXT_PADDING_NEWLINE</a>;
<a name="l00165"></a>00165         <a class="code" href="group__gfx__gfx.html#gaf6bb28b793aa67278db46230b72d6c50" title="Draws a string to the display.">gfx_draw_string</a>(<span class="stringliteral">&quot;exercise for the&quot;</span>,
<a name="l00166"></a>00166                         <a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a> + TEXT_INDENT, y, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <a class="code" href="group__app__clock__group.html#ga9f4dfe30a7d1c96f6d4438c0b2019cd6" title="Color on text strings.">COLOR_TEXT</a>,
<a name="l00167"></a>00167                         <a class="code" href="group__gfx__gfx.html#gab8aa45e3febdfb476408dffba0cc0103" title="Value used as input to font functions to give a transparent background region.">GFX_COLOR_TRANSPARENT</a>);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         y += <a class="code" href="group__gfx__gfx.html#gaf3ab81c08d4d2a7638b4aa9a17e8033f" title="Get scaled height of a font.">gfx_font_get_height</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>) + <a class="code" href="group__app__clock__group.html#ga9751a4bf00a3048680619885fda90d56" title="Number of pixels to pad after a string newline.">TEXT_PADDING_NEWLINE</a>;
<a name="l00170"></a>00170         <a class="code" href="group__gfx__gfx.html#gaf6bb28b793aa67278db46230b72d6c50" title="Draws a string to the display.">gfx_draw_string</a>(<span class="stringliteral">&quot;user to implement.&quot;</span>,
<a name="l00171"></a>00171                         <a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a> + TEXT_INDENT, y, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <a class="code" href="group__app__clock__group.html#ga9f4dfe30a7d1c96f6d4438c0b2019cd6" title="Color on text strings.">COLOR_TEXT</a>,
<a name="l00172"></a>00172                         <a class="code" href="group__gfx__gfx.html#gab8aa45e3febdfb476408dffba0cc0103" title="Value used as input to font functions to give a transparent background region.">GFX_COLOR_TRANSPARENT</a>);
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00185"></a><a class="code" href="group__app__clock__group.html#ga687a98aae762745337c881d249acd140">00185</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="group__app__clock__group.html#ga687a98aae762745337c881d249acd140" title="Frame command handler handling the button events.">app_clock_frame_command_handler</a>(<span class="keyword">struct</span> <a class="code" href="structwtk__basic__frame.html" title="Basic frame control struct.">wtk_basic_frame</a> *<a class="code" href="structapp__clock.html#ad1ea38737e557cad363dd3ccb6f9fc0d" title="Pointer to the main frame of the application.">frame</a>,
<a name="l00186"></a>00186                 <a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a> command_data)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188         <a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a> command = (<a class="code" href="group__stdint__group.html#gae1affc9ca37cfb624959c866a73f83c2" title="8-bit unsigned integer">uint8_t</a>)(<a class="code" href="group__stdint__group.html#ga2f2d463af0e2a9da3ecdd102ce312832" title="Unsigned integer type capable of holding a pointer.">uintptr_t</a>)command_data;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         <span class="keywordflow">switch</span> (command) {
<a name="l00191"></a>00191         <span class="keywordflow">case</span> <a class="code" href="group__app__widget__group.html#gga10c6050053c4f5010590044cc7879556ab547812177a881b890bf0df572c50d7f" title="Command event ID for exit button.">BUTTON_EXIT_ID</a>:
<a name="l00192"></a>00192                 <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, &amp;the_clock_app-&gt;<a class="code" href="structapp__clock.html#a2ab888d81156427bc31318694ef84376" title="Font used to store a copy of the system font while running.">prev_sysfont</a>,
<a name="l00193"></a>00193                                 <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00194"></a>00194                 <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(the_clock_app);
<a name="l00195"></a>00195                 <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00196"></a>00196                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="keywordflow">default</span>:
<a name="l00199"></a>00199                 <span class="keywordflow">break</span>;
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00210"></a>00210 <span class="keywordtype">void</span> <a class="code" href="group__app__clock__group.html#gac99cfac1998dfd75ace1195305c7db42" title="Launcher for the clock application.">app_clock_launch</a>(<span class="keyword">struct</span> <a class="code" href="structworkqueue__task.html" title="Task to be run from a work queue.">workqueue_task</a> *task)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>       *<a class="code" href="group__gfx__win.html#ga5733efc0d1a2cf900afae4df206c8ff6" title="Root window, i.e. desktop window.">win_root</a>;
<a name="l00213"></a>00213         <span class="keyword">struct </span><a class="code" href="structwin__window.html" title="Window control data.">win_window</a>       *<a class="code" href="structwin__window.html#a252cb3f034971464404e055db6859a3a" title="Parent window.">parent</a>;
<a name="l00214"></a>00214         <span class="keyword">struct </span><a class="code" href="structwin__area.html" title="Geometric type describing an area on screen.">win_area</a>         area;
<a name="l00215"></a>00215         <span class="keyword">struct </span><a class="code" href="structwtk__button.html">wtk_button</a>       *button;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         the_clock_app = <a class="code" href="group__membag__group.html#gad2210e38b675715afcd6e1f154ba2ecd" title="Allocate memory.">membag_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structapp__clock.html" title="Context for the clock application.">app_clock</a>));
<a name="l00218"></a>00218         <span class="keywordflow">if</span> (!the_clock_app)
<a name="l00219"></a>00219                 <span class="keywordflow">goto</span> error_membag_alloc;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221         <span class="comment">/* Store previous system font and scale it to double size. */</span>
<a name="l00222"></a>00222         <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;the_clock_app-&gt;<a class="code" href="structapp__clock.html#a2ab888d81156427bc31318694ef84376" title="Font used to store a copy of the system font while running.">prev_sysfont</a>, &amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00223"></a>00223         <a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>.<a class="code" href="structfont.html#a93930e293fe0c2a740da28bbd8f1a46d" title="Number of times characters are scaled up when being drawn.">scale</a> = 2;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">/* Initialize and set the background. */</span>
<a name="l00226"></a>00226         the_clock_app-&gt;<a class="code" href="structapp__clock.html#a9f6b87b4a161d065a04bde4b3cdbbcd9" title="Background bitmap for application.">background</a>.<a class="code" href="structgfx__bitmap.html#a25e3747161bb4053f91cbaab6bdc216d" title="Bitmap type.">type</a>       = <a class="code" href="group__gfx__gfx.html#ggaaa3d242c7c08ccafbb00bbcfabe27e3fa5347f7bf0548ae0c3cc8210f49b937a6" title="Solid color bitmap.">BITMAP_SOLID</a>;
<a name="l00227"></a>00227         the_clock_app-&gt;<a class="code" href="structapp__clock.html#a9f6b87b4a161d065a04bde4b3cdbbcd9" title="Background bitmap for application.">background</a>.data.<a class="code" href="structgfx__bitmap.html#a79b389912a0bf990d9c23e8b21f02569" title="Color for solid color bitmaps.">color</a> = <a class="code" href="group__app__clock__group.html#gaf27cfac70191e90ee59f2fbfc0142df5" title="Background color.">COLOR_BACKGROUND</a>;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229         win_root = <a class="code" href="group__gfx__win.html#gabb0c95ee3810418e2dff2264aac277fa" title="Get pointer to root window, i.e. desktop window.">win_get_root</a>();
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="comment">/*</span>
<a name="l00232"></a>00232 <span class="comment">         * Create a transparent basic frame with height and width equal to half</span>
<a name="l00233"></a>00233 <span class="comment">         * the screen height and width. Position the basic frame in the center</span>
<a name="l00234"></a>00234 <span class="comment">         * of the screen.</span>
<a name="l00235"></a>00235 <span class="comment">         */</span>
<a name="l00236"></a>00236         area.pos.x = <a class="code" href="group__app__clock__group.html#ga8d38b56754a2f60252a2fa6f32b1fed6" title="X position of top left corner.">FRAME_POS_X</a>;
<a name="l00237"></a>00237         area.pos.y = <a class="code" href="group__app__clock__group.html#gadf70f2bb6b747e7f1d4bb4fcb76a6d96" title="Y position of top left corner.">FRAME_POS_Y</a>;
<a name="l00238"></a>00238         area.size.x = <a class="code" href="group__app__clock__group.html#gaf193f69a079134ae165cc495b9b62d70" title="Width of frame.">FRAME_WIDTH</a>;
<a name="l00239"></a>00239         area.size.y = <a class="code" href="group__app__clock__group.html#ga915e7581e140dd2d625fa1cfca365100" title="Height of frame.">FRAME_HEIGHT</a>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         the_clock_app-&gt;<a class="code" href="structapp__clock.html#ad1ea38737e557cad363dd3ccb6f9fc0d" title="Pointer to the main frame of the application.">frame</a> = <a class="code" href="group__gfx__wtk__basic__frame.html#ga2ef82bf721f8db8440ef4bdaa5e9a982" title="Create basic frame widget.">wtk_basic_frame_create</a>(win_root, &amp;area,
<a name="l00242"></a>00242                         &amp;the_clock_app-&gt;<a class="code" href="structapp__clock.html#a9f6b87b4a161d065a04bde4b3cdbbcd9" title="Background bitmap for application.">background</a>,
<a name="l00243"></a>00243                         <a class="code" href="group__app__clock__group.html#ga857901b36449b6e82ac11b4e0f3b11d2" title="Frame draw handler handling draw events.">app_clock_frame_draw_handler</a>,
<a name="l00244"></a>00244                         <a class="code" href="group__app__clock__group.html#ga687a98aae762745337c881d249acd140" title="Frame command handler handling the button events.">app_clock_frame_command_handler</a>, &amp;the_clock_app);
<a name="l00245"></a>00245         <span class="keywordflow">if</span> (!the_clock_app-&gt;<a class="code" href="structapp__clock.html#ad1ea38737e557cad363dd3ccb6f9fc0d" title="Pointer to the main frame of the application.">frame</a>)
<a name="l00246"></a>00246                 <span class="keywordflow">goto</span> error_text_frame;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         parent = <a class="code" href="group__gfx__wtk__basic__frame.html#ga288ea10860d82def003800b19222ab0c" title="Get reference to basic frame window.">wtk_basic_frame_as_child</a>(the_clock_app-&gt;<a class="code" href="structapp__clock.html#ad1ea38737e557cad363dd3ccb6f9fc0d" title="Pointer to the main frame of the application.">frame</a>);
<a name="l00249"></a>00249         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(parent);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="comment">/* Create an exit button in the lower right corner of the frame. */</span>
<a name="l00252"></a>00252         area.size.x = <a class="code" href="group__app__desktop__group.html#ga143dc232ad4bf9b5f0a1abab1807dae9" title="Common application exit button size.">APP_EXIT_BUTTON_SIZE_X</a>;
<a name="l00253"></a>00253         area.size.y = <a class="code" href="group__app__desktop__group.html#gad91551723f80d14a01e432a0573977f4" title="Common application exit button size.">APP_EXIT_BUTTON_SIZE_Y</a>;
<a name="l00254"></a>00254         <span class="comment">/* Offset one into the frame to avoid the border. */</span>
<a name="l00255"></a>00255         area.pos.x = <a class="code" href="group__app__clock__group.html#gaf193f69a079134ae165cc495b9b62d70" title="Width of frame.">FRAME_WIDTH</a> - <a class="code" href="group__app__desktop__group.html#ga143dc232ad4bf9b5f0a1abab1807dae9" title="Common application exit button size.">APP_EXIT_BUTTON_SIZE_X</a> - 1;
<a name="l00256"></a>00256         area.pos.y = <a class="code" href="group__app__clock__group.html#ga915e7581e140dd2d625fa1cfca365100" title="Height of frame.">FRAME_HEIGHT</a> - <a class="code" href="group__app__desktop__group.html#gad91551723f80d14a01e432a0573977f4" title="Common application exit button size.">APP_EXIT_BUTTON_SIZE_Y</a> - 1;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         button = <a class="code" href="group__gfx__wtk__button.html#gaebe80c65856294eab28bb29264e2bd64">wtk_button_create</a>(parent, &amp;area, <a class="code" href="group__app__desktop__group.html#gafbd2c3cda74c4c7efee584275f4ca26e" title="Common application exit button text.">APP_EXIT_BUTTON_TEXT</a>,
<a name="l00259"></a>00259                         (<a class="code" href="group__gfx__win.html#ga53f0ed533fce454af67e765764d7eb5f" title="Custom data, can be used as a data pointer or data depending on the application.">win_command_t</a>)<a class="code" href="group__app__widget__group.html#gga10c6050053c4f5010590044cc7879556ab547812177a881b890bf0df572c50d7f" title="Command event ID for exit button.">BUTTON_EXIT_ID</a>);
<a name="l00260"></a>00260         <span class="keywordflow">if</span> (!button)
<a name="l00261"></a>00261                 <span class="keywordflow">goto</span> error_widget;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         <a class="code" href="group__gfx__win.html#gacf174cc778747a982b36cbe05e0d247d" title="Show window. Will draw it on screen if parent is visible as well.">win_show</a>(<a class="code" href="group__gfx__wtk__button.html#ga5fc0cc848622a1e21f00648be089ae63">wtk_button_as_child</a>(button));
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">return</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 error_widget:
<a name="l00268"></a>00268         <a class="code" href="group__gfx__win.html#ga518fd778a7f6c3b7ae2e296e074e743f" title="Destroy a window and its contents including children, freeing up memory.">win_destroy</a>(parent);
<a name="l00269"></a>00269 error_text_frame:
<a name="l00270"></a>00270         <a class="code" href="group__string__group.html#gaba088e716bccbc96d42da97e96316df1" title="Copy memory area.">memcpy</a>(&amp;<a class="code" href="group__gfx__sysfont.html#ga9df1a6a09f606d5fa00dc3a2be10aabb" title="Initialize a basic system font.">sysfont</a>, &amp;the_clock_app-&gt;<a class="code" href="structapp__clock.html#a2ab888d81156427bc31318694ef84376" title="Font used to store a copy of the system font while running.">prev_sysfont</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfont.html" title="Storage structure for font metadata.">font</a>));
<a name="l00271"></a>00271         <a class="code" href="group__membag__group.html#ga48cbe39bcafbfff70f900aeca0748b27" title="Free previously allocated memory.">membag_free</a>(the_clock_app);
<a name="l00272"></a>00272 error_membag_alloc:
<a name="l00273"></a>00273         <a class="code" href="group__app__desktop__group.html#ga3b0b29a4aaa11773cb5ccddedd80dab5" title="Restart desktop.">app_desktop_restart</a>();
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 29 14:09:58 2010 for display-demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
